---
ID: 171
post_title: Writing custom Gradle plugins, part 1
author: Gr√©gory Boissinot
post_date: 2009-06-27 21:52:00
post_excerpt: '<p><a href="http://www.gradle.org/">Gradle</a> is a plugin-oriented build system. Each plugin provides a set of tasks and conventions, and the code required to run the build process. Although many plugins are already provided in the core distribution (java, groovy, ant, maven, jetty...), the need may arise to develop your own. As this feature is currently not documented, we will write a series of blog posts demonstrating, step by step, how to create a plugin participating in the build lifecycle.</p>'
layout: post
permalink: http://blog.zenika-offres.com/?p=171
published: true
---
<p><a href="http://www.gradle.org/">Gradle</a> is a plugin-oriented build system. Each plugin provides a set of tasks and conventions, and the code required to run the build process. Although many plugins are already provided in the core distribution (java, groovy, ant, maven, jetty...), the need may arise to develop your own. As this feature is currently not documented, we will write a series of blog posts demonstrating, step by step, how to create a plugin participating in the build lifecycle.</p>
<!--more-->
<h4>First steps</h4> <p>Of course, our plugin itself shall be built with Gradle.<br />
Ours will use a Groovy layout, although the standard Java structure is also supported - this may be the subject of a future blog post.</p> <p>Create the following directory layout&nbsp;:</p> <pre> firstplugin +-- build.gradle +-- libs |   +--- gradle-0.6.jar |   +--- groovy-all-1.5.6.jar |   +--- slf4j-api-1.5.3.jar +-- src/main/groovy/com/zenika/plugins/FirstPlugin.java </pre> <p>Here is the related build script&nbsp;:</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">usePlugin<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'groovy'</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">version<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1.0</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">repositories <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">  flatDir<span style="color: #66cc66;">&#40;</span>dirs: file<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'lib'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">dependencies <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">   groovy <span style="color: #ff0000;">&quot;:groovy-all:1.5.6&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">   groovy <span style="color: #ff0000;">&quot;:gradle:0.6&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">   groovy <span style="color: #ff0000;">&quot;:slf4j-api:1.5.3&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li></ol></pre> <p>For now, the plugin consists of a single class "FirstPlugin.java"&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">package</span> com.<span style="color: #000000;">zenika</span>.<span style="color: #000000;">gradle</span>.<span style="color: #000000;">plugins</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.gradle.api.Plugin;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.gradle.api.Project;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.gradle.api.internal.project.PluginRegistry;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import java.util.Map;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> FirstPlugin <span style="color: #7F0055; font-weight: bold;">implements</span> Plugin <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">  <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> apply<span style="color: #000000;">&#40;</span>Project project, PluginRegistry pluginRegistry, <span style="color: #7F0055; font-weight: bold;">final</span> Map<span style="color: #000000;">&lt;</span>String, <span style="color: #000000;">?&gt;</span> customValues<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	   <span style="color: #000000;">System</span>.<span style="color: #000000;">out</span>.<span style="color: #000000;">println</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Hello World!&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">  <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>Compiling and packaging it is as easy as&nbsp;:</p> <pre class="bash code bash" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">gradle clean libs</div></li></ol></pre> <h4>Using the plugin</h4> <p>To use our brand new plugin, it must be first registered in Gradle through a "settings.gradle" descriptor&nbsp;:</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padd
ing:0; background:inherit;">flatDir<span style="color: #66cc66;">&#40;</span>dirs:<span style="color: #ff0000;">&quot;C:/dev/gradle/firstplugin/build/libs&quot;</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">dependencies<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;:firstplugin:1.0&quot;</span><span style="color: #66cc66;">&#41;</span></div></li></ol></pre> <p>Please note that, for the sake of simplicity, we used a physical path on the local hard drive. In an enterprise environment, the plugin would rather be deployed on a remote repository like <a href="http://nexus.sonatype.org/">Nexus</a>.</p> <p>Now, let's import the plugin in a build script&nbsp;:</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">usePlugin<span style="color: #66cc66;">&#40;</span>com.<span style="color: #006600;">zenika</span>.<span style="color: #006600;">gradle</span>.<span style="color: #006600;">plugins</span>.<span style="color: #006600;">FirstPlugin</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">task test <span style="color: #66cc66;">&lt;&lt;</span><span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"> <span style="color: #993399;">println</span> <span style="color: #ff0000;">&quot;Testing plugin&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li></ol></pre> <p>The "test" task doesn't do much, but is required to allow our plugin to be loaded and executed, as it doesn't define custom Gradle tasks on its own.</p> <p>Let's see what happens when the script gets executed&nbsp;:</p> <pre class="bash code bash" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">gradle <span style="color: #7a0874; font-weight: bold;">test</span></div></li></ol></pre> <p>The result should be&nbsp;:</p> <pre> Hello World! :test Testing plugin </pre> <h4>A side note on plugin descriptors</h4> <p>Requiring a "settings.gradle" descriptor file seems a bit laborious for a simple user-defined plugin. The forthcoming versions of Gradle will take it into account and simplify the process.</p> <p>On the other hand, if your plugin gets packaged in the core distribution, the plugin descriptor is not required any more.<br />
you can even declare a custom shortcut notation by editing the "plugin.properties" file&nbsp;:</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">java<span style="color: #66cc66;">=</span>org.<span style="color: #006600;">gradle</span>.<span style="color: #006600;">api</span>.<span style="color: #006600;">plugins</span>.<span style="color: #006600;">JavaPlugin</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">groovy<span style="color: #66cc66;">=</span>org.<span style="color: #006600;">gradle</span>.<span style="color: #006600;">api</span>.<span style="color: #006600;">plugins</span>.<span style="color: #006600;">GroovyPlugin</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">war<span style="color: #66cc66;">=</span>org.<span style="color: #006600;">gradle</span>.<span style="color: #006600;">api</span>.<span style="color: #006600;">plugins</span>.<span style="color: #006600;">WarPlugin</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">osgi<span style="color: #66cc66;">=</span>org.<span style="color: #006600;">gradle</span>.<span style="color: #006600;">api</span>.<span style="color: #006600;">plugins</span>.<span style="color: #006600;">osgi</span>.<span style="color: #006600;">OsgiPlugin</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">jetty<span style="color: #66cc66;">=</span>org.<span style="color: #006600;">gradle</span>.<span style="color: #006600;">api</span>.<span style="color: #006600;">plugins</span>.<span style="color: #006600;">jetty</span>.<span style="color: #006600;">JettyPlugin</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">maven<span style="color: #66cc66;">=</span>org.<span style="color: #006600;">gradle</span>.<span style="color: #006600;">api</span>.<span style="color: #006600;">plugins</span>.<span style="color: #006600;">MavenPlugin</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">project<span style="color: #66cc66;">-</span>reports<span style="color: #66cc66;">=</span>org.<span style="color: #006600;">gradle</span>.<span style="color: #006600;">api</span>.<span style="color: #006600;">plugins</span>.<span style="color: #006600;">ProjectReportsPlugin</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">ant<span style="color: #66cc66;">=</span>org.<span style="color: #006600;">gradle</span>.<span style="color: #006600;">api</span>.<span style="color: #006600;">plugins</span>.<span style="color: #006600;">ant</span>.<span style="color: #006600;">AntPlugin</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">firstplugin<span style="color: #66cc66;">=</span>com.<span style="color: #006600;">zenika</span>.<span style="color: #006600;">gradle</span>.<span style="color: #006600;">plugins</span>.<span style="color: #006600;">FirstPlugin</span></div></li></ol></pre> <p>and use it like any other core plugin&nbsp;:</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">usePlugin<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'firstplugin'</span><span style="color: #66cc66;">&#41;</span></div></li></ol></pre> <h4>Conclusion</h4> <p>In this article, we have seen how to develop a simple custom Gradle plugin.<br />
In the next installments of this series, we will show how to pass properties to our plugin, how to write custom tasks, and how to integrate them in the build lifecycle.</p>