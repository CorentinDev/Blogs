---
ID: 183
post_title: 'C&#039;est l&#039;orgie chez les fourmis'
author: dboukelmoune
post_date: 2013-04-12 09:05:00
post_excerpt: |
  <p>A l'occasion de la sortie d'<a href="http://ant.apache.org/" hreflang="en">Ant</a> 1.9.0, <a href="http://ant.apache.org/ivy" hreflang="en">Ivy</a> 2.3.0 et du tout récent <a href="http://ant.apache.org/easyant" hreflang="en">EasyAnt</a>, je vous propose de découvrir ce nouvel outil de build qui vient s'ajouter à la liste (déjà bien fournie) des outils existants.</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=183
published: true
---
<p>A l'occasion de la sortie d'<a href="http://ant.apache.org/" hreflang="en">Ant</a> 1.9.0, <a href="http://ant.apache.org/ivy" hreflang="en">Ivy</a> 2.3.0 et du tout récent <a href="http://ant.apache.org/easyant" hreflang="en">EasyAnt</a>, je vous propose de découvrir ce nouvel outil de build qui vient s'ajouter à la liste (déjà bien fournie) des outils existants.</p>
<!--more-->
<h3>Des fourmis&nbsp;?</h3> <p>Si vous faites partie de la grande majorité de développeurs Java qui utilisent <a href="http://maven.apache.org" hreflang="en">Maven</a>, et que vous n'avez jamais entendu parler d'Ant, il s'agit en fait d'un outil de build au fonctionnement radicalement différent.</p> <p>Inspiré de <a href="https://fr.wikipedia.org/wiki/Make">make</a>, Ant repose sur la notion de <em>cibles</em> (target) qui peuvent être invoquées, et qui elles-même exécutent des <em>tâches</em> (task). Les <em>cibles</em> ont des relations de dépendances entre elles, on peut donc imaginer une <em>cible</em> <code>package</code> qui dépendrait d'une autre <em>cible</em> <code>compile</code>. Dans le monde Maven, on exécute une série de <em>phases</em> dont l'ordre est prédéfini. Le point commun entre les deux, c'est qu'ils reposent sur de l'XML:</p> <pre class="xml code xml" style="font-family:inherit"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;project</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;MyProject&quot;</span> <span style="color: #000066;">default</span>=<span style="color: #ff0000;">&quot;package&quot;</span> <span style="color: #000066;">basedir</span>=<span style="color: #ff0000;">&quot;.&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span> &nbsp;   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;target</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;compile&quot;</span> <span style="color: #000066;">description</span>=<span style="color: #ff0000;">&quot;compile the source&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>     <span style="color: #808080; font-style: italic;">&lt;!-- insert tasks here --&gt;</span>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/target<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> &nbsp;   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;target</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;package&quot;</span> <span style="color: #000066;">description</span>=<span style="color: #ff0000;">&quot;create the jar&quot;</span> <span style="color: #000066;">depends</span>=<span style="color: #ff0000;">&quot;compile&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>     <span style="color: #808080; font-style: italic;">&lt;!-- insert tasks here --&gt;</span>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/target<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> &nbsp;   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;target</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;clean&quot;</span> <span style="color: #000066;">description</span>=<span style="color: #ff0000;">&quot;clean up&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>     <span style="color: #808080; font-style: italic;">&lt;!-- insert tasks here --&gt;</span>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/target<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/project<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre> <p>Dans l'exemple ci-dessus, en plus des <em>cibles</em> <code>compile</code> et <code>package</code> (dont j'ai emprunté les noms à Maven), on trouve une <em>cible</em> <code>clean</code> (convention empruntée à <em>make</em> par la communauté Ant, reprise par d'autres outils comme par exemple Maven). Cette <em>cible</em> nécessite d'être invoquée explicitement, tout comme il est possible d'invoquer un <em>goal</em> particulier avec Maven.</p> <pre> ant clean mvn clean:clean </pre> <p>L'avantage pour Maven d'avoir des phases prédéfinies est de garantir à un utilisateur connaissant l'outil de savoir construire un projet <em>"mavenisé"</em> sans connaitre les spécificités du projet:</p> <pre> mvn package </pre> <p>Avec Ant, il faut connaitre le contenu du fichier <code>build.xml</code> pour savoir comment construire un projet, et où trouver le(s) livrable(s) ensuite.</p> <h3>Poison Ivy</h3> <p>Une autre force de Maven, c'est son gestionnaire de dépendances qui manque cruellement dans Ant. Il est d'ailleurs courant d'avoir un dossier <code>lib/</code> contenant des <em>JAR</em> versionnés avec les sources!</p> <p>Ivy est un gestionnaire de dépendances compatible avec les dépôts Maven, il est utilisable de façon indépendante pour n'importe quel usage (c'est extensible). Mais Ivy, c'est aussi un sous-projet d'Ant, et un ensemble de <em>tâches</em> prêtes à l'emploi pour gérer les dépendances de projets Ant. C'est d'ailleurs un gestionnaire de dépendances qui offre bien plus de <a href="http://ant.apache.org/ivy/features.html" hreflang="en">possibilités</a> que celui de Maven (<a href="http://eclipse.org/aether/" hreflang="en">Aether</a>).</p> <p>Ivy est pas mal utilisé dans l'écosystème Java, citons:</p> <ul> <li><a href="http://groovy.codehaus.org/Grapes+and+grab()" hreflang="en">Groovy Grapes</a></li> <li><a href="http://grails.org/Ivy+Integration" hreflang="en">Grails</a></li> <li><a href="http://www.playframework.com/documentation/1.2.3/dependency" hreflang="en">Play! Framework</a></li> <li><a href="http://www.scala-sbt.org/release/docs/Getting-Started/Library-Dependencies" hreflang="en">SBT</a> (lui-même utilisé par <a href="http://www.playframework.com/documentation/2.0/SBTDependencies" hreflang="en">Play! 2</a>)</li> </ul> <p>Assez parlé d'Ivy, il s'agit tout de même d'un article sur EasyAnt.</p> <h3>Des fourmis... faciles&nbsp;?</h3> <p>EasyAnt donc vient s'ajouter aux côtés d'Ivy à la liste des <a href="http://ant.apache.org/projects/index.html" hreflang="en">sous-projets</a> Ant, mais en fait, en quoi ça consiste&nbsp;?</p> <h4>Un cycle de vie</h4> <p>Alors qu'avec Ant il faut tout faire manuellement, et le refaire à chaque projet, EasyAnt apporte des conventions à la manière de Maven, par dessus Ant. L'équivalent des <em>phases</em> Maven (<code>compile</code>, <code>test</code>, <code>package</code>...) se présente sous la forme d'<a href="http://ant.apache.org/manual/targets.html" hreflang="en">extention-points</a> apparus dans Ant 1.8.</p> <p>On peut les voir comme des <em>cibles</em> abstraites auxquelles il est possible de rattacher d'autres <em>cibles</em> concrètes (avec des <em>tâches</em>). EasyAnt standardise une suite de points d'extensions (<code>compile</code>, <code>test</code>, <code>package</code>...) auxquels des <em>cibles</em> sont greffées, un peu comme les <em>goals</em> Maven qui peuvent être attachés à des <em>phases</em>.</p> <h4>Un gestionnaire de dépendances</h4> <p>Le gestionnaire de dépendances d'EasyAnt est (roulement de tambour...) Ivy. Sauf qu'au lieu de masquer l'utilisation d'Ivy, EasyAnt va plutôt s'intégrer dedans. Un projet utilisant Ant+Ivy pourra donc migrer vers EasyAnt sans rien changer dans sa gestion des dépendances.</p> <p>La configuration d'Ivy se faisant (encore!) en XML, EasyAnt s'intègre via des balises supplémentaires déclarées dans un <em>namespace</em> <code>http://www.easyant.org</code>. Un projet contient un fichier <code>module.ivy</code> comparable au <code>pom.xml</code> de Maven:</p> <pre class="xml code xml" style="font-family:inherit"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ivy-module</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;2.0&quot;</span> <span style="color: #000066;">xmlns:ea</span>=<span style="color: #ff0000;">&quot;http://www.easyant.org&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>     <span style="color: #009900;"><span style="color: #000000; fo
nt-weight: bold;">&lt;info</span> <span style="color: #000066;">organisation</span>=<span style="color: #ff0000;">&quot;com.acme&quot;</span> <span style="color: #000066;">module</span>=<span style="color: #ff0000;">&quot;MyProject&quot;</span> <span style="color: #000066;">status</span>=<span style="color: #ff0000;">&quot;integration&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ea:build</span> <span style="color: #000066;">organisation</span>=<span style="color: #ff0000;">&quot;org.apache.easyant.buildtypes&quot;</span> <span style="color: #000066;">module</span>=<span style="color: #ff0000;">&quot;build-std-java&quot;</span> <span style="color: #000066;">revision</span>=<span style="color: #ff0000;">&quot;0.9&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/info<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;configurations<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;conf</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;default&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;conf</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;test&quot;</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/configurations<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;publications<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;artifact</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">&quot;jar&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/publications<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dependencies<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>         <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dependency</span> <span style="color: #000066;">org</span>=<span style="color: #ff0000;">&quot;junit&quot;</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;junit&quot;</span> <span style="color: #000066;">rev</span>=<span style="color: #ff0000;">&quot;4.7&quot;</span> <span style="color: #000066;">conf</span>=<span style="color: #ff0000;">&quot;test-&gt;</span></span>default&quot;/&gt;     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dependencies<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ivy-module<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre> <p>La balise <code>ea:build</code> indique à EasyAnt que l'on souhaite constuire un <em>jar</em> (via le plugin <code>build-std-java</code>).</p> <h4>Un système extensible</h4> <p>EasyAnt, qui apporte des conventions similaires à celles de Maven (et souvent compatibles, eg. <code>src/main/java</code>) repose également sur des plugins. EasyAnt ne sera donc qu'un orchestrateur qui exécutera les <em>cibles</em> des plugins qui auront été associées aux points d'extensions concernés.</p> <p>La différence notable avec Maven, c'est qu'il n'est pas nécessaire d'écrire un plugin pour effectuer une tâche qui ne serait supportée par aucun plugin. Ant étant supporté nativement, il est possible d'ajouter ses propres <em>cibles</em> dans un fichier <code>module.ant</code> à la racine du projet. Une migration d'un projet Ant ayant des <em>cibles</em> utilitaires peut donc se faire sans douleur. On dispose d'une part de conventions de <em>build</em>, et d'autre part d'une facilité de personnalisation.</p> <p>Petite note personnelle, l'écriture d'une tâche Ant est beaucoup plus simple à mettre en œuvre que l'écriture d'un plugin Maven. J'insiste, c'est beaucoup plus simple. Le ticket d'entrée d'EasyAnt par rapport à Maven sur le terrain des plugins est donc probablement bien moins élevé.</p> <h3>Conclusion</h3> <p>EasyAnt est donc le nouveau challenger de l'univers du <em>build</em>. Il vient se frotter à Maven, Gradle et les autres (sauf Ant =) en tirant parti de briques existantes et matures.</p> <p>Vous doutez de la maturité d'Ant et Ivy&nbsp;? Je vous invite à lire la documentation d'Ivy pour y trouver tout ce que Maven ne sait pas faire (au hasard, les exclusions globales). Quant à Ant, beaucoup de produits fournissent un support d'Ant (eg. <a href="http://tomcat.apache.org/tomcat-7.0-doc/api/org/apache/catalina/ant/package-summary.html" hreflang="en">Tomcat</a>) et il s'intègre à beaucoup d'autres outils de <em>build</em>:</p> <ul> <li><a href="http://maven.apache.org/plugins/maven-antrun-plugin/" hreflang="en">Maven</a></li> <li><a href="http://www.gradle.org/docs/current/userguide/tutorial_using_tasks.html#N10328" hreflang="en">Gradle</a></li> <li><a href="http://gant.codehaus.org/" hreflang="en">Gant</a></li> <li><a href="http://buildr.apache.org/rdoc/Buildr/Ant.html" hreflang="en">Buildr</a></li> <li><a href="http://watchitlater.com/blog/2011/03/jruby-rake-vs-ant/" hreflang="en">JRuby Rake</a></li> </ul> <p>EasyAnt est un projet encore jeune, qui peut paraître insignifiant face à Maven et sa pléthore de plugins. Mais EasyAnt profite de tout l'écosystème existant d'Ant pour pallier à son manque de plugins. Si vous comptez migrer d'Ant ou Ant+Ivy vers Maven, EasyAnt sera peut-être plus adapté et la solution à privilégier. Si votre projet se heurte fréquemment aux limitations de Maven, la migration vers EasyAnt pourra se faire sans trop de difficultés grâce aux conventions partagées par les deux outils.</p> <p>Pour s'imposer, je pense qu'EasyAnt devra rattraper son retard en termes d'outillage et de <a href="http://incubator.apache.org/easyant/history/trunk/reference.html" hreflang="en">documentation</a>, même si Ivy propose déjà une intégration <a href="http://ant.apache.org/ivy/ivyde/index.html" hreflang="en">Eclipse</a>. L'interopérabilité d'Ivy avec Maven est cependant un très bon point de départ. Pour en savoir plus, un <a href="http://blog.easyant.org/getting-started-with-easyant/" hreflang="en">tutoriel</a> est paru sur le blog d'EasyAnt, et <a href="http://blog.easyant.org/project-specific-logic/" hreflang="en">d'autres</a> arriveront.</p>