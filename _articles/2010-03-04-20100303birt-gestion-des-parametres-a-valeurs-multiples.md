---
ID: 210
post_title: 'BIRT : Gestion des paramètres à valeurs multiples'
author: mcalinghee
post_date: 2010-03-04 06:30:00
post_excerpt: |
  <p>Afin d'optimiser les performances, il est important de filtrer les données avant de les consommer au sein d'un rapport. BIRT propose différents niveaux de filtres&nbsp;: sur une table, une DataSet, une requête. Bien évidemment, le moyen le plus efficace est d'agir directement sur la requête afin de remonter le minimum de données possibles. Il est très facile de mettre en place des paramètres dans des rapports afin de filtrer les données au niveau de la requête.<br />
  Une illustration de cette exemple est expliquée par <a href="http://www.birt-exchange.org/blog/author/33/">Virgil Dodson</a>, évangéliste BIRT&nbsp;: <a href="http://www.birt-exchange.org/devshare/designing-birt-reports/90-birt-parameter-example/#description">BIRT Parameter Example</a><br />
  <br />
  Cependant, la mise en place d'un filtre sur plusieurs valeurs est beaucoup moins évident que sur une valeur. Nous verrons donc dans ce billet, comment mettre en place un paramètre à valeurs multiples et en fonction des valeurs sélectionnées, comment filtrer au niveau de la requête.</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=210
published: true
---
<p>Afin d'optimiser les performances, il est important de filtrer les données avant de les consommer au sein d'un rapport. BIRT propose différents niveaux de filtres&nbsp;: sur une table, une DataSet, une requête. Bien évidemment, le moyen le plus efficace est d'agir directement sur la requête afin de remonter le minimum de données possibles. Il est très facile de mettre en place des paramètres dans des rapports afin de filtrer les données au niveau de la requête.<br />
Une illustration de cette exemple est expliquée par <a href="http://www.birt-exchange.org/blog/author/33/">Virgil Dodson</a>, évangéliste BIRT&nbsp;: <a href="http://www.birt-exchange.org/devshare/designing-birt-reports/90-birt-parameter-example/#description">BIRT Parameter Example</a><br />
<br />
Cependant, la mise en place d'un filtre sur plusieurs valeurs est beaucoup moins évident que sur une valeur. Nous verrons donc dans ce billet, comment mettre en place un paramètre à valeurs multiples et en fonction des valeurs sélectionnées, comment filtrer au niveau de la requête.</p>
<!--more-->
<p>Afin de mieux comprendre ce mécanisme, nous allons établir un rapport permettant d'afficher dans un tableau des clients en fonction des pays sélectionnés. <br />
La DataSource qui sera utilisée n'est autre que celle embarquée dans le BIRT Designer&nbsp;: <strong>Classic Models Inc. Sample Database</strong><br /></p> <h2>1. Définition de la DataSet Country<br /></h2> <p><br />
Afin d'alimenter le paramètre à valeurs multiples (voir étape suivante), nous allons tout d'abord créer une DataSet "Country" permettant de renvoyer tout simplement tous les pays disponibles dans la table.<br />
<br />
<img src="/wp-content/uploads/2015/07/.DataSet_Country_m.jpg" alt="CountryDataSet" style="display:block; margin:0 auto;" title="CountryDataSet" /></p> <h2>2. Définition du paramètre à valeurs multiples<br /></h2> <p><br />
A partir de la DataSet "Country", nous allons mettre en place un paramètre "ParameterCountry" permettant de sélectionner un ou plusieurs pays parmi les pays disponibles en base.<br />
Cette DataSet va nous permettre d'alimenter la liste de sélection du "ParameterCountry". Bien entendu, il ne faut pas oublier de cocher l'option <strong>Allow Multiples Values</strong> pour autoriser la multi-sélection.<br />
<br />
<img src="/wp-content/uploads/2015/07/.CountryParameter_m.jpg" alt="CountryParameter" style="display:block; margin:0 auto;" title="CountryParameter" /></p> <h2>3. Définition de la DataSet Customers<br /></h2> <p><br />
Une fois que le paramètre "ParameterCountry" a été défini, il suffit de créer une DataSet permettant de récupérer le nom, la ville et le pays des clients stockés en base selon les pays sélectionnés du paramètre "ParameterCountry".<br />
Voici la requete permettant de récupérer les informations :<br /></p> <pre class="sql code sql" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #993333; font-weight: bold;">SELECT</span> CLASSICMODELS<span style="color: #66cc66;">.</span>CUSTOMERS<span style="color: #66cc66;">.</span>CUSTOMERNAME<span style="color: #66cc66;">,</span>CLASSICMODELS<span style="color: #66cc66;">.</span>CUSTOMERS<span style="color: #66cc66;">.</span>CITY<span style="color: #66cc66;">,</span>CLASSICMODELS<span style="color: #66cc66;">.</span>CUSTOMERS<span style="color: #66cc66;">.</span>COUNTRY</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #993333; font-weight: bold;">FROM</span> CLASSICMODELS<span style="color: #66cc66;">.</span>CUSTOMERS</div></li></ol></pre> <p>Pour prendre en compte la sélection du paramètre "ParameterCountry", il suffit d'ajouter du script au niveau de la DataSet "Customers" à l'étape <strong>beforeOpen</strong> afin de modifier la requête&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">// Recuperation de CountryParameter : join() permet de concatener </span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">// toutes les valeurs selectionnees de la selection effectuee</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">var list = params<span style="color: #000000;">&#91;</span><span style="color: #888888;">&quot;CountryParameter&quot;</span><span style="color: #000000;">&#93;</span>.<span style="color: #000000;">value</span>.<span style="color: #000000;">join</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">// On remplace les simples , par des ',' pour typer les valeurs en String</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">list = list.<span style="color: #000000;">replace</span><span style="color: #000000;">&#40;</span>/,/g,<span style="color: #888888;">&quot;','&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">// On modifie la requete afin de filtrer sur plusieurs valeurs a l'aide d'un IN</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">this</span>.<span style="color: #000000;">queryText</span> = <span style="color: #888888;">&quot;SELECT CLASSICMODELS.CUSTOMERS.CUSTOMERNAME,CLASSICMODELS.CUSTOMERS.CITY,&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">+<span style="color: #888888;">&quot;CLASSICMODELS.CUSTOMERS.COUNTRY FROM CLASSICMODELS.CUSTOMERS&quot;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">this</span>.<span style="color: #000000;">queryText</span> = <span style="color: #7F0055; font-weight: bold;">this</span>.<span style="color: #000000;">queryText</span> + <span style="color: #888888;">&quot; WHERE CLASSICMODELS.CUSTOMERS.COUNTRY IN ('&quot;</span>+list+<span style="color: #888888;">&quot;')&quot;</span>;</div></li></ol></pre> <p>Ce code permet de changer la requete avant l'ouverture de la DataSet en prenant en compte les valeurs sélectionnées de "ParameterCountry".<br />
Comme on peut le constater, on récupère le contenu de "ParameterCountry" qui est sous forme de tableau et on concatène les valeurs sélectionnées. Les valeurs sélectionnées étant des String, il nous faut mettre des quotes sur chacune de ces valeurs. Ensuite, on modifie la requête en filtrant sur les pays sélectionnés à l'aide d'un <code>IN</code>.<br />
<br />
Vous pourrez trouver en pièce jointe le rapport illustrant cet exemple.</p>