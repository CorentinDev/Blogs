---
ID: 132
post_title: Using Thymeleaf with Spring MVC
author: Arnaud Cogolu√®gnes
post_date: 2013-01-28 10:00:00
post_excerpt: |
  <p>A <a href="/index.php?post/2013/01/18/introducing-the-thymeleaf-template-engine">previous post</a> introduced the features of the <a href="http://www.thymeleaf.org/">Thymeleaf</a> template engine in a standalone environment. Even if a standalone use of Thymeleaf can make sense - e.g. for short document generation or view testing - developers usually use the template engine in a web environment. This post covers how to integrate Thymeleaf with one of the most popular Java web frameworks, Spring MVC. We'll see also how to test the controller and the view with Spring MVC test framework.</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=132
published: true
---
<p>A <a href="/index.php?post/2013/01/18/introducing-the-thymeleaf-template-engine">previous post</a> introduced the features of the <a href="http://www.thymeleaf.org/">Thymeleaf</a> template engine in a standalone environment. Even if a standalone use of Thymeleaf can make sense - e.g. for short document generation or view testing - developers usually use the template engine in a web environment. This post covers how to integrate Thymeleaf with one of the most popular Java web frameworks, Spring MVC. We'll see also how to test the controller and the view with Spring MVC test framework.</p>
<!--more-->
<h2>Thymeleaf infrastructure in Spring MVC</h2> <p>Thymeleaf comes with out-of-the-box support for Spring MVC. We just have to declare <code>ThymeleafViewResolver</code> bean, which acts as a bridge between Thymeleaf's template engine and Spring MVC's view rendering mechanism. We're using Spring Java configuration, but a traditional XML configuration would work as well:</p> <pre class="java code java" style="font-family:inherit">@Configuration <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> ContactConfiguration <span style="color: #000000;">&#123;</span> &nbsp;     @Bean <span style="color: #7F0055; font-weight: bold;">public</span> ViewResolver viewResolver<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>         ClassLoaderTemplateResolver templateResolver = <span style="color: #7F0055; font-weight: bold;">new</span> ClassLoaderTemplateResolver<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;         templateResolver.<span style="color: #000000;">setTemplateMode</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;XHTML&quot;</span><span style="color: #000000;">&#41;</span>;         templateResolver.<span style="color: #000000;">setPrefix</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;views/&quot;</span><span style="color: #000000;">&#41;</span>;         templateResolver.<span style="color: #000000;">setSuffix</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;.html&quot;</span><span style="color: #000000;">&#41;</span>;         SpringTemplateEngine engine = <span style="color: #7F0055; font-weight: bold;">new</span> SpringTemplateEngine<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;         engine.<span style="color: #000000;">setTemplateResolver</span><span style="color: #000000;">&#40;</span>templateResolver<span style="color: #000000;">&#41;</span>; &nbsp;         ThymeleafViewResolver viewResolver = <span style="color: #7F0055; font-weight: bold;">new</span> ThymeleafViewResolver<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;         viewResolver.<span style="color: #000000;">setTemplateEngine</span><span style="color: #000000;">&#40;</span>engine<span style="color: #000000;">&#41;</span>;         <span style="color: #7F0055; font-weight: bold;">return</span> viewResolver;     <span style="color: #000000;">&#125;</span> &nbsp; <span style="color: #000000;">&#125;</span></pre> <p>The <code>ThymeleafViewResolver</code> needs a <code>SpringTemplateEngine</code> instance, whose setup is the same as in <a href="/index.php?post/2013/01/18/Introducing-the-Thymeleaf-template-engine">the standalone setup</a>. Note we're using a Thymeleaf template resolver that resolves templates against the classpath.</p> <h2>The Spring MVC controller</h2> <p>Our controller is rather simple: it retrieves a list of Java objects from a backend service and put the list into the model. The list will then by available for display in the view. Here's the controller:</p> <pre class="java code java" style="font-family:inherit">@Controller <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> ContactController <span style="color: #000000;">&#123;</span> &nbsp;     @Autowired <span style="color: #7F0055; font-weight: bold;">private</span> ContactService contactService; &nbsp;     @RequestMapping<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;/contacts&quot;</span><span style="color: #000000;">&#41;</span>     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #000000;">String</span> contacts<span style="color: #000000;">&#40;</span>Model model<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>         model.<span style="color: #000000;">addAttribute</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;contacts&quot;</span>,contactService.<span style="color: #000000;">getContacts</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;         <span style="color: #7F0055; font-weight: bold;">return</span> <span style="color: #888888;">&quot;contacts&quot;</span>;     <span style="color: #000000;">&#125;</span> &nbsp; <span style="color: #000000;">&#125;</span></pre> <p>We want Spring MVC to pick up our controller and to map it against the <code>/contacts</code> URL. To do so, we add component scanning to the configuration Java class:</p> <pre class="java code java" style="font-family:inherit">@Configuration @ComponentScan<span style="color: #000000;">&#40;</span>basePackageClasses = ContactController.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> ContactConfiguration <span style="color: #000000;">&#123;</span> &nbsp;     ... &nbsp; <span style="color: #000000;">&#125;</span></pre> <p>OK, time to work on the view.</p> <h2>The template</h2> <p>Our previous Thymeleaf <a href="/index.php?post/2013/01/18/Introducing-the-Thymeleaf-template-engine">post already covered the basics of the templating language</a>. Let's build on these basics and reuse features like conditionals, iteration, and variable substitution:</p> <pre class="html code html" style="font-family:inherit"><span style="color: #00bbdd;">&lt;!DOCTYPE html SYSTEM &quot;http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring3-3.dtd&quot;&gt;</span> <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">html</span> xmlns<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;http://www.w3.org/1999/xhtml&quot;</span></span> <span style="color: #009900;">      xmlns:th<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span> <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">head</span>&gt;</span>     <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">title</span>&gt;</span>Contacts<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">title</span>&gt;</span>     <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">meta</span> <span style="color: #000066;">http-equiv</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;Content-Type&quot;</span> <span style="color: #000066;">content</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;text/html; charset=UTF-8&quot;</span> <span style="color: #66cc66;">/</span>&gt;</span> <span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">head</span>&gt;</span> <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">body</span>&gt;</span> &nbsp; <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">table</span> th:if<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;${not #lists.isEmpty(contacts)}&quot;</span>&gt;</span>     <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">tr</span>&gt;</span>         <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">th</span>&gt;</span>Firstname<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">th</span>&gt;</span>         <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">th</span>&gt;</span>Lastname<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; fo
nt-weight: bold;">th</span>&gt;</span>     <span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">tr</span>&gt;</span>     <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">tr</span> th:each<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;contact : ${contacts}&quot;</span>&gt;</span>         <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">td</span> th:<span style="color: #000066;">text</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;${contact.lastname}&quot;</span>&gt;</span>The first name<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">td</span>&gt;</span>         <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">td</span> th:<span style="color: #000066;">text</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;${contact.firstname}&quot;</span>&gt;</span>The last name<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">td</span>&gt;</span>     <span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">tr</span>&gt;</span> <span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">table</span>&gt;</span> &nbsp; <span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">body</span>&gt;</span> <span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">html</span>&gt;</span></pre> <p>That's it, we're done with the setup, the controller, and the view! In a traditional post, we would deploy the Spring MVC application in a web container to test the controller and the view rendering, but this isn't a traditional post! This other article covered how to do <a href="/index.php?post/2013/01/15/spring-mvc-test-framework">out-of-container testing</a> with <a href="/index.php?post/2013/01/15/REST-Web-Services-testing-with-Spring-MVC">Spring MVC</a>, so let's use this excellent tool for testing our Spring MVC and Thymeleaf integration.</p> <h2>The test</h2> <p>We're using JUnit 4 and Spring's TestContext framework to test our web application. The test needs some extra annotations, an initialization sequence to start the mock Spring MVC instance, and the Spring configuration. All of this fits in the test class:</p> <pre class="java code java" style="font-family:inherit">@RunWith<span style="color: #000000;">&#40;</span>SpringJUnit4ClassRunner.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span> @ContextConfiguration @WebAppConfiguration <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> SpringMvcTest <span style="color: #000000;">&#123;</span> &nbsp;     @Autowired     WebApplicationContext ctx; &nbsp;     MockMvc mvc; &nbsp;     @Before <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> setUp<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> <span style="color: #000000;">Exception</span> <span style="color: #000000;">&#123;</span>         mvc = webAppContextSetup<span style="color: #000000;">&#40;</span>ctx<span style="color: #000000;">&#41;</span>.<span style="color: #000000;">build</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;     <span style="color: #000000;">&#125;</span> &nbsp;     @Test     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> contact<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> <span style="color: #000000;">Exception</span> <span style="color: #000000;">&#123;</span> &nbsp;     <span style="color: #000000;">&#125;</span> &nbsp;     @Configuration     @<span style="color: #a1a100;">import(ContactConfiguration.class)</span>     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">class</span> TestConfiguration <span style="color: #000000;">&#123;</span> &nbsp;         @Bean         <span style="color: #7F0055; font-weight: bold;">public</span> ContactService contactService<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>             <span style="color: #7F0055; font-weight: bold;">return</span> <span style="color: #7F0055; font-weight: bold;">new</span> StubContactService<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;         <span style="color: #000000;">&#125;</span> &nbsp;     <span style="color: #000000;">&#125;</span> &nbsp; <span style="color: #000000;">&#125;</span></pre> <p>There are 3 parts in the test class:</p> <ul> <li>The test setup, with the <code>@RunWith</code>, <code>@ContextConfiguration</code>, <code>@WebAppConfiguration</code> annotations, and the creation of the <code>MockMvc</code> object.</li> <li>The test method, empty for now.</li> <li>The Spring configuration, as a <code>@Configuration</code> static inner class. Note this class imports our main, application-specific <code>ContactConfiguration</code> class and register a stub for the backend service.</li> </ul> <p>This is enough to check the setup of our web application: you can launch the test and should get a green bar.</p> <p>Let's simulate a request on our controller and check the content of the rendered view:</p> <pre class="java code java" style="font-family:inherit">@Test <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> contact<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> <span style="color: #000000;">Exception</span> <span style="color: #000000;">&#123;</span>     mvc.<span style="color: #000000;">perform</span><span style="color: #000000;">&#40;</span>get<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;/contacts&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>         .<span style="color: #000000;">andDo</span><span style="color: #000000;">&#40;</span>print<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>; <span style="color: #000000;">&#125;</span></pre> <p>By launching the test, you get something like the following on the console:</p> <pre> MockHttpServletRequest:          HTTP Method = GET          Request URI = /contacts           Parameters = {}              Headers = {}              Handler:                 Type = com.zenika.web.ContactController                Async:    Was async started = false         Async result = null   Resolved Exception:                 Type = null         ModelAndView:            View name = contacts                 View = null            Attribute = contacts                value = [com.zenika.Contact@605b28c9, com.zenika.Contact@d2d58b]             FlashMap: MockHttpServletResponse:               Status = 200        Error message = null              Headers = {Content-Type=[text/html;charset=ISO-8859-1]}         Content type = text/html;charset=ISO-8859-1                 Body = &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt; &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt; &lt;head&gt;     &lt;title&gt;Contacts&lt;/title&gt;
   &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt; &lt;/head&gt; &lt;body&gt; &lt;table&gt;     &lt;tr&gt;         &lt;th rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Firstname&lt;/th&gt;         &lt;th rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Lastname&lt;/th&gt;     &lt;/tr&gt;     &lt;tr&gt;         &lt;td rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Doe&lt;/td&gt;         &lt;td rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;John&lt;/td&gt;     &lt;/tr&gt;&lt;tr&gt;         &lt;td rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Doe&lt;/td&gt;         &lt;td rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Jane&lt;/td&gt;     &lt;/tr&gt; &lt;/table&gt; &lt;/body&gt; &lt;/html&gt;        Forwarded URL = null       Redirected URL = null              Cookies = [] </pre> <p>Looks like our stub backend service returns the Doe couple. We can add the following expectations to our test:</p> <pre class="java code java" style="font-family:inherit">@Test <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> contact<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> <span style="color: #000000;">Exception</span> <span style="color: #000000;">&#123;</span>     mvc.<span style="color: #000000;">perform</span><span style="color: #000000;">&#40;</span>get<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;/contacts&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>         .<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>status<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">isOk</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>         .<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>content<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">string</span><span style="color: #000000;">&#40;</span>containsString<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;John&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>         .<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>content<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">string</span><span style="color: #000000;">&#40;</span>containsString<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Jane&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>; <span style="color: #000000;">&#125;</span></pre> <p>That's it, we successfully integrated Thymeleaf with Spring MVC and tested the integration without even starting a web container.</p> <h2>Conclusion</h2> <p>Thymeleaf provides first-class support for Spring MVC. This article covered the basic integration, thanks to the <code>ThymeleafViewResolver</code>. By using Thymeleaf in your Spring MVC application, you get all the features of this templating engine: powerful templating language, no JSP compiler, fast rendering thanks to template caching, etc. Note the integration with Spring MVC doesn't stop here: Thymeleaf also supports form rendering and binding, to write interactive web application.</p> <p><a href="https://github.com/acogoluegnes/blog-thymeleaf">Source code</a></p>