---
ID: 80
post_title: >
  REST avec Spring 3.0 et Solr (1ère
  partie)
author: Arnaud Cogoluègnes
post_date: 2009-12-23 13:28:00
post_excerpt: "<p>Spring 3.0 introduit un support serveur et client pour REST. Nous allons illustrer l'utilisation de ce support dans une série d'articles. Afin de pimenter tout cela, les données manipulées seront récupérées depuis une instance de Solr, le serveur d'indexation basé sur Lucene.</p>"
layout: post
permalink: http://blog.zenika-offres.com/?p=80
published: true
---
<p>Spring 3.0 introduit un support serveur et client pour REST. Nous allons illustrer l'utilisation de ce support dans une série d'articles. Afin de pimenter tout cela, les données manipulées seront récupérées depuis une instance de Solr, le serveur d'indexation basé sur Lucene.</p>
<!--more-->
<h2>Le cas d'utilisation</h2> <p>Notre application Web va exposer des services REST pour que l'on puisse accéder à ses données. Le contrôleur REST délègue les requêtes à un serveur d'indexation dédié, Solr, interrogé avec une API Java, sur HTTP. La figure suivante représente cette architecture.</p> <p><img src="/wp-content/uploads/2015/07/solr-spring.png" alt="Architecture REST Spring/Solr" style="display:block; margin:0 auto;" title="Architecture REST Spring/Solr" /></p> <p>Pourquoi voulons-nous mettre un contrôleur REST devant le serveur d'indexation, puisque celui-ci propose finalement le même genre d'interface (HTTP/XML)&nbsp;? Il peut y avoir de nombreuses raisons à cela&nbsp;:</p> <ul> <li>encapsulation&nbsp;: le contrôleur REST se comporte en fournisseur de services et il est complétement sous notre contrôle, nous pouvons donc définir un contrat et nous débrouiller pour le maintenir, que la technologie sous-jacente soit Solr ou autre chose. Bref, le contrôleur REST permettra d'absorber toute modification de notre entrepôt de données. On peut faire une analogie avec un DAO qui masque la technologie de persistance sous-jacente avec une interface Java bien définie.</li> <li>sécurité&nbsp;: le serveur Solr peut ne pas être accessible depuis l'extérieur, le contrôleur fait alors office de proxy. Le serveur Solr expose aussi de nombreux services, notamment la possibilité d'effacer des données. Le contrôleur peut donc n'exposer que les services nécessaires ou imposer des restrictions d'accès (le contrôleur REST est plus facile à sécuriser que Solr).</li> </ul> <p>Voilà pour le cas d'utilisation, commençons immédiatement par installer et démarrer le serveur Solr.</p> <h2>Le serveur Solr</h2> <p><a href="http://lucene.apache.org/solr/">Solr</a> est un serveur d'indexation basé sur <a href="http://lucene.apache.org/">Lucene</a>. Il donne une dimension "entreprise" à Lucene&nbsp;: accès par HTTP, optimisation des index automatique, gestion des accès concurrents, etc. Solr peut être téléchargé depuis <a href="http://lucene.apache.org/solr/">son site</a>. Nous utilisons ici la version 1.4. Une fois l'archive téléchargée, la décompresser dans un répertoire. Nous allons lancer le serveur Solr, qui utilise par défaut le conteneur Web Jetty. Ouvrir une ligne de commande et aller dans le répertoire <code>example</code> de l'installation. Lancer ensuite le serveur avec la commande suivante&nbsp;:</p> <pre>/solr/example$ java -jar start.jar</pre> <p>Le serveur Jetty se lancer alors sur le port 8983. Il faut mettre un peu de contenu dans le serveur avant de pouvoir l'exploiter, nous allons donc indexer quelques documents fournis dans la distribution. Ouvrir une ligne de commande dans le répertoire <code>example/exampledocs</code> de la distribution et lancer la commande suivante&nbsp;:</p> <pre>/solr/example/exampledocs$ java -jar post.jar *.xml</pre> <p>Solr propose une interface d'administration permettant d'effectuer des requêtes&nbsp;: http://localhost:8983/solr/admin/.</p> <p><a href="/wp-content/uploads/2015/07/admin-solr.png"><img src="/wp-content/uploads/2015/07/.admin-solr_s.jpg" alt="Administration de Solr" title="Administration de Solr" /></a></p> <p>Par défaut, le formulaire de requête contient "solr". Lancer la recherche en appuyant sur le bouton "Search". On obtient alors une réponse XML, qui contient en entête des détails sur la requête (paramètres, temps d'exécution, etc.) et les résultats retournés, dans notre cas un document qui contient le mot "solr" dans un de ces champs.</p> <p><a href="/wp-content/uploads/2015/07/solr-query.png"><img src="/wp-content/uploads/2015/07/.solr-query_s.jpg" alt="Résultat de requête Solr" title="Résultat de requête Solr" /></a></p> <p>Nous verrons dans la seconde partie comment attaquer le serveur Solr depuis un contrôleur REST Spring 3.0 avec le client Java SolrJ. La troisième partie sera consacrée à l'accès au contrôleur REST avec le support REST client de Spring 3.0, le <code>RestTemplate</code>. Bonnes fêtes&nbsp;!</p>