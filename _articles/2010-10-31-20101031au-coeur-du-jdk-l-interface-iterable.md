---
ID: 91
post_title: 'Au coeur du JDK : l&#039;interface Iterable'
author: ocroisier
post_date: 2010-10-31 16:56:00
post_excerpt: |
  <p>Connaissez-vous l'interface <code>java.lang.Iterable</code> ?<br />
  Mais si, vous la connaissez&nbsp;: vous l'utilisez tous les jours, lorsque vous parcourez une Collection. Hé bien, voyons maintenant comment vous pouvez l'utiliser à votre avantage lorsque vous concevez un modèle objet.</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=91
published: true
---
<p>Connaissez-vous l'interface <code>java.lang.Iterable</code> ?<br />
Mais si, vous la connaissez&nbsp;: vous l'utilisez tous les jours, lorsque vous parcourez une Collection. Hé bien, voyons maintenant comment vous pouvez l'utiliser à votre avantage lorsque vous concevez un modèle objet.</p>
<!--more-->
<h4>Iterable, mode d'emploi</h4> <p>L'interface <code>Iterable</code> signale que la classe qui l'implémente est composée d'un ensemble de sous-éléments que le code appelant peut parcourir. <br />
Elle déclare pour cela une unique méthode iterator(), devant renvoyer un <code>Iterator</code> sur l'ensemble des sous-éléments.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">interface</span> Iterable<span style="color: #000000;">&lt;</span>T<span style="color: #000000;">&gt;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #808080; font-style: italic;">/**</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">&nbsp;    * Returns an iterator over a set of elements of type T.</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">&nbsp;    * @return an Iterator.</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">&nbsp;    */</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    Iterator<span style="color: #000000;">&lt;</span>T<span style="color: #000000;">&gt;</span> iterator<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>L'interface <code>java.util.Collection</code> étend <code>Iterable</code>, ce qui nous autorise à parcourir ses implémentations (notamment <code>List</code> et <code>Set</code>) de manière uniforme&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">List<span style="color: #000000;">&lt;</span>String<span style="color: #000000;">&gt;</span> words = <span style="color: #000000;">Arrays</span>.<span style="color: #000000;">asList</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Hello&quot;</span>, <span style="color: #888888;">&quot;World&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">Iterator<span style="color: #000000;">&lt;</span>String<span style="color: #000000;">&gt;</span> it = words.<span style="color: #000000;">iterator</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055;font-weight: bold;">while</span><span style="color: #000000;">&#40;</span>it.<span style="color: #000000;">hasNext</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">System</span>.<span style="color: #000000;">out</span>.<span style="color: #000000;">println</span><span style="color: #000000;">&#40;</span>it.<span style="color: #000000;">next</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>C'est également Iterable qui vous permet d'utiliser la boucle "foreach" apparue avec Java 5 (<a href="http://java.sun.com/docs/books/jls/third_edition/html/statements.html#14.14.2">JLS $14.14.2</a>).</p> <blockquote><p>EnhancedForStatement:<br />
for ( VariableModifiersopt Type Identifier: Expression) Statement</p> <p> The Expression must either have type Iterable or else it must be of an array type (§10.1), or a compile-time error occurs.</p></blockquote> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">List<span style="color: #000000;">&lt;</span>String<span style="color: #000000;">&gt;</span> words = <span style="color: #000000;">Arrays</span>.<span style="color: #000000;">asList</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Hello&quot;</span>, <span style="color: #888888;">&quot;World&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span> word : words<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">System</span>.<span style="color: #000000;">out</span>.<span style="color: #000000;">println</span><span style="color: #000000;">&#40;</span>word<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <h4>Implémenter Iterable dans votre code</h4> <p>Lorsque nous concevons un modèle objet, il arrive fréquemment que nous devions modéliser des relations de type "1-N avec attributs". Leur implémentation la plus évidente est une classe possédant possédant des champs correspondant aux attributs de la relation, ainsi qu'une collection encapsulant les sous-éléments.</p> <p>Une partition musicale en est un bon exemple&nbsp;: elle est constituée d'une séquence de notes (les sous-éléments), ainsi que de divers attributs comme le nom du morceau.</p> <p>En voici une implémentation naïve&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> Partition <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #000000;">String</span> nom;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">private</span> List<span style="color: #000000;">&lt;</span>Note<span style="color: #000000;">&gt;</span> notes;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #000000;">String</span> getNom<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">return</span> nom;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> setNom<span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span> nom<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">this</span>.<span style="color: #000000;">nom</span> = nom;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> List<span style="color: #000000;">&lt;</span>Note<span style="color: #000000;">&gt;</span> getNotes<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">return</span> notes;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> setNotes<span style="color: #000000;">&#40;</span>List<span style="color: #000000;">&lt;</span>Note<span style="color: #000000;">&gt;</span> notes<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">this</span>.<span style="color: #000000;">notes</span> = notes;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>Ce type d'implémentation est très répandu, mais malheureusement très mauvais du point de vue de la conception objet, car <a href="/index.php?post/2009/03/15/Collection-accessors-considered-harmful">il rompt le principe d'encapsulation</a>&nbsp;: l'accesseur de la liste
des notes permet de modifier celle-ci sans que la <code>Partition</code> ne soit avertie, et expose son implémentation interne.</p> <p>Il faut donc trouver un moyen pour autoriser le développeur à parcourir la liste sans l'exposer directement.<br />
C'est là qu'intervient l'interface Iterable.</p> <p>Voici le code remanié&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> Partition <span style="color: #7F0055; font-weight: bold;">implements</span> Iterable<span style="color: #000000;">&lt;</span>Note<span style="color: #000000;">&gt;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">final</span> <span style="color: #000000;">String</span> nom;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">final</span> List<span style="color: #000000;">&lt;</span>Note<span style="color: #000000;">&gt;</span> notes = <span style="color: #7F0055; font-weight: bold;">new</span> ArrayList<span style="color: #000000;">&lt;</span>Note<span style="color: #000000;">&gt;</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> Partition<span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span> nom, List<span style="color: #000000;">&lt;</span>Note<span style="color: #000000;">&gt;</span> notes<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">this</span>.<span style="color: #000000;">nom</span> = nom;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>notes <span style="color: #000000;">!</span>= <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #7F0055; font-weight: bold;">this</span>.<span style="color: #000000;">notes</span>.<span style="color: #000000;">addAll</span><span style="color: #000000;">&#40;</span>notes<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #000000;">String</span> getNom<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">return</span> nom;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> Iterator<span style="color: #000000;">&lt;</span>Note<span style="color: #000000;">&gt;</span> iterator<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">return</span> notes.<span style="color: #000000;">iterator</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>Ce remaniement amène un second bénéfice, pour l'utilisateur cette fois&nbsp;: il est beaucoup plus facile et naturel de parcourir la partition, note par note.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">Partition partition = <span style="color: #7F0055; font-weight: bold;">new</span> Partition<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Au clair de la lune&quot;</span>, <span style="color: #000000;">Arrays</span>.<span style="color: #000000;">asList</span><span style="color: #000000;">&#40;</span>C, C, C, D, E, D, C, E, D, D, C<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055;font-weight: bold;">for</span><span style="color: #000000;">&#40;</span>Note note : partition<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #808080; font-style: italic;">//Instrument.play(note);</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <h4>Conclus
ion</h4> <p>En conclusion, lorsque vous encapsulez une collection au sein d'une classe, pensez à l'interface <code>Iterable</code>&nbsp;; votre code sera mieux encapsulé et plus facile à utiliser&nbsp;!</p>