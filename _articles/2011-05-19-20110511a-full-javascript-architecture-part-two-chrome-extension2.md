---
ID: 192
post_title: 'A Full Javascript Architecture, Part Two &#8211; Chrome Extension'
author: nletaifa
post_date: 2011-05-19 10:55:00
post_excerpt: '<p><a href="http://blog.zenika.com/index.php?post/2011/04/10/NodeJS">In the first part</a> of this series we saw how to create a simple Node server which tracks and broadcast tweets about the What’s Next event in real time.</p> <p>In this one we’ll see how to develop a Google Chrome extension that will display the tweets thanks to the HTML5 notification API. The extension will also use the Local Storage API and the Socket.IO client side library.</p>'
layout: post
permalink: http://blog.zenika-offres.com/?p=192
published: true
---
<p><a href="http://blog.zenika.com/index.php?post/2011/04/10/NodeJS">In the first part</a> of this series we saw how to create a simple Node server which tracks and broadcast tweets about the What’s Next event in real time.</p> <p>In this one we’ll see how to develop a Google Chrome extension that will display the tweets thanks to the HTML5 notification API. The extension will also use the Local Storage API and the Socket.IO client side library.</p>
<!--more-->
<br/> <p><img src="/wp-content/uploads/2015/07/node-chrome-2.jpg" alt="node-chrome2" style="display:block; margin:0 auto;" title="node-chrome2" /></p> <h2>Google Chrome Extensions</h2> <br/> <p>Google Chrome extensions are very easy to develop and have a good <a href="http://code.google.com/chrome/extensions/overview.html">documentation</a> to rely on.</p> <p>With extensions you can interact with web pages, tabs, bookmarks and servers. To develop one, you simply need to use a set of HTML, CSS and JavaScript files. There is no other language needed, UI side included.</p> <p>Just like a Chrome tab, extensions run in different processes to avoid taking down other extensions or the browser itself when an extension crashes.</p> <h3>Extensions Architecture</h3> <p>A Chrome extension is based on a <strong>manifest</strong> file that describe it's architecture with Json encoded data. The <strong>manifest.json</strong> will be filled differently depending on what kind of functionalities an extension will use. Here is the basic one, only the <strong>name</strong> and <strong>version</strong> fields are required :</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #009900;">&#123;</span>   <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;My First Extension&quot;</span><span style="color: #339933;">,</span>   <span style="color: #3366CC;">&quot;version&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;1.0&quot;</span><span style="color: #339933;">,</span>   <span style="color: #3366CC;">&quot;description&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;The first extension that I made.&quot;</span>   <span style="color: #3366CC;">&quot;background_page&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;background.html&quot;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#125;</span></pre> <p>In the manifest.json you declare the name, version and description for your extension. What you also need to declare is the <strong>background page</strong>. The background page is the one that will hold the extension logic and will be executed when you lunch the browser or add the extension.</p> <h2>The What’s Next Extension</h2> <h3>Prerequisites</h3> <p>First thing we need to do is to create the folder that will hold our extension. Create a folder named <strong>wsn</strong> and put in it the folders <strong>pics</strong> and <strong>style</strong> which contain the elements we will use for the UI. You can grab all the resources from the <a href="http://github.com/Zenika/WsN-Chrome">github repository</a> dedicated to this post.</p> <pre> - wsn      |-- pics             |-- wsn.png             |-- zenika-full.gif             |-- zenika-small.png      |-- style             |-- style.css </pre> <h3>The Manifest</h3> <p>Let’s create the <strong>manifest.json</strong> file for our extension.</p> <pre> - wsn      |-- pics      |-- style      |-- manifest.json </pre> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #009900;">&#123;</span> 	<span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;What's Next Paris - Live !&quot;</span><span style="color: #339933;">,</span> &nbsp; 	<span style="color: #3366CC;">&quot;version&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;1.0&quot;</span><span style="color: #339933;">,</span> &nbsp; 	<span style="color: #3366CC;">&quot;description&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Follow The What's Next Paris Tweets&quot;</span><span style="color: #339933;">,</span> &nbsp; 	<span style="color: #3366CC;">&quot;background_page&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;background.html&quot;</span><span style="color: #339933;">,</span> &nbsp; 	<span style="color: #3366CC;">&quot;permissions&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span> 		<span style="color: #3366CC;">&quot;notifications&quot;</span> 	<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> &nbsp; 	<span style="color: #3366CC;">&quot;browser_action&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span> 		<span style="color: #3366CC;">&quot;default_icon&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;pics/zenika-small.png&quot;</span><span style="color: #339933;">,</span> 		<span style="color: #3366CC;">&quot;popup&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;popup.html&quot;</span> 	<span style="color: #009900;">&#125;</span> &nbsp; <span style="color: #009900;">&#125;</span></pre> <p>As you can see, our extension name is “<strong>What’s Next Paris - Live !</strong>” and we set the version to be 1.0. We also set the<strong> background page</strong> name and add the “<strong>permissions</strong>” and “<strong>browser_action</strong>” sections:</p> <ul> <li><strong>permissions</strong></li> </ul> <p>The permission field is used to configure the privileges that our extension requires. In our case we only need the permission to display notifications so we set “<strong>notification</strong>” in the array to gain access to this api. You can find more about permissions needed for other API <a href="http://code.google.com/chrome/extensions/manifest.html#permissions">here</a></p> <ul> <li><strong>browser_action</strong></li> </ul> <p>The browser_action field allow us to add a button to the chrome user interface. The added  icon will take the appearance of the one provided by the “<em>default_icon</em>” parameter. It needs to be present otherwise your extension will not start.</p> <br/> <p><img src="/wp-content/uploads/2015/07/browser-action.png" alt="browser-action" style="display:block; margin:0 auto;" title="browser-action" /></p> <br/> <p>The “<em>popup</em>” parameter define the html page that will be opened when we click on the browser action icon. We will use this popup to display the last five  tweets received and to allow the users to disable tweet notifications.</p> <br/> <p><img src="/wp-content/uploads/2015/07/simple-popup.png" alt="simple-popup" style="display:block; margin:0 auto;" title="simple-popup" /></p> <h3>The Background Page</h3> <p>The background page is the center of the extension. It runs in the extension process and exists for the lifetime of our extension. Only one instance of it at a time is active. This is where we are going to establish the connection between the extension and the Node server.</p> <p>The logic it contains is quite simple and is divided as :</p> <ul> <li>1 - <strong>Include the Socket.IO library.</strong></li> </ul> <p>The library is included with the common &lt;script src=”...”&gt;&lt;/script&gt; tag, you don’t need to make the script available yourself since using the Socket.IO library on the server side does it for you. To make sure you can access it try browsing <em>http://yourserver:port/socket.io/socket.io.js</em></p> <ul> <li>2 - <strong>Initialize the socket and connect to the Node server.</strong></li> </ul> <p>To initialize a new connection we create a new Socket.IO object with the host and port of the Node server as parameters. The initialization part also include the tweet <em>news</em> counter and the <em>tweets</em> array where we they will be stored.</p> <ul> <li>3 - <strong>Wait for incoming messages</strong></li> </ul> <p>Once the connection established, we listen for the “<strong>message</strong>” event that will be fired each time a new tweet is received by the socket. This is like when we were waiting for the “<strong>tweet</strong>” event back on the server side.</p> <ul> <li>4 - <strong>Store and display the tweet.</strong></li> </ul> <p>When a new tweet comes in, we store it in an array
 before displaying it to the user.</p> <br/> <p>To create a notification we just need to call the <strong>createHTMLNotification()</strong> method (with the popup template in parameter) and call the <strong>show()</strong> method to render it. To close the popup we use a five second timeout and use the <strong>cancel()</strong> method. Users will be able to disable the notifications, in that case they will  will be notified for a new tweet by a small counter of unread tweets visible on the extension’s icon. This behavior is implemented by the badge functionality with a call to <strong>chrome.browserAction.setBadgeText()</strong> method. When a user will click on the icon to see the news, the badge counter will be reinitialized.</p> <br/> <p><img src="/wp-content/uploads/2015/07/badge.png" alt="badge" style="display:block; margin:0 auto;" title="badge" /></p> <br/> <p>Create the <strong>background.html</strong> page and add the following content:</p> <pre> - wsn      |-- pics      |-- style      |-- manifest.json      |-- background.html </pre> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #339933;">&lt;</span>script src<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;http://hostname:8124/socket.io/socket.io.js&quot;</span><span style="color: #339933;">&gt;&lt;/</span>script<span style="color: #339933;">&gt;</span> &nbsp; <span style="color: #339933;">&lt;</span>script<span style="color: #339933;">&gt;</span> &nbsp; <span style="color: #006600; font-style: italic;">// Server configuration</span> <span style="color: #003366; font-weight: bold;">var</span> SERVER_HOST <span style="color: #339933;">=</span> <span style="color: #3366CC;">'hostname'</span>; <span style="color: #003366; font-weight: bold;">var</span> SERVER_PORT <span style="color: #339933;">=</span> <span style="color: #CC0000;">8124</span>; &nbsp; <span style="color: #006600; font-style: italic;">// Nofication display time in ms.</span> <span style="color: #003366; font-weight: bold;">var</span> NOTIFICATION_DISPLAY_TIME <span style="color: #339933;">=</span> <span style="color: #CC0000;">5000</span>; &nbsp; <span style="color: #006600; font-style: italic;">// Regular expression to catch links in tweets.</span> <span style="color: #003366; font-weight: bold;">var</span> EXP <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> RegExp<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'(http://[a-zA-Z0-9./-]+)'</span><span style="color: #339933;">,</span><span style="color: #3366CC;">'gi'</span><span style="color: #009900;">&#41;</span>; <span style="color: #003366; font-weight: bold;">var</span> LINK <span style="color: #339933;">=</span> <span style="color: #3366CC;">'&lt;a href=&quot;$1&quot; target=&quot;_blank&quot;&gt;$1&lt;/a&gt;'</span>; &nbsp; <span style="color: #006600; font-style: italic;">// Store the last weet received.</span> <span style="color: #003366; font-weight: bold;">var</span> tweet; &nbsp; <span style="color: #006600; font-style: italic;">// Store the five last received.</span> <span style="color: #003366; font-weight: bold;">var</span> tweets <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span>; &nbsp; <span style="color: #006600; font-style: italic;">// Counter to store and display the number of new tweets when notifications are disabled.</span> <span style="color: #003366; font-weight: bold;">var</span> news <span style="color: #339933;">=</span> 0; &nbsp; <span style="color: #006600; font-style: italic;">// Socket.IO client creation and connection with Node server.</span> <span style="color: #003366; font-weight: bold;">var</span> socket <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> io.<span style="color: #660066;">Socket</span><span style="color: #009900;">&#40;</span>SERVER_HOST<span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> port <span style="color: #339933;">:</span> SERVER_PORT <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; &nbsp; socket.<span style="color: #660066;">connect</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>; &nbsp; <span style="color: #006600; font-style: italic;">// Listening to the 'message' event, it will be fired</span> <span style="color: #006600; font-style: italic;">// each time our Node server send us a new tweet.</span> socket.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'message'</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> &nbsp; 	<span style="color: #006600; font-style: italic;">// Parsing the data to make a json object</span> 	tweet <span style="color: #339933;">=</span> JSON.<span style="color: #660066;">parse</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span>; &nbsp; 	<span style="color: #006600; font-style: italic;">// Converting links in links...</span> 	tweet.<span style="color: #660066;">text</span> <span style="color: #339933;">=</span> tweet.<span style="color: #660066;">text</span>.<span style="color: #660066;">replace</span><span style="color: #009900;">&#40;</span>EXP<span style="color: #339933;">,</span> LINK<span style="color: #009900;">&#41;</span> &nbsp; 	<span style="color: #006600; font-style: italic;">// Storing only the five last tweet to display them in the popup</span> 	<span style="color: #000066; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>tweets.<span style="color: #660066;">length</span> <span style="color: #339933;">==</span> <span style="color: #CC0000;">5</span><span style="color: #009900;">&#41;</span> 		tweets.<span style="color: #660066;">pop</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>; 	tweets.<span style="color: #660066;">unshift</span><span style="color: #009900;">&#40;</span>tweet<span style="color: #009900;">&#41;</span>; &nbsp; 	<span style="color: #006600; font-style: italic;">// Counter incrementation</span> 	news++; &nbsp; 	<span style="color: #006600; font-style: italic;">// Display the notification if the user allow it or update</span> 	<span style="color: #006600; font-style: italic;">// the counter to alert the user.</span> 	<span style="color: #000066; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>window.<span style="color: #660066;">localStorage</span>.<span style="color: #660066;">noticationEnable</span> <span style="color: #339933;">==</span> <span style="color: #3366CC;">'true'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 		<span style="color: #003366; font-weight: bold;">var</span> notification <span style="color: #339933;">=</span> webkitNotifications.<span style="color: #660066;">createHTMLNotification</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;notification.html&quot;</span><span style="color: #009900;">&#41;</span>; 		notification.<span style="color: #660066;">show</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>; 		<span style="color: #006600; font-style: italic;">// Hide the notification after the configured duration.</span> 		setTimeout<span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> notification.<span style="color: #660066;">cancel</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>; tweet <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">null</span>; <span style="color: #009900;">&#125;</span><span style="col
or: #339933;">,</span> NOTIFICATION_DISPLAY_TIME<span style="color: #009900;">&#41;</span>; 	<span style="color: #009900;">&#125;</span><span style="color: #000066; font-weight: bold;">else</span><span style="color: #009900;">&#123;</span>         <span style="color: #006600; font-style: italic;">// Set the text layered on the icon</span> 		chrome.<span style="color: #660066;">browserAction</span>.<span style="color: #660066;">setBadgeText</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span> text <span style="color: #339933;">:</span> news <span style="color: #339933;">+</span> <span style="color: #3366CC;">&quot;&quot;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 	<span style="color: #009900;">&#125;</span> &nbsp; <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; &nbsp; <span style="color: #006600; font-style: italic;">// Reset the badge counter when a user click on the browser action icon.</span> <span style="color: #003366; font-weight: bold;">function</span> resetBadgeText<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 	news <span style="color: #339933;">=</span> 0; 	chrome.<span style="color: #660066;">browserAction</span>.<span style="color: #660066;">setBadgeText</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span> text <span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;&quot;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; <span style="color: #009900;">&#125;</span> <span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span></pre> <h3>The Notification</h3> <p>Chrome offers two type of notifications in its API, <strong>simple text</strong> and <strong>html</strong>. We'll use html because it allows the use of links and it remains the most elegant solution.</p> <p>Here is what our notification will look like :</p> <br/> <p><img src="/wp-content/uploads/2015/07/notification.png" alt="notification" style="display:block; margin:0 auto;" title="notification" /></p> <br/> <p>Create the <strong>notification.html</strong> file and add the following content:</p> <pre> - wsn      |-- pics      |-- style      |-- manifest.json      |-- background.html      |-- notification.html </pre> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #339933;">&lt;</span>html<span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;</span>head<span style="color: #339933;">&gt;</span> 	<span style="color: #339933;">&lt;</span>link href<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;style/style.css&quot;</span> rel<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;stylesheet&quot;</span> type<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;text/css&quot;</span><span style="color: #339933;">&gt;</span> 	<span style="color: #339933;">&lt;</span>script<span style="color: #339933;">&gt;</span> 		<span style="color: #006600; font-style: italic;">// We retrieve the new tweet from the background page.</span> 		<span style="color: #003366; font-weight: bold;">var</span> tweet <span style="color: #339933;">=</span> chrome.<span style="color: #660066;">extension</span>.<span style="color: #660066;">getBackgroundPage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">tweet</span>; 	<span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;/</span>head<span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;</span>body<span style="color: #339933;">&gt;</span> 	<span style="color: #339933;">&lt;</span>div id<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;notification&quot;</span><span style="color: #339933;">&gt;</span> 		<span style="color: #339933;">&lt;</span>div id<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;picture&quot;</span><span style="color: #339933;">&gt;</span> 			<span style="color: #339933;">&lt;</span>script<span style="color: #339933;">&gt;</span>document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;img src=&quot;'</span> <span style="color: #339933;">+</span> tweet.<span style="color: #660066;">picture</span> <span style="color: #339933;">+</span> <span style="color: #3366CC;">'&quot; /&gt;'</span><span style="color: #009900;">&#41;</span>;&lt;/script<span style="color: #339933;">&gt;</span> 		<span style="color: #339933;">&lt;/</span>div<span style="color: #339933;">&gt;</span> 		<span style="color: #339933;">&lt;</span>div id<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;content&quot;</span><span style="color: #339933;">&gt;</span> 			<span style="color: #339933;">&lt;</span>div id<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;user&quot;</span><span style="color: #339933;">&gt;</span> 				<span style="color: #339933;">&lt;</span>script<span style="color: #339933;">&gt;</span>                                 document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;a href=&quot;http://twitter.com/'</span> <span style="color: #339933;">+</span> tweet.<span style="color: #660066;">user</span> <span style="color: #339933;">+</span> <span style="color: #3366CC;">'&quot; target=&quot;_blank&quot;&gt;@'</span> <span style="color: #339933;">+</span> tweet.<span style="color: #660066;">user</span> <span style="color: #339933;">+</span> <span style="color: #3366CC;">'&lt;/a&gt;'</span><span style="color: #009900;">&#41;</span>;                                 <span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span> 			<span style="color: #339933;">&lt;/</span>div<span style="color: #339933;">&gt;</span> 			<span style="color: #339933;">&lt;</span>div id<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;tweet&quot;</span><span style="color: #339933;">&gt;</span> 				<span style="color: #339933;">&lt;</span>script<span style="color: #339933;">&gt;</span>document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span>tweet.<span style="color: #660066;">text</span><span style="color: #009900;">&#41;</span>;&lt;/script<span style="color: #339933;">&gt;</span> 			<span style="color: #339933;">&lt;/</span>div<span style="color: #339933;">&gt;</span> 		<span style="color: #339933;">&lt;/</span>div<span style="color: #339933;">&gt;</span> 		<span style="color: #339933;">&lt;</span>div style<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;clear:left;&quot;</span><span style="color: #339933;">&gt;&lt;/</span>div<span style="color: #339933;">&gt;</span> 	<span style="color: #339933;">&lt;/</span>div<span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;/</span>body<span style="color: #339933;">&gt;</span> <span style="color: #339933;">&lt;/</span>html<span style="color: #339933;">&gt;</span></pre> <p>The most important thing in this is the use of  the chrome.extension.getBackgroundPage() method provided by the API to access an object located in the background page.</p> <h3>The Popup</h3> <p>By clicking on the browser action icon, users can view the last five tweets in a popup page previously defined in the manifest.json. Just like we did in the <em>notification.html</em> file, we are going to use the <em>chrome.extension.getBackgroundPage()</em> to retrieve the array of tweets and iterate over it to display them.</p> <p>The popup is also the place where users will be able to switch off notifications, for that we are going to use the <strong>localStorage</strong> API. Thanks to the API, user’s preference is sa
ved even when the browser is closed and reopened. You can learn more on the LocalStorage api and offline mode <a href="http://blog.zenika.com/index.php?post/2011/02/17/Html5%3A-le-mode-Offline">here</a>.</p> <p>Create the <strong>popup.html</strong> file at the root of you project and add the following content:</p> <pre> - wsn      |-- pics      |-- style      |-- manifest.json      |-- background.html      |-- notification.html      |-- popup.html </pre> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #339933;">&lt;</span>html<span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;</span>head<span style="color: #339933;">&gt;</span> 	<span style="color: #339933;">&lt;</span>link href<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;style/style.css&quot;</span> rel<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;stylesheet&quot;</span> type<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;text/css&quot;</span><span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;/</span>head<span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;</span>body<span style="color: #339933;">&gt;</span> &nbsp; 	<span style="color: #339933;">&lt;</span>div id<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;head&quot;</span><span style="color: #339933;">&gt;</span> 		<span style="color: #339933;">&lt;</span>script<span style="color: #339933;">&gt;</span> 			document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;img src=&quot;'</span> <span style="color: #339933;">+</span> chrome.<span style="color: #660066;">extension</span>.<span style="color: #660066;">getURL</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'pics/wsn.png'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #3366CC;">'&quot; alt=&quot;www.whatsnextparis.com&quot;/&gt;'</span><span style="color: #009900;">&#41;</span>; 		<span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span> 		<span style="color: #339933;">&lt;</span>div<span style="color: #339933;">&gt;</span>The first conference of its kind <span style="color: #000066; font-weight: bold;">in</span> France<span style="color: #339933;">,</span> the future of IT technologies <span style="color: #CC0000;">26</span><span style="color: #339933;">-</span><span style="color: #CC0000;">27</span> May 2011.<span style="color: #339933;">&lt;/</span>div<span style="color: #339933;">&gt;</span> 		<span style="color: #339933;">&lt;</span>a href<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;http://www.whatsnextparis.com&quot;</span> target<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;_blank&quot;</span> title<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;What's Next Paris - 26 27 Mai 2011&quot;</span><span style="color: #339933;">&gt;</span>www.<span style="color: #660066;">whatsnextparis</span>.<span style="color: #660066;">com</span><span style="color: #339933;">&lt;/</span>a<span style="color: #339933;">&gt;</span> 	<span style="color: #339933;">&lt;/</span>div<span style="color: #339933;">&gt;</span> &nbsp; 	<span style="color: #339933;">&lt;</span>hr<span style="color: #339933;">/&gt;</span> &nbsp; 	<span style="color: #339933;">&lt;</span>div id<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;config&quot;</span><span style="color: #339933;">&gt;</span> 		<span style="color: #339933;">&lt;</span>input id<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;chkbox&quot;</span> type<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;checkbox&quot;</span> onchange<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;switchNotification(this);&quot;</span><span style="color: #339933;">/&gt;</span> 		<span style="color: #339933;">&lt;</span>label<span style="color: #339933;">&gt;</span>Disable notifications<span style="color: #339933;">&lt;/</span>label<span style="color: #339933;">&gt;</span> 		<span style="color: #339933;">&lt;</span>div<span style="color: #339933;">&gt;&lt;/</span>div<span style="color: #339933;">&gt;</span> 	<span style="color: #339933;">&lt;/</span>div<span style="color: #339933;">&gt;</span> &nbsp; 	<span style="color: #339933;">&lt;</span>hr<span style="color: #339933;">/&gt;</span> &nbsp;         <span style="color: #339933;">&lt;</span>div id<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;wall&quot;</span><span style="color: #339933;">&gt;</span> 		<span style="color: #339933;">&lt;</span>script<span style="color: #339933;">&gt;</span> 			<span style="color: #006600; font-style: italic;">// We retrieve the tweets array from the background page.</span> 			<span style="color: #003366; font-weight: bold;">var</span> tweets <span style="color: #339933;">=</span> chrome.<span style="color: #660066;">extension</span>.<span style="color: #660066;">getBackgroundPage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">tweets</span>; 			<span style="color: #000066; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span> <span style="color: #003366; font-weight: bold;">var</span> i <span style="color: #339933;">=</span> 0 ; i <span style="color: #339933;">&lt;</span> tweets.<span style="color: #660066;">length</span> ; i<span style="color: #339933;">++</span> <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 				document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;div class=&quot;tweet&quot;&gt;'</span><span style="color: #009900;">&#41;</span>; 					document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;div class=&quot;picture&quot;&gt;'</span><span style="color: #009900;">&#41;</span>; 						document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;img src=&quot;'</span> <span style="color: #339933;">+</span> tweets<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #660066;">picture</span> <span style="color: #339933;">+</span> <span style="color: #3366CC;">'&quot; alt=&quot;picture&quot;/&gt;'</span><span style="color: #009900;">&#41;</span>; 					document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;/div&gt;'</span><span style="color: #009900;">&#41;</span>; 					document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;div class=&quot;content&quot;&gt;'</span><span style="color: #009900;">&#41;</span>; 							document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;div class=&quot;user&quot;&gt;'</span><span style="color: #009900;">&#41;</span>; 								document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;a href=&quot;http://twitter.com/'</span> <span style="color: #339933;">+</span> tweets<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #660066;">user</span> <span style="color: #339933;">+</span> <span style="color: #3366CC;">'&quot; target=&quot;_blank&quot;&gt;@'</span> <span style="color: #339933;">+</span> tweets<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #660066;">user</span> <span style="color: #339933;">
+</span> <span style="color: #3366CC;">'&lt;/a&gt;'</span><span style="color: #009900;">&#41;</span>; 							document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;/div&gt;'</span><span style="color: #009900;">&#41;</span>; 							document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;div class=&quot;text&quot;&gt;'</span><span style="color: #009900;">&#41;</span>; 								document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span>tweets<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #660066;">text</span><span style="color: #009900;">&#41;</span>; 							document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;/div&gt;'</span><span style="color: #009900;">&#41;</span>; 						document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;/div&gt;'</span><span style="color: #009900;">&#41;</span>; 				document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;div style=&quot;clear:left;&quot;&gt;&lt;/div&gt;&lt;/div&gt;'</span><span style="color: #009900;">&#41;</span>; 			<span style="color: #009900;">&#125;</span> 		<span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span> 	<span style="color: #339933;">&lt;/</span>div<span style="color: #339933;">&gt;</span> &nbsp; 	<span style="color: #339933;">&lt;</span>div  id<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;footer&quot;</span><span style="color: #339933;">&gt;</span> 	    <span style="color: #339933;">&lt;</span>script<span style="color: #339933;">&gt;</span> 			document.<span style="color: #000066; font-weight: bold;">write</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'&lt;img src=&quot;'</span> <span style="color: #339933;">+</span> chrome.<span style="color: #660066;">extension</span>.<span style="color: #660066;">getURL</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'pics/zenika-full.gif'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #3366CC;">'&quot; alt=&quot;Zenika - Architecture Informatique&quot;/&gt;'</span><span style="color: #009900;">&#41;</span>; 	    <span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span> 	    <span style="color: #339933;">&lt;</span>a  href<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;http://www.zenika.com&quot;</span> target<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;_blank&quot;</span> title<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;Zenika - Architecture Informatique&quot;</span><span style="color: #339933;">&gt;</span>www.<span style="color: #660066;">zenika</span>.<span style="color: #660066;">com</span><span style="color: #339933;">&lt;/</span>a<span style="color: #339933;">&gt;</span> 	<span style="color: #339933;">&lt;/</span>div<span style="color: #339933;">&gt;</span> &nbsp;         <span style="color: #339933;">&lt;</span>script<span style="color: #339933;">&gt;</span> 	<span style="color: #006600; font-style: italic;">// Each time the popup is opened we clear the tweets badge counter</span> 	chrome.<span style="color: #660066;">extension</span>.<span style="color: #660066;">getBackgroundPage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">resetBadgeText</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>; &nbsp;         <span style="color: #006600; font-style: italic;">// Checking the box according to the localStorage.</span> 	<span style="color: #000066; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>window.<span style="color: #660066;">localStorage</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 		<span style="color: #000066; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>window.<span style="color: #660066;">localStorage</span>.<span style="color: #660066;">noticationEnable</span> <span style="color: #339933;">==</span> <span style="color: #3366CC;">'true'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 			window.<span style="color: #660066;">document</span>.<span style="color: #660066;">getElementById</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'chkbox'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">checked</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">false</span>;; 		<span style="color: #009900;">&#125;</span><span style="color: #000066; font-weight: bold;">else</span><span style="color: #009900;">&#123;</span> 			window.<span style="color: #660066;">document</span>.<span style="color: #660066;">getElementById</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'chkbox'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">checked</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span>; 		<span style="color: #009900;">&#125;</span> 	<span style="color: #009900;">&#125;</span> &nbsp; 	<span style="color: #006600; font-style: italic;">// Change notification display preference.</span> 	<span style="color: #006600; font-style: italic;">// User preference is stored in localStorage.</span> 	<span style="color: #003366; font-weight: bold;">function</span> switchNotification<span style="color: #009900;">&#40;</span>checkbox<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 		<span style="color: #000066; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>window.<span style="color: #660066;">localStorage</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 			<span style="color: #000066; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>checkbox.<span style="color: #660066;">checked</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 				window.<span style="color: #660066;">localStorage</span>.<span style="color: #660066;">noticationEnable</span> <span style="color: #339933;">=</span> <span style="color: #3366CC;">'false'</span>; 			<span style="color: #009900;">&#125;</span><span style="color: #000066; font-weight: bold;">else</span><span style="color: #009900;">&#123;</span> 				window.<span style="color: #660066;">localStorage</span>.<span style="color: #660066;">noticationEnable</span> <span style="color: #339933;">=</span> <span style="color: #3366CC;">'true'</span>; 				chrome.<span style="color: #660066;">extension</span>.<span style="color: #660066;">getBackgroundPage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">resetBadgeText</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>; 			<span style="color: #009900;">&#125;</span> 		<span style="color: #009900;">&#125;</span> 	<span style="color: #009900;">&#125;</span>         <span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span>     <span style="color: #339933;">&lt;/</span>body<span style="color: #339933;">&gt;</span> <span style="color: #339933;">&lt;/</span>html<span style="color: #339933;">&gt;</span></pre> <p>After a few tweets, this is what the popup will look like :</p> <p><img src="/wp-content/uploads/2015/07/popup-final.png" alt="popup-wsn" style="display:block; margin:0 auto;"
 title="popup-wsn" /></p> <h2>Installation</h2> <br/> <p>To install your extension open your browser, click on the Chrome configuration icon and go to the <strong>Tools</strong> -&gt; <strong>Extensions</strong> manager. You should see a <strong>Developer mode</strong> link on the top right. <img src="/wp-content/uploads/2015/07/dev-mod.jpg" alt="dev-mode" style="display:block; margin:0 auto;" title="dev-mode" /></p> <p>When the developer mode is enabled, you can add your extension by using the <strong>Load unpacked extension...</strong> button.</p> <p><img src="/wp-content/uploads/2015/07/load-button.jpg" alt="load-button" style="display:block; margin:0 auto;" title="load-button" /></p> <p>Select the root folder of your extension and confirm. Your extension is now installed and you should see a brand new icon next to the Chrome configuration one. To refresh your project after a file modification you only need to hit <strong>Reload</strong>.</p> <h3>Download</h3> <p>The packaged version of the What's Next extension is available <a href="/wp-content/uploads/2015/07/wsn.crx">here</a> for a quick installation.</p> <h2>Conclusion</h2> <br/> <p>We have seen how easy it is to develop a chrome extension that communicate with our Node server in real time. This ease comes from the facts that today a large portion of developers know core technologies behind website and the choice made by Google to keep using this technologies to enhance their browser. Developing an extension is done without using any tools or plug-in, productivity is excellent because there is no need to restart the browser after an extension update. The Chrome API documentation is very complete and most features are illustrated which makes it even easier task for a developer to understand the concepts.</p> <p>In the next post we will return to the server side and link our Node server with a MongoDB database to store the tweets.</p>