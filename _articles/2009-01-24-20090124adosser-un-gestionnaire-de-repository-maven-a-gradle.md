---
ID: 159
post_title: >
  Adosser un gestionnaire de repository
  Maven à Gradle
author: Grégory Boissinot
post_date: 2009-01-24 17:41:00
post_excerpt: '<p><a href="http://www.gradle.org/">Gradle</a> est un système de build innovant utilisant le langage dynamique Groovy pour décrire la chaîne de construction des applications, et le gestionnaire de dépendance <a href="http://ant.apache.org/ivy/">Ivy</a> pour gérer les librairies d’un projet.</p> <p>Grâce à la richesse du contenu des repository Maven disponibles sur le marché, il est très pratique d’utiliser des repository Maven pour récupérer les librairies du projet. Pour agréger plusieurs repository Maven, vous avez besoin d’un gestionnaire de repository comme <a href="http://archiva.apache.org/">Archiva</a>, <a href="http://nexus.sonatype.org/">Nexus</a> ou même <a href="http://www.jfrog.org/products.php">Artifactory</a>. L’utilisation d’un tel outil permet de fournir des mécanismes de sécurité, de cache, une gestion centralisée des proxies et des fonctionnalités de recherche avancées.</p>'
layout: post
permalink: http://blog.zenika-offres.com/?p=159
published: true
---
<p><a href="http://www.gradle.org/">Gradle</a> est un système de build innovant utilisant le langage dynamique Groovy pour décrire la chaîne de construction des applications, et le gestionnaire de dépendance <a href="http://ant.apache.org/ivy/">Ivy</a> pour gérer les librairies d’un projet.</p> <p>Grâce à la richesse du contenu des repository Maven disponibles sur le marché, il est très pratique d’utiliser des repository Maven pour récupérer les librairies du projet. Pour agréger plusieurs repository Maven, vous avez besoin d’un gestionnaire de repository comme <a href="http://archiva.apache.org/">Archiva</a>, <a href="http://nexus.sonatype.org/">Nexus</a> ou même <a href="http://www.jfrog.org/products.php">Artifactory</a>. L’utilisation d’un tel outil permet de fournir des mécanismes de sécurité, de cache, une gestion centralisée des proxies et des fonctionnalités de recherche avancées.</p>
<!--more-->
<p>L’exemple suivant (réalisé avec Gradle 0.5.2 et Archiva 1.1.3) fournit la configuration Gradle pour la récupération des librairies du projet à travers Archiva, puis la configuration pour le déploiement du livrable projet dans Archiva.</p> <h3>Récupération des dépendances</h3> <p>Il faut déclarer le point d’entrée de Archiva comme repository Maven dans lequel Gradle peut rechercher les artefacts</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">archivaRespositoryRootURL<span style="color: #66cc66;">=</span><span style="color: #ff0000;">'http://server:8090/archiva/repository'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">repositoryGroupArchivaURL <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">&quot;$archivaRespositoryRootURL/repository-group&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">dependencies <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	addMavenStyleRepo<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'archivaRepo'</span>,repositoryGroupArchivaURL<span style="color: #66cc66;">&#41;</span>	</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	compile <span style="color: #ff0000;">&quot;commons-logging:commons-logging:1.0&quot;</span>, <span style="color: #ff0000;">&quot;log4j:log4j:1.2.14&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #66cc66;">&#125;</span></div></li></ol></pre> <h3>Déploiement du livrable projet dans Archiva</h3> <p>Pour uploader ses artefacts, Archiva utilise le protocole webdav. Dans un premier temps, il faut récupérer une implémentation webdav et l’ajouter à une configuration nommée «&nbsp;deployerJars ». Ensuite, les librairies de cette configuration seront utilisées dans le deployeur Maven.</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">snapshotsRepositoryArchivaURL<span style="color: #66cc66;">=</span> <span style="color: #ff0000;">&quot;$archivaRespositoryRootURL/snapshots&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">repositoryArchivaURL<span style="color: #66cc66;">=</span> <span style="color: #ff0000;">&quot;$archivaRespositoryRootURL/internal&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">dependencies <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	addConfiguration<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;deployerJars&quot;</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	deployerJars <span style="color: #ff0000;">&quot;org.apache.maven.wagon:wagon-webdav:1.0-beta-2@jar&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">uploadLibs <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	uploadResolvers.<span style="color: #006600;">addMavenDeployer</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'maven-deployer'</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		addProtocolProviderJars<span style="color: #66cc66;">&#40;</span>dependencies.<span style="color: #006600;">resolve</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'deployerJars'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		snapshotRepository<span style="color: #66cc66;">&#40;</span>url: snapshotsRepositoryArchivaURL<span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		repository<span style="color: #66cc66;">&#40;</span>url: repositoryArchivaURL<span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li></ol></pre> <h3>Exemple complet</h3> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">group <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'com.zenika.example'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">usePlugin<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'war'</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">targetCompatibility <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'1.5'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">sourceCompatibility <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'1.5'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">archivesBaseName<span style="color: #66cc66;">=</span><span style="color: #ff0000;">'gradle-test'</span></div></li><li style="font-wei
ght: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">archivaRespositoryRootURL<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;http://server:8080/archiva/repository&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">snapshotsRepositoryArchivaURL<span style="color: #66cc66;">=</span> <span style="color: #ff0000;">&quot;$archivaRespositoryRootURL/snapshots&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">repositoryArchivaURL<span style="color: #66cc66;">=</span> <span style="color: #ff0000;">&quot;$archivaRespositoryRootURL/internal&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">repositoryGroupArchivaURL <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">&quot;$archivaRespositoryRootURL/repository-group&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">version <span style="color: #66cc66;">=</span> <span style="color: #000000; font-weight: bold;">null</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">createTask<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'init'</span>, overwrite: <span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #b1b100;">if</span> <span style="color: #66cc66;">&#40;</span>build.<span style="color: #006600;">taskGraph</span>.<span style="color: #006600;">hasTask</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">':release'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		version <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'1.0'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #66cc66;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		version <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'1.0-SNAPSHOT'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">createTask<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'release'</span>, dependsOn: <span style="color: #ff0000;">'uploadLibs'</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #993399;">println</span> <span style="color: #ff0000;">'The product has been released'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">dependencies <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	addMavenStyleRepo<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'archivaRepo'</span>,repositoryGroupArchivaURL<span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	compile <span style="color: #ff0000;">&quot;commons-logging:commons-logging:1.0&quot;</span>, <span style="color: #ff0000;">&quot;log4j:log4j:1.2.14&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	addConfiguration<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;deployerJars&quot;</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	deployerJars <span style="color: #ff0000;">&quot;org.apache.maven.wagon:wagon-webdav:1.0-beta-2@jar&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">uploadLibs.<span style="color: #006600;">doFirst</span><span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #b1b100;">if</span> <span style="color: #66cc66;">&#40;</span>build.<span style="color: #006600;">taskGraph</span>.<span style="color: #006600;">hasTask</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">':release'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #993399;">println</span> <span style="color: #ff0000;">&quot;Deployment into the internal repository $repositoryArchivaURL&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #66cc66;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="co
lor: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #993399;">println</span> <span style="color: #ff0000;">&quot;Deployment into the snapshots repository $snapshotsRepositoryArchivaURL&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">uploadLibs <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	uploadResolvers.<span style="color: #006600;">addMavenDeployer</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'maven-deployer'</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		addProtocolProviderJars<span style="color: #66cc66;">&#40;</span>dependencies.<span style="color: #006600;">resolve</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'deployerJars'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		snapshotRepository<span style="color: #66cc66;">&#40;</span>url: snapshotsRepositoryArchivaURL<span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		repository<span style="color: #66cc66;">&#40;</span>url: repositoryArchivaURL<span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li></ol></pre> <p>L’invocation de la commande:</p> <pre> /var/local/test&gt;gradle -q uploadLibs </pre> <p>déploie l’artefact produit par le projet dans l’espace “snapshots” de Archiva.</p> <p>L’invocation de la commande:</p> <pre> /var/local/test&gt;gradle -q release </pre> <p>déploie l’artefact produit par le projet dans l’espace “internal” de Archiva.</p> <p>Pour conclure, cet exemple nous fournit une première brique démontrant la très grande facilité d’intégration de Gradle dans une infrastructure Maven existante.</p>