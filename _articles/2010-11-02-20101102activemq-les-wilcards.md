---
ID: 92
post_title: 'ActiveMQ &#8211; Les wilcards'
author: rdelaporte
post_date: 2010-11-02 23:00:00
post_excerpt: |
  <p>J'ai découvert aujourd'hui une fonctionnalité très intéressante et très pratique du célèbre broker de messages <a href="http://activemq.apache.org">ActiveMQ</a>. <br />Il s'agit des <q>wilcards</q>.</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=92
published: true
---
<p>J'ai découvert aujourd'hui une fonctionnalité très intéressante et très pratique du célèbre broker de messages <a href="http://activemq.apache.org">ActiveMQ</a>. <br />Il s'agit des <q>wilcards</q>.</p>
<!--more-->
<h2>Consumer</h2> <p>Du point de vue du consommateur (<em>consumer</em>), il est possible grâce à quelques caractères spéciaux de consommer des messages de plusieurs destinations (<em>queues</em> et <em>topics</em>).</p> <p>ActiveMQ décompose le nom des destinations en éléments. Les éléments dans le nom sont délimités par un point (.).<br />
Par exemple, les destinations suivantes comportent donc 3 éléments&nbsp;:</p> <pre> queue.france.rennes queue.france.paris </pre> <p><br /></p> <p>Voici les caractères spéciaux&nbsp;:</p> <ul> <li>.   sépare les éléments</li> <li>*   correspond à un élément</li> <li>&gt;  correspond à un ou aux éléments restants</li> </ul> <p><br />
Par exemple, pour consommer tous les messages pour la France, nous pouvons déclarer le consommateur ci-dessous</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">String</span> brokerURI = ActiveMQConnectionFactory.<span style="color: #000000;">DEFAULT_BROKER_URL</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">ConnectionFactory connectionFactory = <span style="color: #7F0055; font-weight: bold;">new</span> ActiveMQConnectionFactory<span style="color: #000000;">&#40;</span>brokerURI<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">Connection</span> connection = connectionFactory.<span style="color: #000000;">createConnection</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">connection.<span style="color: #000000;">start</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">Session session = connection.<span style="color: #000000;">createSession</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">false</span>, Session.<span style="color: #000000;">AUTO_ACKNOWLEDGE</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">Queue france = session.<span style="color: #000000;">createQueue</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;*.france.*&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">MessageConsumer consumer = session.<span style="color: #000000;">createConsumer</span><span style="color: #000000;">&#40;</span>france<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">Message message = consumer.<span style="color: #000000;">receive</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p>ou encore</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">Queue france = session.<span style="color: #000000;">createQueue</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;*.france.&gt;&quot;</span><span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p><br /></p> <h2>Producer</h2> <p>A l'inverse, le producteur du message peut également envoyer un message vers plusieurs destinations (on parle alors généralement de broadcast). Il s'agit de <em>n</em> messages strictement identiques postés vers <em>n</em> destinations. Cela évite d'avoir à créer plusieurs <em>producers</em> pour réaliser plusieurs fois le même envoi.</p> <p>On parle de destination composite.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">Session session = connection.<span style="color: #000000;">createSession</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">false</span>, Session.<span style="color: #000000;">AUTO_ACKNOWLEDGE</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">Queue compositeDestination = session.<span style="color: #000000;">createQueue</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;queue.france.rennes, queue.france.paris&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">MessageProducer producer = session.<span style="color: #000000;">createProducer</span><span style="color: #000000;">&#40;</span>compositeDestination<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">Message message = session.<span style="color: #000000;">createStreamMessage</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> ;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">producer.<span style="color: #000000;">send</span><span style="color: #000000;">&#40;</span>message<span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p><br />
<ins>Remarque</ins>&nbsp;: Nous avons plusieurs messages indépendants avec un contenu totalement identique (header et body).</p> <p>Attention, une destination composite nommée <q>queue.france.*</q> n'enverra pas les messages vers toutes les files de messages, mais vers la file nommée <q>queue.france.*</q>. <br /></p> <h2>Conclusion</h2> <p>Les wilcards sont très puissants et peuvent nous faciliter la vie avec une syntaxe très intuitive. Attention cependant, cela n'est pas un standard JMS, mais 100% spécifique au produit ActiveMQ.<br /></p>