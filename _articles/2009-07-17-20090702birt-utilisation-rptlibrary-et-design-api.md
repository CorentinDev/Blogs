---
ID: 206
post_title: BIRT, Design API and rptLibrary
author: lbertholet
post_date: 2009-07-17 18:00:00
post_excerpt: |
  <p>The BIRT Design Engine API (DEAPI) provides the Java developers added flexibility to create, explore or modify BIRT report designs programmatically. For example, the BIRT Designer is built using this API. To use the DEAPI in your application, you'll need the design engine SDK. More detailed information are available on the <a href="http://www.eclipse.org/birt/phoenix/deploy/designEngineAPI.php" hreflang="en">BIRT website</a>.</p> <p>For example let's try to move a table column on a design using the DEAPI in a RCP (or RAP) application.</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=206
published: true
---
<p>The BIRT Design Engine API (DEAPI) provides the Java developers added flexibility to create, explore or modify BIRT report designs programmatically. For example, the BIRT Designer is built using this API. To use the DEAPI in your application, you'll need the design engine SDK. More detailed information are available on the <a href="http://www.eclipse.org/birt/phoenix/deploy/designEngineAPI.php" hreflang="en">BIRT website</a>.</p> <p>For example let's try to move a table column on a design using the DEAPI in a RCP (or RAP) application.</p>
<!--more-->
<p>First, create an instance of the design engine and get a SessionHandle.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">IDesignEngineFactory designEngineFactory = <span style="color: #000000;">&#40;</span>IDesignEngineFactory<span style="color: #000000;">&#41;</span> Platform</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">           .<span style="color: #000000;">createFactoryObject</span><span style="color: #000000;">&#40;</span>IDesignEngineFactory.<span style="color: #000000;">EXTENSION_DESIGN_ENGINE_FACTORY</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">IDesignEngine designEngine = designEngineFactory .<span style="color: #000000;">createDesignEngine</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> DesignConfig<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">SessionHandle session = designEngine.<span style="color: #000000;">newSessionHandle</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p>Then, open the desired report design.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">ReportDesignHandle designHandle = session.<span style="color: #000000;">openDesign</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;sample.rptDesign&quot;</span><span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p>Next, retrieve the table and the columns to move thanks to their design id.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">TableHandle table = <span style="color: #000000;">&#40;</span>TableHandle<span style="color: #000000;">&#41;</span> findElementHandle<span style="color: #000000;">&#40;</span>designHandle.<span style="color: #000000;">getBody</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,  tableDesignId<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">int</span> sourceColIndex = <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span>ColumnHandle<span style="color: #000000;">&#41;</span> findElementHandle<span style="color: #000000;">&#40;</span>table.<span style="color: #000000;">getColumns</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, sourceColDesignId<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">getIndex</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">int</span> destinationColIndex = <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span>ColumnHandle<span style="color: #000000;">&#41;</span> findElementHandle<span style="color: #000000;">&#40;</span>table.<span style="color: #000000;">getColumns</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, destinationColDesignId<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">getIndex</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p>where :</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">static</span> DesignElementHandle findElementHandle<span style="color: #000000;">&#40;</span>SlotHandle slotHandle, <span style="color: #7F0055; font-weight: bold;">long</span> designId<span style="color: #000000;">&#41;</span>  <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #808080; font-style: italic;">// search into the slot content for the element corresponding to the given design id</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span>DesignElementHandle elementHandle : <span style="color: #000000;">&#40;</span>List<span style="color: #000000;">&lt;</span>DesignElementHandle<span style="color: #000000;">&gt;</span><span style="color: #000000;">&#41;</span> slotHandle.<span style="color: #000000;">getContents</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>  <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #808080; font-style: italic;">// if found at this level, return it</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>elementHandle .<span style="color: #000000;">getID</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> == designId<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #7F0055; font-weight: bold;">return</span> elementHandle ;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #808080; font-style: italic;">// else do the same recursively in its children</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055;font-weight: bold;">else</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padd
ing:0; background:inherit;">            <span style="color: #7F0055; font-weight: bold;">int</span> elementSlotCount = element.<span style="color: #000000;">getDefn</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">getSlotCount</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> i = 0; i <span style="color: #000000;">&lt;</span> elementSlotCount ; i++<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                DesignElementHandle handle = findElementHandle<span style="color: #000000;">&#40;</span>element.<span style="color: #000000;">getSlot</span><span style="color: #000000;">&#40;</span>i<span style="color: #000000;">&#41;</span>, designId<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                <span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>handle <span style="color: #000000;">!</span>= <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                    <span style="color: #7F0055; font-weight: bold;">return</span> handle;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">return</span> <span style="color: #7F0055; font-weight: bold;">null</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>Finally, call the appropriate given method on these elements</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>sourceColIndex <span style="color: #000000;">&gt;</span> destColumnIndex<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    table.<span style="color: #000000;">shiftColumn</span><span style="color: #000000;">&#40;</span>sourceColIndex + <span style="color: #cc66cc;">1</span>, destinationColIndex<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055;font-weight: bold;">else</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    table.<span style="color: #000000;">shiftColumn</span><span style="color: #000000;">&#40;</span>sourceColIndex + <span style="color: #cc66cc;">1</span>, destinationColIndex + <span style="color: #cc66cc;">1</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>The report design can be ran and rendered again to verify the modification. It can also be save and close to persist it.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">designHandle.<span style="color: #000000;">save</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">designHandle.<span style="color: #000000;">close</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p><br /></p> <p>BIRT allow developers to store and share design elements thanks to a report library. So as designs, libraries can be manipulated via the DEAPI. But what will happen if a design composed of elements from a Library is trying to be altered by the DEAPI ?</p> <p>Let's imagine that our Table is now an extension of a referenced report library :</p> <pre>&lt;table name="Table" id="10" extends="library.Library_Table"&gt;</pre> <p>Executing the same code as described previously will lead to the following error :</p> <pre> org.eclipse.birt.report.model.api.elements.SemanticError: The paste operation on the element &quot;Table&quot; is forbidden.    at org.eclipse.birt.report.model.api.ColumnBandShiftAction.shiftColumnBand(ColumnBandShiftAction.java:155)    at org.eclipse.birt.report.model.api.TableHandle.shiftColumn(TableHandle.java:556) </pre> <p>Indeed, as the table is inherited from the library, it can't be modified when the DEAPI is working on the report design. This change can only be applied on the report library itself. This behavior can be a restrictive argument to develop an application which is changing dynamically design, like an interactive viewer... At least, it prevents from using library...</p> <p>One idea to avoid this is to copy the extended elements from the library to the design while opening it, always thanks to DEAPI.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">/* retrieve report libraries and put them in a map by namespace */</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">Map<span style="color
: #000000;">&lt;</span>String, LibraryHandle<span style="color: #000000;">&gt;</span> libraries = <span style="color: #7F0055; font-weight: bold;">new</span> HashMap<span style="color: #000000;">&lt;</span>String, LibraryHandle<span style="color: #000000;">&gt;</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span>LibraryHandle library : <span style="color: #000000;">&#40;</span>List<span style="color: #000000;">&lt;</span>LibraryHandle<span style="color: #000000;">&gt;</span><span style="color: #000000;">&#41;</span> designHandle.<span style="color: #000000;">getLibraries</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    libraries.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span>library.<span style="color: #000000;">getNamespace</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, library<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">replaceExtendsElementHandle<span style="color: #000000;">&#40;</span>designHandle.<span style="color: #000000;">getBody</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, libraries<span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p>where :</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">void</span> replaceExtendsElementHandle<span style="color: #000000;">&#40;</span>SlotHandle slotHandle,</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        Map<span style="color: #000000;">&lt;</span>String, LibraryHandle<span style="color: #000000;">&gt;</span> libraries<span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> SemanticException <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #808080; font-style: italic;">/* iterates over slot content to find an extend element */</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> i = 0; i <span style="color: #000000;">&lt;</span> slot.<span style="color: #000000;">getCount</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; i++<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        DesignElementHandle elementHandle = slotHandle.<span style="color: #000000;">get</span><span style="color: #000000;">&#40;</span>i<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        ElementRefValue extendsRefValue = <span style="color: #000000;">&#40;</span>ElementRefValue<span style="color: #000000;">&#41;</span> elementHandle.<span style="color: #000000;">getElement</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                          <span style="color: #000000;">getLocalProperty</span><span style="color: #000000;">&#40;</span>elementHandle.<span style="color: #000000;">getModule</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, IDesignElementModel.<span style="color: #000000;">EXTENDS_PROP</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #808080; font-style: italic;">/* if not null drop and copy */</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>extendsRefValue <span style="color: #000000;">!</span>= <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            slotHandle.<span style="color: #000000;">drop</span><span style="color: #000000;">&#40;</span>i<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            slotHandle.<span style="color: #000000;">add</span><span style="color: #000000;">&#40;</span>libraries.<span style="color: #000000;">get</span><span style="color: #000000;">&#40;</span>extendsRefValue.<span style="color: #000000;">getLibraryNamespace</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>.</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                         <span style="color: #000000;">findElement</span><span style="color: #000000;">&#40;</span>elementHandle.<span style="color: #000000;">getName</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>, i<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #808080; font-style: italic;">// else search into its children for extend element</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055;font-weight: bold;">else</span> <span s
tyle="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #7F0055; font-weight: bold;">int</span> slotCount = elementHandle.<span style="color: #000000;">getDefn</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">getSlotCount</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> j = 0; j <span style="color: #000000;">&lt;</span> slotCount; j++<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                replaceExtendsElementHandle<span style="color: #000000;">&#40;</span>elementHandle.<span style="color: #000000;">getSlot</span><span style="color: #000000;">&#40;</span>j<span style="color: #000000;">&#41;</span>, libraries<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>But if you execute this code, the following error will occur :</p> <pre> org.eclipse.birt.report.model.api.IllegalOperationException: The module is read-only and operation is forbidden. </pre> <p>The last trick to finally obtain the wanted result is to take a copy of the declared library :</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span>LibraryHandle library : <span style="color: #000000;">&#40;</span>List<span style="color: #000000;">&lt;</span>LibraryHandle<span style="color: #000000;">&gt;</span><span style="color: #000000;">&#41;</span> designHandle.<span style="color: #000000;">getLibraries</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    libraries.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span>library.<span style="color: #000000;">getNamespace</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, <span style="color: #000000;">&#40;</span>LibraryHandle<span style="color: #000000;">&#41;</span> library.<span style="color: #000000;">copy</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                  <span style="color: #000000;">getHandle</span><span style="color: #000000;">&#40;</span>library.<span style="color: #000000;">getModule</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>I want to thanks the <a href="http://www.eclipse.org/newsportal/thread.php?group=eclipse.birt" hreflang="en">BIRT newsgroup</a> and more precisely Jason for helping me while working on this case.</p>