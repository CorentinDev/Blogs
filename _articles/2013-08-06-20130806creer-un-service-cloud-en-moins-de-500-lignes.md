---
ID: 412
post_title: >
  Créer un service cloud en moins de 500
  lignes
author: mlux
post_date: 2013-08-06 10:15:00
post_excerpt: '<p>En voici un titre racoleur&nbsp;! Du moins dans le monde l’IT... J’espère ne pas lancer une mode qui s’apparenterait aux solutions pour maigrir en moins de 7 jours ou d’apprendre le Javanais en moins d’un mois mais je relève néanmoins le défi énoncé dans le titre.</p>'
layout: post
permalink: http://blog.zenika-offres.com/?p=412
published: true
slide_template:
  - ""
---
<p>En voici un titre racoleur&nbsp;! Du moins dans le monde l’IT... J’espère ne pas lancer une mode qui s’apparenterait aux solutions pour maigrir en moins de 7 jours ou d’apprendre le Javanais en moins d’un mois mais je relève néanmoins le défi énoncé dans le titre.</p>
<!--more-->
<p>Par la formulation “créer un service”, je souhaite proposer l’optique du service dans son ensemble. Cela comprend le langage de programmation, les frameworks employées mais aussi le système de stockage des données, la diffusion du service en terme de plateformes et enfin son hébergement.</p> <p>Pour n’en dire qu’un mot, l’IT évolue beaucoup actuellement. Nous étions encore récemment concentrés sur les nouveaux frameworks pour l’infrastructure en place, aujourd’hui toutes les briques sont remises en cause&nbsp;: langages de programmation (Scala, Groovy, JavaScript, Dart, TypeScript...), bases de données (MongoDB, Neo4j, Redis...), et l’hébergement avec tout ce qui touche au cloud. En somme, sans oser avancer que cette application est l’application du futur, aborder ce que pourrait être l’application du futur nécessite une perspective très large.</p> <h2>Qu’est ce qu’un service cloud</h2> <p>Comme beaucoup de notion marketing de l’IT, le cloud est certainement plus une idée qu’une technologie à proprement parlé. Plutôt que de le définir de façon absolue, je proposerai donc ici ma vision, ou au moins celle qui a guidé le design de l’application.</p> <p>Un service cloud est un service accessible via Internet sur un nombre important de plateformes&nbsp;: ordinateurs, tablettes et smartphones (je n’ai volontairement cité aucune marque ou système d’exploitation). Chaque utilisateur du service peut y trouver un espace qui lui est personnel et communiquer avec les autres utilisateurs du service. Lorsqu’il passe d’un appareil à un autre pour utiliser le service, il y retrouve son espace.</p> <p>La traduction technique de ce cahier des charges correspond à un service proposant une interface accessible sur un maximum de plateformes (Web, Android, iOS...) proposant un hébergement et un stockage de données aux performances et au cout très extensible afin d’être capable de gérer le succès du service (on ne sait jamais !).</p> <h2>Le vif du sujet</h2> <p>Derrière un projet comme celui-là, il faut une idée de service. Pour cet article, je vous en propose une qui, à priori, n’est ni révolutionnaire, ni inintéressante, donc plutôt adapté à son utilisation ici. Il s’agit de créer des espaces graphiques partagés permettant d’échanger avec d’autres utilisateurs de façon graphique. Je l’ai simplement appelé “Shared Whiteboard”. Le service repond aux exigences du cloud par la persistance du contenu des “tableaux”, la diffusion du service sur le Web, les tablettes et les mobiles (les interfaces tactiles permettent de dessiner avec le doigt). Les échanges se font par le partage d’un même “tableau”.</p> <h2>Parlons technique</h2> <p>Nous voici arrivés au moment de choisir tous les composants techniques de notre service. Bien sûr, chaque choix pourrait être soumis à débat, je vous décrirai simplement les choix qui ont été faits et leurs justifications.</p> <h5>Côté serveur</h5> <p>Le serveur n’a pratiquement aucune règle de gestion à implémenter, son rôle sera uniquement de recevoir les modifications sur les tableaux et de dispatcher ces modifications aux autres clients connectés au même tableau et au système de stockage. Node.js apparait alors comme un choix tout désigné&nbsp;: très performant sur de petites tâches d’I/O, facile à héberger et très facile d’utilisation pour faire des WebSockets.</p> <p>Quelques lignes Node.js pour démarrer un serveur HTTP (avec express.js)</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">var</span> _ <span style="color: #339933;">=</span> require<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;underscore&quot;</span><span style="color: #009900;">&#41;</span>; <span style="color: #003366; font-weight: bold;">var</span> express <span style="color: #339933;">=</span> require<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;express&quot;</span><span style="color: #009900;">&#41;</span>; ... <span style="color: #003366; font-weight: bold;">var</span> expressServer <span style="color: #339933;">=</span> express.<span style="color: #660066;">createServer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> expressServer.<span style="color: #003366; font-weight: bold;">use</span><span style="color: #009900;">&#40;</span>express.<span style="color: #660066;">bodyParser</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>; expressServer.<span style="color: #003366; font-weight: bold;">use</span><span style="color: #009900;">&#40;</span>express.<span style="color: #660066;">errorHandler</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>; expressServer.<span style="color: #003366; font-weight: bold;">use</span><span style="color: #009900;">&#40;</span>express.<span style="color: #660066;">static</span><span style="color: #009900;">&#40;</span>__dirname <span style="color: #339933;">+</span> <span style="color: #3366CC;">&quot;/public&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>; … <span style="color: #003366; font-weight: bold;">var</span> port <span style="color: #339933;">=</span> parseInt<span style="color: #009900;">&#40;</span>process.<span style="color: #660066;">env</span>.<span style="color: #660066;">PORT</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">10</span><span style="color: #009900;">&#41;</span> || <span style="color: #CC0000;">1337</span>; expressServer.<span style="color: #660066;">listen</span><span style="color: #009900;">&#40;</span>port<span style="color: #009900;">&#41;</span>; console.<span style="color: #660066;">info</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;listen port &quot;</span><span style="color: #339933;">,</span> port<span style="color: #009900;">&#41;</span>;</pre> <p>Pour communiquer avec l’interface Web et sachant qu’il faudra du Push, c’est bien évidemment Socket.io que nous allons utiliser. Configurer, connecter et transmettre les évènements de modification des tableaux se font encore une fois quelques lignes.</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">var</span> io <span style="color: #339933;">=</span> socketio.<span style="color: #660066;">listen</span><span style="color: #009900;">&#40;</span>expressServer<span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> 	<span style="color: #3366CC;">&quot;log level&quot;</span><span style="color: #339933;">:</span> <span style="color: #CC0000;">2</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; … io.<span style="color: #660066;">sockets</span>.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;connection&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>socket<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>   	socket.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;connect&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>   		… <span style="color: #006600; font-style: italic;">// void ci dessous</span>   	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;   	socket.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;clear&quot;</span><span st
yle="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>   		… <span style="color: #006600; font-style: italic;">// void ci dessous</span>   	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;   	socket.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;element&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 		console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;element message, receiving new&quot;</span><span style="color: #339933;">,</span> data.<span style="color: #660066;">type</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;element for&quot;</span><span style="color: #339933;">,</span> data.<span style="color: #660066;">whiteboard</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;whiteboard&quot;</span><span style="color: #009900;">&#41;</span>; 		socket.<span style="color: #660066;">broadcast</span>.<span style="color: #660066;">emit</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;element&quot;</span><span style="color: #339933;">,</span> data<span style="color: #009900;">&#41;</span>; 		… <span style="color: #006600; font-style: italic;">// void ci dessous</span> 	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>Côté stockage, nous pouvons facilement identifier nos tableaux pour être des documents MongoDB avec une intégration Node.js rapide et un hébergement facile également. Le fonctionnement asynchrone de MongoDB permet de s’intégrer rapidement dans les évènements socket.io déjà préparés&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">var</span> mongo <span style="color: #339933;">=</span> mongoose.<span style="color: #660066;">createConnection</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'mongodb://whiteboard:***@alex.mongohq.com:10007/shared-whiteboard'</span><span style="color: #009900;">&#41;</span>; ... <span style="color: #003366; font-weight: bold;">var</span> WhiteBoardElement <span style="color: #339933;">=</span> mongo.<span style="color: #660066;">model</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'WhiteBoardElement'</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">new</span> mongoose.<span style="color: #660066;">Schema</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span> 	whiteboard<span style="color: #339933;">:</span> String<span style="color: #339933;">,</span> 	type<span style="color: #339933;">:</span> String <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>; &nbsp; io.<span style="color: #660066;">sockets</span>.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;connection&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>socket<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>   	socket.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;connect&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>   		WhiteBoardElement.<span style="color: #660066;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>   			whiteboard<span style="color: #339933;">:</span> data.<span style="color: #660066;">whiteboard</span>   		<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>err<span style="color: #339933;">,</span> docs<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>   			<span style="color: #000066; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>err<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>   				socket.<span style="color: #660066;">emit</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;init&quot;</span><span style="color: #339933;">,</span> docs<span style="color: #009900;">&#41;</span>; 				console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;connect message, whiteboard&quot;</span><span style="color: #339933;">,</span> data.<span style="color: #660066;">whiteboard</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;return&quot;</span><span style="color: #339933;">,</span> docs.<span style="color: #660066;">length</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;docs&quot;</span><span style="color: #009900;">&#41;</span>; 			<span style="color: #009900;">&#125;</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span> 				console.<span style="color: #660066;">error</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;connect message, error from mongodb&quot;</span><span style="color: #339933;">,</span> err<span style="color: #009900;">&#41;</span>; 			<span style="color: #009900;">&#125;</span>   		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;   	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;   	socket.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;clear&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>   		console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;clear message, deleting elements for whiteboard&quot;</span><span style="color: #339933;">,</span> data<span style="color: #009900;">&#41;</span>; 		WhiteBoardElement.<span style="color: #660066;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>whiteboard<span style="color: #339933;">:</span> data<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">remove</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>;   	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;   	socket.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;element&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 		console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;"
>&quot;element message, receiving new&quot;</span><span style="color: #339933;">,</span> data.<span style="color: #660066;">type</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;element for&quot;</span><span style="color: #339933;">,</span> data.<span style="color: #660066;">whiteboard</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;whiteboard&quot;</span><span style="color: #009900;">&#41;</span>; 		socket.<span style="color: #660066;">broadcast</span>.<span style="color: #660066;">emit</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;element&quot;</span><span style="color: #339933;">,</span> data<span style="color: #009900;">&#41;</span>; 		<span style="color: #003366; font-weight: bold;">var</span> instance <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> WhiteBoardElement<span style="color: #009900;">&#40;</span>data<span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span>; 		instance.<span style="color: #660066;">save</span><span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>err<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 			<span style="color: #000066; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>err<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 				console.<span style="color: #660066;">error</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;error on adding the new element in mongodb&quot;</span><span style="color: #339933;">,</span> err<span style="color: #009900;">&#41;</span>; 			<span style="color: #009900;">&#125;</span> 		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>Nous voila avec un code serveur complet pour seulement 54 lignes et facilement hébergeable: <a href="https://github.com/Swiip/shared-whiteboard/blob/master/app.js">https://github.com/Swiip/shared-whiteboard/blob/master/app.js</a></p> <h5>Côté client</h5> <p>Avec 500 lignes et l’objectif de cibler un maximum de plateformes mobiles, autant dire que les applications codées en natif pour chaque plateforme sont totalement inaccessibles. L’interface générique avec des technologies Web est donc incontournable.</p> <p>Il va falloir également un framework de mise en forme qui s’adapte à tous les devices en un seul code. jQuery Mobile est pensé pour cet objectif, c’est lui que nous allons utiliser. Nous avons besoin de trois pages: Accueil, Tableau et Options que nous mettons dans un seul document HTML comme le propose l’outil.</p> <pre class="html code html" style="font-family:inherit"><span style="color: #00bbdd;">&lt;!DOCTYPE html&gt;</span> <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">html</span>&gt;</span> 	<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">head</span>&gt;</span> 		<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">title</span>&gt;</span>Shared Whiteboard<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">title</span>&gt;</span> 		<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">meta</span> <span style="color: #000066;">name</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;viewport&quot;</span> <span style="color: #000066;">content</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span> 		<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">link</span> <span style="color: #000066;">rel</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;stylesheet&quot;</span> <span style="color: #000066;">href</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css&quot;</span><span style="color: #66cc66;">/</span>&gt;</span> 		<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">script</span> <span style="color: #000066;">src</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;http://code.jquery.com/jquery-1.7.1.min.js&quot;</span>&gt;&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">script</span>&gt;</span> 		<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">script</span> <span style="color: #000066;">src</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js&quot;</span>&gt;&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">script</span>&gt;</span> 		... // a venir 		 <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">script</span> <span style="color: #000066;">type</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;text/javascript&quot;</span>&gt;</span> 			… // a venir 		<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">script</span>&gt;</span> 	<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">head</span>&gt;</span> 	<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">body</span>&gt;</span> 		<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">div</span> data-role<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;page&quot;</span> <span style="color: #000066;">id</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;home&quot;</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">div</span> data-role<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;header&quot;</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">h1</span>&gt;</span>Choose your whitboard<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">h1</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">div</span>&gt;</span>                 	<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">div</span> data-role<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;content&quot;</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">h1</span>&gt;</span>Whiteboard's name:<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">h1</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">input</span> <span style="color: #000066;">class</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;whiteboard-name&quot;</span> <span style="color: #000066;">type</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;text&quot;</span> <span style="color: #000066;">value</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;&quot;</span> <span style="color: #66cc66;">/</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">a</span> <span style="color: #000066;">class</span><span sty
le="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;open-button&quot;</span> data-role<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;button&quot;</span> <span style="color: #000066;">href</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;#whiteboard&quot;</span>&gt;</span>Open<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">a</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">div</span>&gt;</span> 		<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">div</span>&gt;</span> 		<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">div</span> data-role<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;page&quot;</span> <span style="color: #000066;">id</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;whiteboard&quot;</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">div</span> data-role<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;header&quot;</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">h1</span>&gt;</span>Whiteboard<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">h1</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">a</span> data-icon<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;check&quot;</span> <span style="color: #000066;">class</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;ui-btn-right image-ok&quot;</span> <span style="color: #000066;">style</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;display: none;&quot;</span>&gt;</span>Ok<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">a</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">a</span> <span style="color: #000066;">href</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;#options&quot;</span> data-icon<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;gear&quot;</span> <span style="color: #000066;">class</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;ui-btn-right options&quot;</span>&gt;</span>Options<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">a</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">div</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">div</span> <span style="color: #000066;">id</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;editor&quot;</span>&gt;&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">div</span>&gt;</span> 		<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">div</span>&gt;</span> 		<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">div</span> data-role<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;page&quot;</span> <span style="color: #000066;">id</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;options&quot;</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">div</span> data-role<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;header&quot;</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">a</span> <span style="color: #000066;">href</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;#whiteboard&quot;</span> data-icon<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;arrow-l&quot;</span>&gt;</span>Ok<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">a</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">h1</span>&gt;</span>Options<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">h1</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">div</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">a</span> data-role<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;button&quot;</span> <span style="color: #000066;">class</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;add-picture-button&quot;</span>&gt;</span>Add a picture<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">a</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">fieldset</span> data-role<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;controlgroup&quot;</span> data-<span style="color: #000066;">type</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;horizontal&quot;</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">legend</span>&gt;</span>Color<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">legend</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">input</span> <span style="color: #000066;">type</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;radio&quot;</span> <span style="color: #000066;">name</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;color&quot;</span> <span style="color: #000066;">id</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;color-black&quot;</span> <span style="color: #000066;">value</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;black&quot;</span> <span style="color: #000066;">checked</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;checked&quot;</span> <span style="color: #66cc66;">/</span>&gt;</span> <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">label</span> <span style="color: #000066;">for</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;color-black&quot;</span>&gt;</span>Black<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">label</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">input</span> <span style="color: #000066;">type</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;radio&quot;</span> <span style="color: #000066;">name</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;color&quot;</span> <span style="color: #000066;">id</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;color-red&quot;</span> <span style="color: #000066;">value</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;red&quot;</span> <span style="color: #66cc66;">/</span>&gt;</span> <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">label</span> <span style="color: #000066;">for</span><span style="color: #66cc66;">=</span>
<span style="color: #ff0000;">&quot;color-red&quot;</span>&gt;</span>Red<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">label</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">input</span> <span style="color: #000066;">type</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;radio&quot;</span> <span style="color: #000066;">name</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;color&quot;</span> <span style="color: #000066;">id</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;color-blue&quot;</span> <span style="color: #000066;">value</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;blue&quot;</span> <span style="color: #66cc66;">/</span>&gt;</span> <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">label</span> <span style="color: #000066;">for</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;color-blue&quot;</span>&gt;</span>Blue<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">label</span>&gt;</span> 				<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">input</span> <span style="color: #000066;">type</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;radio&quot;</span> <span style="color: #000066;">name</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;color&quot;</span> <span style="color: #000066;">id</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;color-green&quot;</span> <span style="color: #000066;">value</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;green&quot;</span> <span style="color: #66cc66;">/</span>&gt;</span> <span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">label</span> <span style="color: #000066;">for</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;color-green&quot;</span>&gt;</span>Green<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">label</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">fieldset</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">label</span> <span style="color: #000066;">for</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;width&quot;</span>&gt;</span>Width:<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">label</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">input</span> <span style="color: #000066;">type</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;range&quot;</span> <span style="color: #000066;">name</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;width&quot;</span> <span style="color: #000066;">id</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;width&quot;</span> <span style="color: #000066;">value</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;5&quot;</span> min<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;1&quot;</span> max<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;30&quot;</span> <span style="color: #66cc66;">/</span>&gt;</span> 			<span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">a</span> data-role<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;button&quot;</span> data-icon<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;delete&quot;</span> <span style="color: #000066;">class</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;clear-whiteboard-button&quot;</span>&gt;</span>Clear whiteboard<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">a</span>&gt;</span> 		<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">div</span>&gt;</span> 	<span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">body</span>&gt;</span> <span style="color: #009900;">&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">html</span>&gt;</span></pre> <p>Le tableau en lui même doit être une zone graphique. Dans les technologies Web, cela se concrétise par l’utilisation des nouveaux composants HTML5 SVG ou Canvas. Dans ce cas je me suis dirigé vers le framework SVG RaphaelJS et une petite librairie construite sur RaphaelJS qui s’appelle Raphael Sketchpad et qui permet justement de tracer au doigt ou à la souris des trait avec Raphael. <a href="http://ianli.com/sketchpad/">http://ianli.com/sketchpad/</a></p> <p>Les puristes pourront mettre ma démonstration à défaut à cet endroit précis et j’en ai conscience, je préfère de ce fait annoncer la chose clairement. Une librairie si peu répandue et dans laquelle en plus j’ai fait des modifications pourrait compter dans le nombre de ligne de code globale ce qui me ferais dépasser les 500 lignes (d’une centaine ou deux). Mais c’est néanmoins du code que j’ai réutilisé dans sa grande majorité, que je n’étais pas obligé de modifier en dehors de questions de performances et des photos (voir ci-dessous) et je suis loin d’avoir modifié autant de ligne que j’aurai de marge à la fin du compte, donc je me permettrai de continuer en considérant Sketchpad comme une librairie externe.</p> <pre class="javascript code javascript" style="font-family:inherit">&lt;head&gt; 	... 	&lt;script src=&quot;js/raphael.whiteboard.js&quot;&gt;&lt;/script&gt; 	... 	<span style="color: #339933;">&lt;</span>script type<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;text/javascript&quot;</span><span style="color: #339933;">&gt;</span> 		... 		<span style="color: #003366; font-weight: bold;">function</span> startWhiteboard<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 			window.<span style="color: #660066;">whiteboard</span> <span style="color: #339933;">=</span> Raphael.<span style="color: #660066;">whiteboard</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;editor&quot;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> 				width<span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;100%&quot;</span><span style="color: #339933;">,</span> 				height<span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;100%&quot;</span><span style="color: #339933;">,</span> 				editing<span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span> 			<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 			whiteboard.<span style="color: #660066;">addChangeHandler</span><span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>attr<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 				<span style="color: #000066; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>listening<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 					attr.<span style="color: #660066;">whiteboard</span> <span style="color: #339933;">=</span> whiteboardName; 					socket.<span style="color: #660066;">emit</span><span style="color: #009900;">&#40;</span
><span style="color: #3366CC;">&quot;element&quot;</span><span style="color: #339933;">,</span> attr<span style="color: #009900;">&#41;</span>; 				<span style="color: #009900;">&#125;</span> 			<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 		<span style="color: #009900;">&#125;</span> 		... 	<span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span> &lt;/head&gt;</pre> <p>Se connecter avec le serveur que nous avons créé précedemment demande d’utiliser l’interface cliente de socket.io. Ensuite, il s’agit d’écouter les modifications arrivant par la WebSocket et transmettre celles qui sont faites sur l’interface.</p> <pre class="javascript code javascript" style="font-family:inherit">&lt;head&gt; 	... 	&lt;script src=&quot;js/socket.io.min.js&quot;&gt;&lt;/script&gt; 	... 	<span style="color: #339933;">&lt;</span>script type<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;text/javascript&quot;</span><span style="color: #339933;">&gt;</span> 		<span style="color: #003366; font-weight: bold;">var</span> socket<span style="color: #339933;">,</span> whiteboardName<span style="color: #339933;">,</span> listening <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span>; &nbsp; 		$<span style="color: #009900;">&#40;</span>document<span style="color: #009900;">&#41;</span>.<span style="color: #660066;">bind</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'pageinit'</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>event<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 			socket <span style="color: #339933;">=</span> io.<span style="color: #660066;">connect</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;&quot;</span><span style="color: #009900;">&#41;</span>; 			... 		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 		... 		<span style="color: #003366; font-weight: bold;">function</span> startWhiteboard<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 			... 			<span style="color: #660066;">socket</span>.<span style="color: #660066;">emit</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;connect&quot;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> 				whiteboard<span style="color: #339933;">:</span> whiteboardName 			<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 			socket.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;init&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>elements<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 				listening <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">false</span>; 				<span style="color: #003366; font-weight: bold;">var</span> result <span style="color: #339933;">=</span> whiteboard.<span style="color: #660066;">paper</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">add</span><span style="color: #009900;">&#40;</span>elements<span style="color: #009900;">&#41;</span>; 				listening <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span>; 			<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 			socket.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;element&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>attr<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 				<span style="color: #000066; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>attr.<span style="color: #660066;">whiteboard</span> <span style="color: #339933;">==</span> whiteboardName<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 					listening <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">false</span>; 					console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;receiving new element of type &quot;</span><span style="color: #339933;">,</span> attr.<span style="color: #660066;">type</span><span style="color: #009900;">&#41;</span>; 					whiteboard.<span style="color: #660066;">paper</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">add</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#91;</span>attr<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>; 					listening <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span>; 				<span style="color: #009900;">&#125;</span> 			<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 		<span style="color: #009900;">&#125;</span> 	<span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span> &lt;/head&gt;</pre> <p>Dans la définition du projet, j’avais parlé de distribution sur toutes les plateformes mobiles. En pratique, l’application actuelle fonctionne déjà sur la plupart des navigateurs mobiles mais il est possible d’aller plus loin en créant des applications susceptibles d’être distribué sur les markets avec la solution PhoneGap. Pratiquement aucun code supplémentaire n’est nécessaire, il suffit de saisir l’adresse du repository GitHub dans <a href="https://build.phonegap.com/">https://build.phonegap.com/</a>.</p> <p>Pour réellement intégrer l’application pour le mobile, on peut ajouter la fonctionnalité de prendre du photo pour l’intégrer sur le tableau. On ajoute alors le code suivant&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit">&lt;head&gt; 	... 	&lt;script src=&quot;cordova-1.8.1.js&quot;&gt;&lt;/script&gt; 	<span style="color: #339933;">&lt;</span>script type<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;text/javascript&quot;</span><span style="color: #339933;">&gt;</span> 	... 	$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;.add-picture-button&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">live</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;click&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>event<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 		navigator.<span style="color: #660066;">camera</span>.<span style="color: #660066;">getPicture</span><span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 			console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;camera success &quot;</span><span style="color: #339933;">,</span> data<span style="color: #009900;">&#41;</span>; &nbsp; 			<span style="color: #003366; font-weight: bold;">var</span> src; 			<span style="color: #006600; font-style: italic;">//Hook for PhoneGap simulation stub</span> 			<span style="color: #000066; font-weight: bold;">if</span><span style="color:
#009900;">&#40;</span>data <span style="color: #339933;">==</span> <span style="color: #3366CC;">&quot;chrome-logo.png&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 				src <span style="color: #339933;">=</span> data; 			<span style="color: #009900;">&#125;</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span> 				src <span style="color: #339933;">=</span> <span style="color: #3366CC;">&quot;data:image/jpeg;base64,&quot;</span> <span style="color: #339933;">+</span> data; 			<span style="color: #009900;">&#125;</span> 			whiteboard.<span style="color: #660066;">addImage</span><span style="color: #009900;">&#40;</span>src<span style="color: #009900;">&#41;</span>; 			$.<span style="color: #660066;">mobile</span>.<span style="color: #660066;">changePage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;#whiteboard&quot;</span><span style="color: #009900;">&#41;</span>; 			$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;#whiteboard a.image-ok&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">css</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;display&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;block&quot;</span><span style="color: #009900;">&#41;</span>; 			$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;#whiteboard a.options&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">css</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;display&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;none&quot;</span><span style="color: #009900;">&#41;</span>; 		<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 			console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;camera fail &quot;</span> <span style="color: #339933;">+</span> data<span style="color: #009900;">&#41;</span>; 		<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> 			quality<span style="color: #339933;">:</span> <span style="color: #CC0000;">20</span><span style="color: #339933;">,</span> 			destinationType<span style="color: #339933;">:</span> Camera.<span style="color: #660066;">DestinationType</span>.<span style="color: #660066;">DATA_URL</span> 		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 	... 	$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;#whiteboard a.image-ok&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">live</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;click&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>event<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;#whiteboard a.image-ok&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">css</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;display&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;none&quot;</span><span style="color: #009900;">&#41;</span>; 		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;#whiteboard a.options&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">css</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;display&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;block&quot;</span><span style="color: #009900;">&#41;</span>; 		whiteboard.<span style="color: #660066;">validateImage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>; 	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 	... 	<span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span> &lt;/head&gt;</pre> <p>Et nous voici au bas d’un document HTML très complet, qui fait appel à de nombreuses librairies, de nombreuses technologies mais qui ne fait pourtant que 172 lignes&nbsp;! <a href="https://github.com/Swiip/shared-whiteboard/blob/master/public/index.html">https://github.com/Swiip/shared-whiteboard/blob/master/public/index.html</a></p> <h2>Conclusion</h2> <p>Un peu plus de 200 lignes en plus des modifications dans la librairie Sketchpad, nous sommes encore loin des 500 lignes et pourtant les critères d’un service cloud sont respectés. Bien sûr, c’est un embryon de service, les bases techniques fonctionnent mais nombre de questions se poseront à l’intrépide qui voudra lancer son service cloud&nbsp;: scalabilité (même si sur le papier tout est prévu), marketing, design, communication, rentabilisation. Le but était de démontrer que les technologies actuelles permettent d’aller extremement loin pour en quelques lignes de code. Bien sûr, encore faut il comprendre chaque technologies, s’en servir à bon escient et réussir à les intégrer.</p> <p>Les sources du projet sont toutes disponibles sur GitHub <a href="https://github.com/Swiip/shared-whiteboard">https://github.com/Swiip/shared-whiteboard</a></p> <p>Le projet manque de documentation et de finalisation mais il n’est pas voué à devenir une référence en la matière. Toutefois, si certains s’y intéressent, je répondrais à toutes les questions s’y rapportant.</p> <p><em>Article paru dans l'édition de janvier du magazine Programmez !</em></p>