---
ID: 108
post_title: >
  Comment coincer 20 clowns dans une
  voiture
author: slorber
post_date: 2012-02-17 15:11:00
post_excerpt: |
  <p>Chez Zenika, on aime les challenges techniques.<br />
  Aussi, quand on a vu le Java Champion Heinz Kabutz <a href="https://twitter.com/#!/heinzkabutz/status/170267208751120384">retweeter</a> un quiz technique, on n'a pas pu résister :)</p> <p><a href="http://wouter.coekaerts.be/2012/puzzle-clowns">Le sujet du quiz</a>&nbsp;: comment faire rentrer 20 clowns dans une voiture&nbsp;?</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=108
published: true
---
<p>Chez Zenika, on aime les challenges techniques.<br />
Aussi, quand on a vu le Java Champion Heinz Kabutz <a href="https://twitter.com/#!/heinzkabutz/status/170267208751120384">retweeter</a> un quiz technique, on n'a pas pu résister :)</p> <p><a href="http://wouter.coekaerts.be/2012/puzzle-clowns">Le sujet du quiz</a>&nbsp;: comment faire rentrer 20 clowns dans une voiture&nbsp;?</p>
<!--more-->
<p>Voici notre solution&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> ClownStuffer <span style="color: #000000;">&#123;</span> &nbsp;     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">final</span> <span style="color: #7F0055; font-weight: bold;">int</span> NB_CLOWNS = <span style="color: #cc66cc;">20</span>;     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">final</span> Volkswagen vw = <span style="color: #7F0055; font-weight: bold;">new</span> Volkswagen<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">final</span> CountDownLatch latch = <span style="color: #7F0055; font-weight: bold;">new</span> CountDownLatch<span style="color: #000000;">&#40;</span>NB_CLOWNS<span style="color: #000000;">&#41;</span>; &nbsp;     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">void</span> main<span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span> args<span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> <span style="color: #000000;">InterruptedException</span> <span style="color: #000000;">&#123;</span> &nbsp;         <span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> i = 0; i <span style="color: #000000;">&lt;</span> NB_CLOWNS; i++<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>             <span style="color: #000000;">Thread</span> t = <span style="color: #7F0055; font-weight: bold;">new</span> <span style="color: #000000;">Thread</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>                 <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> run<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>                     vw.<span style="color: #000000;">add</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> MyClown<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;                     latch.<span style="color: #000000;">countDown</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;                 <span style="color: #000000;">&#125;</span>             <span style="color: #000000;">&#125;</span>;             t.<span style="color: #000000;">start</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;         <span style="color: #000000;">&#125;</span> &nbsp;         latch.<span style="color: #000000;">await</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;         vw.<span style="color: #000000;">done</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;     <span style="color: #000000;">&#125;</span> &nbsp;     <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">class</span> MyClown <span style="color: #7F0055; font-weight: bold;">extends</span> Clown <span style="color: #000000;">&#123;</span> &nbsp;         <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">int</span> nbClowns = 0; &nbsp;         @Override         <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">int</span> hashCode<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>             <span style="color: #7F0055; font-weight: bold;">synchronized</span> <span style="color: #000000;">&#40;</span>vw<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>                 nbClowns++;                 <span style="color: #7F0055;font-weight: bold;">while</span> <span style="color: #000000;">&#40;</span>nbClowns <span style="color: #000000;">!</span>= NB_CLOWNS<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>                     <span style="color: #7F0055; font-weight: bold;">try</span> <span style="color: #000000;">&#123;</span>                         <span style="color: #808080; font-style: italic;">// Needed to release the monitor so that other threads can call add()</span>                         vw.<span style="color: #000000;">wait</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;                     <span style="color: #000000;">&#125;</span> <span style="color: #7F0055; font-weight: bold;">catch</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">InterruptedException</span> ignored<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>                     <span style="color: #000000;">&#125;</span>                 <span style="color: #000000;">&#125;</span>                 vw.<span style="color: #000000;">notifyAll</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;             <span style="color: #000000;">&#125;</span>             <span style="color: #7F0055; font-weight: bold;">return</span> <span style="color: #7F0055; font-weight: bold;">super</span>.<span style="color: #000000;">hashCode</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;         <span style="color: #000000;">&#125;</span>     <span style="color: #000000;">&#125;</span> <span style="color: #000000;">&#125;</span></pre> <p>Une petite explication s'impose. Ce code&nbsp;:</p> <ul> <li>crée 20 threads</li> <li>les fait tous rentrer un par un dans la methode <code>Volkswagen.add()</code></li> <li>les met en attente avant que la taille du <code>Set</code> ne soit réellement incrémentée, de manière à esquiver le test et à ne jamais lever l'exception</li> <li>les relâche une fois que les 20 clowns ont passé la vérification sur la taille du <code>Set</code></li> <li>et pour finir, appelle la méthode <code>done()</code> qui constate la présence de la bande de joyeux drilles sur la banquette arrière. Victoire&nbsp;!</li> </ul> <p>Toute la subtilité réside dans le fait que la methode <code>Volkswagen.add</code> est synchronisée. Dans la méthode <code>hashCode</code>, il était donc nécessaire de relâcher le moniteur afin que d'autres clowns puissent être ajoutés&nbsp;: c'est le rôle de l'instruction <code>wait()</code>, qui joue également le rôle de synchroniseur inter-threads.</p> <p>Si vous trouvez d'autres solutions, vous pouvez les poster dans les commentaires&nbsp;!</p>