---
ID: 298
post_title: >
  Bruno Lowagie se dévoile dans iText in
  Action
author: orudent
post_date: 2011-01-19 19:08:00
post_excerpt: |
  <h2>Conférence iText in action par son créateur</h2> <p><br />
  <strong>Jeudi 10 mars, <a href="http://www.zenika.com/expert?expert=9">Bruno Lowagie</a>, l'auteur de la librairie Java PDF iText, sera exceptionnellement en France pour vous présenter les nouveautés de la deuxième édition de son livre "<a href="http://www.manning.com/lowagie2/">iText in Action</a>".</strong></p> <p>A cette occasion, <a href="http://www.zenika.com/expert?expert=9">Bruno</a> vous guidera à travers la table de contenu à l'aide d'une série d'exemples inédits. 5 exemples seront examinés plus en détail:</p> <ul> <li>Comment utiliser des templates pour générer des factures,</li> <li>La difference entre les technologies 'AcroForm' et 'XFA' pour les formulaires,</li> <li>Utiliser du contenu optionnel dans un document PDF,</li> <li>Les avantages de créer un fichier "portable collection", et</li> <li>Comment (et pourquoi) intégrer une application Flash dans un fichier PDF.</li> </ul>
layout: post
permalink: http://blog.zenika-offres.com/?p=298
published: true
---
<h2>Conférence iText in action par son créateur</h2> <p><br />
<strong>Jeudi 10 mars, <a href="http://www.zenika.com/expert?expert=9">Bruno Lowagie</a>, l'auteur de la librairie Java PDF iText, sera exceptionnellement en France pour vous présenter les nouveautés de la deuxième édition de son livre "<a href="http://www.manning.com/lowagie2/">iText in Action</a>".</strong></p> <p>A cette occasion, <a href="http://www.zenika.com/expert?expert=9">Bruno</a> vous guidera à travers la table de contenu à l'aide d'une série d'exemples inédits. 5 exemples seront examinés plus en détail:</p> <ul> <li>Comment utiliser des templates pour générer des factures,</li> <li>La difference entre les technologies 'AcroForm' et 'XFA' pour les formulaires,</li> <li>Utiliser du contenu optionnel dans un document PDF,</li> <li>Les avantages de créer un fichier "portable collection", et</li> <li>Comment (et pourquoi) intégrer une application Flash dans un fichier PDF.</li> </ul>
<!--more-->
<p>Pour finir, <a href="http://www.zenika.com/expert?expert=9">Bruno</a> parlera de ses futurs projets, entre autres en faisant la démonstration d'une application 'Hello World' sur <a href="http://www.android.com/">Android</a>.</p> <p>Ce sera l'occasion unique d'échanger sur ces sujets avec <a href="http://www.zenika.com/expert?expert=9">Bruno Lowagie</a>.</p> <p><strong>Inscrivez-vous dès maintenant à la <a href="http://www.zenika.com/reporting/itext_in_action?fg=50007">conférence</a>!</strong></p> <h2>Exclusif: un extrait de la seconde édition d'iText in Action!</h2> <p><br />
<strong>Nous sommes très heureux de vous offrir en avant-première un article tiré d'iText in Action, Seconde Edition. Cet article présente l'intégration d'un contenu Flash dans un document PDF, et les intérêts que cela peut avoir.</strong></p> <p><strong>Nous espérons que vous apprécierez ce texte autant que nous, un grand merci à Bruno et à Manning d'avoir bien voulu diffuser un extrait. Si vous appréciez ce texte, n'hésitez pas à acheter le <a href="http://www.manning.com/lowagie2/">livre</a>, qui à Zenika est l'un des plus empruntés à la bibliothèque. Merci Bruno encore.</strong> <br /><br /></p> <p><img src="/wp-content/uploads/2015/07/livre_couverture.jpg" alt="iText in Action" style="float:left; margin: 0 1em 1em 0;" title="iText in Action" /></p> <p><br />
This article is taken from the book iText in Action, Second Edition. The author discusses a rich media annotation that embeds a Flash application into a PDF document.<br /></p> <p>You can embed a Flash application (a .swf file) into a PDF document using a movie annotation. This works well for a Flash movie, but if you want to embed a Flash application, you’ll discover that the interactive features are rather limited. If you want to take advantage of all the functionality of a Flash application, you’ll need to embed the .swf file as a rich media annotation. This was the case for the PDF shown in figure 1.</p> <p><img src="/wp-content/uploads/2015/07/.Figure_1_m.jpg" alt="Figure 1" style="display:block; margin:0 auto;" title="Figure 1" /><br /></p> <p>Figure 1 Integrating a Flash application in a PDF document<br /></p> <p>The combo box with dates, the button for selecting a day, and the table listing screenings on a particular day are all part of a Flash application written in Flex.</p> <h3>Writing a Flex application<br /></h3> <p>This listing shows the source code of the Flex application.<br /></p> <h4>Listing 1 FestivalCalendar1.mxml</h4> <p><br /></p> <pre>&lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"  layout="absolute"  applicationComplete="stage.scaleMode = StageScaleMode.EXACT_FIT;   #1  initList(Application.application.parameters.day);"&gt;   #2  &lt;mx:Script&gt;    &lt;![CDATA[      private function initList(day:Object):void {    #A        days.selectedItem = day;    #A        getDateInfo(days.selectedItem);    #A      }    #A      private function getDateInfo(day:Object):void {     #B        screeningsService.url=     #B          'http://flex.itextpdf.org/fff/day_'     #B          + day + '.xml';     #B        screeningsService.send();     #B        screeningsDataGrid.invalidateList();     #B      }     #B    ]]&gt;  &lt;/mx:Script&gt;  &lt;mx:HTTPService    #C    id="screeningsService" resultFormat="e4x" /&gt;    #C  &lt;mx:Grid id="formgrid"&gt;    &lt;mx:GridRow id="row1"&gt;      &lt;mx:GridItem&gt;        &lt;mx:ComboBox id="days" dataProvider="{[     #D          '2011-10-12', '2011-10-13', '2011-10-14',     #D          '2011-10-15', '2011-10-16', '2011-10-17',     #D          '2011-10-18', '2011-10-19' ]}" /&gt;     #D      &lt;/mx:GridItem&gt;      &lt;mx:GridItem&gt;        &lt;mx:Button id="date" label="Select day"    #E          click="getDateInfo(days.selectedItem);" /&gt;    #E      &lt;/mx:GridItem&gt;    &lt;/mx:GridRow&gt;    &lt;mx:GridRow id="row2"&gt;      &lt;mx:GridItem colSpan="2"&gt;        &lt;mx:DataGrid id="screeningsDataGrid"     #F          dataProvider=     #F            "{screeningsService.lastResult.screening}"&gt;     #F          &lt;mx:columns&gt;     #F            &lt;mx:DataGridColumn     #F              headerText="Time" dataField="time"/&gt;     #F            &lt;mx:DataGridColumn headerText="Location"     #F              dataField="location"/&gt;     #F            &lt;mx:DataGridColumn headerText="Duration"     #F              dataField="duration"/&gt;     #F            &lt;mx:DataGridColumn     #F              headerText="Title" dataField="title"/&gt;            &lt;mx:DataGridColumn              headerText="Year" dataField="year"/&gt;          &lt;/mx:columns&gt;     #F        &lt;/mx:DataGrid&gt;     #F      &lt;/mx:GridItem&gt;    &lt;/mx:GridRow&gt;  &lt;/mx:Grid&gt; &lt;/mx:Application&gt; #A Initializes date #B Gets data for specific day #C Fetches XML file #D Displays combo box with dates #E Displays button to trigger getDateInfo method #F Displays grid containing screening info<br /></pre> <p>This listing is easy to understand even if you’ve never written a Flex application. There are two methods written in ActionScript inside the Script tag. The object defined with the HTTPService tag will be responsible for making a connection to a site and retrieving data about screenings in the form of an XML file (resultFormat="e4x").<br /></p> <p>The layout of the UI is defined using a Grid containing two GridRows. The first row has two GridItems: a ComboBox with days ranging from 2011-10-12 to 2011-10-19, and a Button with the label "Select day". The item in the second row has colspan 2, and contains a DataGrid with five DataGridColumns: Time, Location, Duration, Title, and Year. The data provider for this data grid is the last result of the HTTPService with id screeningsService.<br /></p> <p>This .mxml file was compiled into an .swf file using Flex Builder. This .swf file can be embedded into an HTML file, but you’re going to integrate it into a PDF document.<br /></p> <h3>Fetching XML data from a server<br /></h3> <p>This example shows the XML file that is fetched by this service for October 12.<br /></p> <h4>Listing 2 http://flex.itextpdf.org/fff/day_2011-10-12.xml</h4> <pre>&lt;day date="2011-10-12"&gt; &lt;screening&gt;  &lt;location&gt;GP.3&lt;/location&gt;  &lt;time&gt;09:30:00&lt;/time&gt;  &lt;duration&gt;98&lt;/duration&gt;  &lt;title&gt;The Counterfeiters&lt;/title&gt;  &lt;year&gt;2007&lt;/year&gt; &lt;/screening&gt; &lt;screening&gt;  &lt;location&gt;GP.3&lt;/location&gt;  &lt;time&gt;11:30:00&lt;/time&gt;  &lt;duration&gt;120&lt;/duration&gt;  &lt;title&gt;Give It All&lt;/title&gt;  &lt;year&gt;1998&lt;/year&gt; &lt;/screening&gt; ... &lt;/day&gt;<br /></pre> <p>You’ve indicated that you’re looking for screening nodes in the dataProvider of the DataGrid. As a result, the data grid will have a line for every screening tag in the XML, containing the contents of the dataField defined in the DataGridColumn.<br /></p> <p>To make this work, you need to put XML files for every date in the combo box in the appropriate place on our web server, but this may not be sufficient. This will work for HTML and .swf files that are hosted on the same domain as the data files, but it won’t work in a PDF that is opened on somebody’s local machine. The Flash player that runs the Flash application—in a browser, or in a PDF viewer—operates in a secure sandbox. This sandbox will prevent the application from accessing the user’s filesystem, and from fetching data from a remote website.<br /></p> <p>In this case, the Flex application won’t be allowed to access the XML files outside the domain to which the application is deployed, unless the owner of the site where the XML files reside allows it. If you open a PDF containing this Flex application locally, you are not on the http://flex.itextpdf.org/ domain, and Adobe Reader will open a dialog box with the following security warning:<br /></p> <p>The document is trying to connect to http://flex.itextpdf.org/crossdomain.xml. If you trust the site, choose Allow. If you do not trust the site, choose Block.<br /></p> <p>The next bit of code shows the contents of the crossdomain.xml file that I had to put at the root of the flex.itextpdf.org domain in order to grant access to any Flex application from any domain.<br /></p> <h4>Listing 3 crossdomain.xml<br /></h4> <pre>&lt;?xml version="1.0"?&gt; &lt;!DOCTYPE cross-domain-policy SYSTEM "http://www.adobe.com/xml/dtds/cross-domain-policy.dtd"&gt; &lt;cross-domain-policy&gt;  &lt;site-control permitted-cross-domain-policies="all"/&gt;  &lt;allow-access-from domain="*" /&gt;  &lt;allow-http-request-headers-from domain="*" headers="*"/&gt; &lt;/cross-domain-policy&gt;<br /></pre> <p>If such a file isn’t there, or if it doesn’t allow everyone access, the Flex application won’t be able to retrieve the data.<br /></p> <p>Even with the crossdomain.xml file in place, Adobe Reader will show a security warning every time an XML file (for instance, <br /></p> <p>http://flex.itextpdf.org/fff/day_2011-10-12.xml) is fetched, unless you check the Remember My Action for This Site check box.<br /></p> <p><strong>NOTE</strong> Most SWF files that can be found on the market are written to be embedded in HTML files. In theory, you can embed all these files in a PDF document. However, if the SWF files were created using Flex Builder, you may experience problems when zooming in and out, or when printing a page that has a rich media annotation. Thes
e problems are caused by the default scale mode. To avoid them, you need to change the scale mode as is done in line #1 in listing 1: stage.scaleMode = StageScaleMode.EXACT_FIT. This is important if you buy a Flash component that was written using Flex Builder and that was intended for use in HTML. You need to make sure the vendor has taken this into account if you want to use the .swf in a PDF document.<br /></p> <p>Now that you know how the Flex application was written, let’s look at how you can integrate it into a PDF document.<br /></p> <h3>Rich media annotations<br /></h3> <p>Rich media annotations aren’t part of ISO-32000-1. Support for these annotations was added by Adobe in PDF 1.7 extension level 3. In this case, it isn’t sufficient to change the version number to 1.7 with setPdfVersion(); you also have to set the extension level with the addDeveloperExtension() method. You can do this more than once if you’re using extensions from different companies.<br />
The method expects an instance of the PdfDeveloperExtension class. In listing 4, you use the static final object ADOBE_1_7_EXTENSIONLEVEL3. This value was created like this: <br /></p> <p>new PdfDeveloperExtension(PdfName.ADBE, PdfWriter.PDF_VERSION_1_7, 3)<br /></p> <p>The first parameter refers to the developing company. The second parameter indicates for which PDF version the extension was written. Finally, you pass in the number of the extension level as an int.<br /></p> <h4>Listing 4 FestivalCalendar1.java<br /></h4> <pre>Document document = new Document(); PdfWriter writer  = PdfWriter.getInstance(document, new FileOutputStream(RESULT)); writer.setPdfVersion(PdfWriter.PDF_VERSION_1_7);    #A writer.addDeveloperExtension(    #A  PdfDeveloperExtension.ADOBE_1_7_EXTENSIONLEVEL3);    #A document.open(); RichMediaAnnotation richMedia    #B  = new RichMediaAnnotation(writer,    #B    new Rectangle(36, 400, 559,806));    #B PdfFileSpecification fs =    #C  PdfFileSpecification.fileEmbedded(    #C    writer, RESOURCE, "FestivalCalendar1.swf", null);    #C PdfIndirectReference asset    #C  = richMedia.addAsset("FestivalCalendar1.swf", fs);    #C RichMediaConfiguration configuration    #D  = new RichMediaConfiguration(PdfName.FLASH);    #D RichMediaInstance instance    #D  = new RichMediaInstance(PdfName.FLASH);    #D RichMediaParams flashVars = new RichMediaParams();    #D String vars = new String("&amp;day=2011-10-13");    #D flashVars.setFlashVars(vars);    #D instance.setParams(flashVars);    #D instance.setAsset(asset);    #D configuration.addInstance(instance);    #D PdfIndirectReference configurationRef    #D  = richMedia.addConfiguration(configuration);    #D RichMediaActivation activation = new RichMediaActivation();    #E activation.setConfiguration(configurationRef);    #E richMedia.setActivation(activation);    #E PdfAnnotation richMediaAnnotation = richMedia.createAnnotation(); richMediaAnnotation.setFlags(PdfAnnotation.FLAGS_PRINT); writer.addAnnotation(richMediaAnnotation); document.close(); #A Sets version and extension level #B Creates annotation object #C Adds .swf file as asset #D Configures RichMedia annotation as Flash app #E Sets activation dictionary<br /></pre> <p>The RichMediaAnnotation class isn’t a subclass of PdfAnnotation, but it can create such an object using the method createAnnotation(). The rich media annotation dictionary contains two important entries: a /RichMediaContent dictionary and a /RichMedia-Settings dictionary. These dictionaries are created internally by iText.<br /></p> <p>The RichMediaContent dictionary consists of the assets, the configuration, and the views:<br /></p> <ul> <li><em>Assets</em> - These are stored as a name tree with embedded file specifications. You can use the addAsset() method to add entries to this name tree.<br /></li> <li><em>Configuration</em> - This is an array of RichMediaConfiguration objects. Such an object contains an array of RichMediaInstance objects.<br /></li> <li><em>Views</em> - This is an array of 3D view dictionaries, in case the rich media annotation contains a 3D stream. <br /></li> </ul> <p>The RichMediaConfiguration dictionary describes a set of instances that are loaded for a given scene configuration. In this example, you use a rich media annotation to embed a Flash application, but you can also use such an annotation for 3D, sound, or video objects.<br />
The constructors of the RichMediaConfiguration and RichMediaInstance classes accept the following parameters:<br /></p> <ul> <li>PdfName._3D—For 3D objects<br /></li> <li>PdfName.FLASH—For Flash objects<br /></li> <li>PdfName.SOUND—For sound objects<br /></li> <li>PdfName.VIDEO—For video objects<br /></li> </ul> <p>A RichMediaInstance dictionary describes a single instance of an asset with settings to populate the artwork of an annotation. In this example, you only have one Flash instance, for which you define /FlashVars: &amp;day=2011-10-13. The day variable is retrieved in line #2 of listing 1: Application.application.parameters.day.<br /></p> <p><strong>NOTE</strong> If you want to reuse the RichMediaContent dictionary in more than one rich media annotation, you have to create the first RichMediaAnnotation as is done in listing 4. You can then get a reference to the RichMediaContent dictionary with the getRichMediaContentReference() method, and use this reference as an extra parameter for the RichMediaAnnotation constructor.<br />
Rich media annotations can be active or inactive. The RichMediaSettings dictionary stores conditions and responses that determine when the annotation should be activated and deactivated. iText creates this dictionary automatically, just like the RichMediaContent dictionary. It can contain a RichMediaActivation dictionary that is set with the method setActivation(), and a RichMediaDeactivation dictionary set with set-Deactivation(). Listing 4 uses the default activation and deactivation conditions.<br />
The possible conditions for activation—set with setCondition()—are:<br /></p> <ul> <li>PdfName.XA—The annotation is explicitly activated by a user action or script; this is the default.<br /></li> <li>PdfName.PO—The annotation is activated as soon as the page that contains the annotation receives focus as the current page.<br /></li> <li>PdfName.PV—The annotation is activated as soon as any part of the page that contains the annotation becomes visible.<br /></li> </ul> <p>These are the possible conditions for deactivation—also set with setCondition():<br /></p> <ul> <li>PdfName.XD—The annotation is explicitly deactivated by a user action or script; this is the default.<br /></li> <li>PdfName.PC—The annotation is deactivated as soon as the page that contains the annotation loses focus as the current page.<br /></li> <li>PdfName.PI—The annotation is deactivated as soon as the entire page that contains the annotation is no longer visible.<br /></li> </ul> <p>In the RichMediaActivation dictionary, you can also add keys to specify the animation, the view, presentation, and scripts.<br /></p> <p>This first “Flash in PDF” example is cool because you have a PDF document that presents data to the end user that isn’t part of the PDF document. I know from experience that the schedule of screenings at a film festival can change at any moment, because the film stock didn’t arrive on time or some other reason. By using this Flash application written in Flex, the document can always show the most recent information fetched from the official film festival website.<br /></p> <p>You could use the same technique to get the most recent items and prices to complete an order form in PDF. To achieve this, you’d need to establish communication between the embedded Flex application and the PDF document.<br /></p> <p>Figure 2 shows a series of widget annotations (PDF), and one rich media annotation (Flash). The sentence, “This is the festival program for 2011-10-14”, is shown using a read-only text field. The text is updated using a JavaScript method that is triggered by the rich media annotation. The buttons with the different dates call a Rich-MediaExecuteAction that executes an ActionScript method in the Flash application.<br /></p> <p><img src="/wp-content/uploads/2015/07/.Figure_2_m.jpg" alt="Figure 2" style="display:block; margin:0 auto;" title="Figure 2" /></p> <p>Figure 2 Communication between PDF and Flash <br /></p> <p>The Flex application, in the next listing, is different from the previous example.<br /></p> <h4>Listing 5 FestivalCalendar2.mxml<br /></h4> <pre>&lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"  layout="absolute" width="525" height="200" applicationComplete=  "stage.scaleMode = StageScaleMode.EXACT_FIT;init();"&gt;  &lt;mx:Script&gt;    &lt;![CDATA[      import flash.external.*;    #1      private function init():void {        ExternalInterface.addCallback("getDateInfo", getDateInfo);    #2      }      private function getDateInfo(day:Object):void {        screeningsService.url=          'http://flex.itextpdf.org/fff/day_' + day + '.xml';        screeningsService.send();        screeningsDataGrid.invalidateList();        ExternalInterface.call("showDate", day);    #3      }    ]]&gt;  &lt;/mx:Script&gt;  &lt;mx:HTTPService    #A    id="screeningsService" resultFormat="e4x" /&gt;    #A  &lt;mx:DataGrid id="screeningsDataGrid"    #B    dataProvider=    #B      "{screeningsService.lastResult.screening}"    #B    width="100%" height="100%"&gt;    #B    &lt;mx:columns&gt;    #B      &lt;mx:DataGridColumn    #B        headerText="Time" dataField="time"/&gt;    #B      &lt;mx:DataGridColumn    #B        headerText="Location" dataField="location"/&gt;    #B      &lt;mx:DataGridColumn    #B        headerText="Duration" dataField="duration"/&gt;    #B      &lt;mx:DataGridColumn    #B        headerText="Title" dataField="title"/&gt;    #B      &lt;mx:DataGridColumn    #B        headerText="Year" dataField="year"/&gt;    #B      &lt;/mx:columns&gt;    #B   &lt;/mx:DataGrid&gt;    #B &lt;/mx:Application&gt;    #B #1 Imports package #2 Registers AS method #3 Calls JS method #A HTTP service to fetch XML file #B Grid containing screening info<br /></pre> <p>You’ll recognize the HTTP service that will get the XML files from http://flex.itextpdf.org/ and the data grid that visualizes the XML data. You no longer need the combo box and the button, because you’re going to change the data from outside the Flex application.<br /></p> <p>You import the flash.external.* package (#1), because you’re going to use the ExternalInterface object. With the addCallback() method (#2), you make the ActionScript method getDateInfo() in the Flex application available for external applications. In this method, you call the JavaScript showDate() method that is supposed to be present in the PDF document by using the call() method (#3).<br /></p> <pre>The showDate() JavaScript method in the PDF is very simple:<br />
function showDate(txt) {  this.getField("date").value    = "This is the festival program for " + txt; }</pre> <p>It gets the text field with the name date, and it changes the value of this field so that it corresponds with the date for which the screenings are shown.<br />
The first part of this next listing should look familiar.<br /></p> <h4>Listing 6 FestivalCalendar2.java<br /></h4> <pre>Document document = new Document(); PdfWriter writer  = PdfWriter.getInstance(document, new FileOutputStream(RESULT)); writer.setPdfVersion(PdfWriter.PDF_VERSION_1_7); writer.addDeveloperExtension(  PdfDeveloperExtension.ADOBE_1_7_EXTENSIONLEVEL3); document.open(); writer.addJavaScript(Utilities.readFileToString(JS));   #A RichMediaAnnotation richMedia   #B  = new RichMediaAnnotation(   #B    writer, new Rectangle(36, 560, 561, 760));   #B PdfFileSpecification fs = PdfFileSpecification   #B  .fileEmbedded(writer, RESOURCE,   #B    "FestivalCalendar2.swf", null);   #B PdfIndirectReference asset   #B  = richMedia.addAsset("FestivalCalendar2.swf", fs);   #B RichMediaConfiguration configuration   #B  = new RichMediaConfiguration(PdfName.FLASH);   #B RichMediaInstance instance   #B  = new RichMediaInstance(PdfName.FLASH);   #B instance.setAsset(asset);   #B configuration.addInstance(instance);   #B PdfIndirectReference configurationRef   #B  = richMedia.addConfiguration(configuration);   #B RichMediaActivation activation   #B  = new RichMediaActivation();   #B activation.setConfiguration(configurationRef);   #B richMedia.setActivation(activation);   #B PdfAnnotation richMediaAnnotation   #B  = richMedia.createAnnotation(); richMediaAnnotation.setFlags(PdfAnnotation.FLAGS_PRINT); writer.addAnnotation(richMediaAnnotation); String<a href=""></a> days = new String<a href=""></a>{"2011-10-12",   #C  "2011-10-13", "2011-10-14", "2011-10-15",   #C  "2011-10-16", "2011-10-17", "2011-10-18",   #C  "2011-10-19"};   #C for (int i = 0; i &lt; days.length; i++) {   #C  Rectangle rect = new Rectangle(   #C    36 + (65 * i), 765, 100 + (65 * i), 780);   #C  PushbuttonField button   #C    = new PushbuttonField(writer, rect, "button" + i);   #C  button.setBackgroundColor(new GrayColor(0.75f));   #C  button.setBorderStyle(   #C    PdfBorderDictionary.STYLE_BEVELED);   #C  button.setTextColor(GrayColor.GRAYBLACK);   #C  button.setFontSize(12);   #C  button.setText(days<a href="i" title="i">i</a>);   #C  button.setLayout(   #C    PushbuttonField.LAYOUT_ICON_LEFT_LABEL_RIGHT);   #C  button.setScaleIcon(   #C    PushbuttonField.SCALE_ICON_ALWAYS);   #C  button.setProportionalIcon(true);   #C  button.setIconHorizontalAdjustment(0);   #C  PdfFormField field = button.getField();   #C  RichMediaCommand command = new RichMediaCommand(   #D    new PdfString("getDateInfo"));   #D  command.setArguments(new PdfString(days<a href="i" title="i">i</a>));   #D  RichMediaExecuteAction action   #E    = new RichMediaExecuteAction(   #E      richMediaAnnotation.getIndirectReference(),   #E      command);   #E  field.setAction(action);  writer.addAnnotation(field); } TextField text = new TextField(writer,   #F  new Rectangle(36, 785, 559, 806), "date");   #F text.setOptions(TextField.READ_ONLY);   #F writer.addAnnotation(text.getTextField());   #F document.close(); #A Adds JavaScript #B Adds rich media annotation #C Adds buttons #D Creates rich media command #E Creates rich media action #F Adds text field<br /></pre> <p>In the second half of the previous listing, you add a series of buttons to the document, creating a RichMediaExecuteAction for each button. The action will be triggered on the rich media annotation for which you pass the indirect reference. You also pass a RichMediaCommand.<br /></p> <p>The name of the action is a PDF string that corresponds to the string you used as the parameter of the ExternalInterface.addCallback() method in the Flex application. The argument can be a PdfString, PdfNumber, PdfBoolean, or PdfArray containing those objects.<br /></p> <p>You also add a text field named date. When you click one of the PDF buttons, the getDateInfo() method will be called, an XML file containing screenings will be fetched from the internet, filling the data grid, and the Flex application will trigger the showDate() JavaScript method to change the value of the date field.<br /></p> <p>Although this is a very simple example, the techniques that are used can apply to many different types of applications. You could use these techniques to integrate fancy Flash buttons that trigger functions in a PDF file, or you could embed a Flex application to establish client-server communication to retrieve the most recent data. But don’t forget that this functionality is very new: it only works with the most recent versions of Adobe Reader!<br /></p> <h3>Summary<br /></h3> <p>We discussed rich media annotation. There’s a difference between file attachments that are added as annotations, and file attachments that are stored at the document level as embedded files. This difference matters if you want to extract files from a PDF document. Files that are embedded at the document level can be organized into a portable collection, aka a portfolio.<br /></p> <h5>Bénéficiez d'une réduction de 42% sur la version papier et recevez gratuitement la version pdf en allant sur le <a href="http://www.manning.com/">site Manning</a>. Code: itext42</h5>