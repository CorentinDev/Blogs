---
ID: 398
post_title: >
  Clusteriser une application web avec
  TCServer et Terracotta
author: ocroisier
post_date: 2009-06-22 18:40:00
post_excerpt: '<p>La majorité des applications produites de nos jours sont des applications web. Si leur conception et leur développement sont relativement bien maîtrisées, la mise en place de tests réalistes demeure trop souvent problématique en raison de la forte différence entre les environnements de développement et de production. En particulier, les problèmes de mise en cluster (load-balancing, réplication de session) et de montée en charge sont difficilement reproductibles localement.</p> <p>Dans cet article, nous verrons comment utiliser TCServer et Terracotta pour mettre en place un mini-cluster de serveurs web en quelques minutes et déployer dessus une application simple avec réplication de sessions.</p>'
layout: post
permalink: http://blog.zenika-offres.com/?p=398
published: true
---
<p>La majorité des applications produites de nos jours sont des applications web. Si leur conception et leur développement sont relativement bien maîtrisées, la mise en place de tests réalistes demeure trop souvent problématique en raison de la forte différence entre les environnements de développement et de production. En particulier, les problèmes de mise en cluster (load-balancing, réplication de session) et de montée en charge sont difficilement reproductibles localement.</p> <p>Dans cet article, nous verrons comment utiliser TCServer et Terracotta pour mettre en place un mini-cluster de serveurs web en quelques minutes et déployer dessus une application simple avec réplication de sessions.</p>
<!--more-->
<p>Notes préalables&nbsp;:</p> <ul> <li>Les répertoires et commandes présentés ici correspondent à un environnement Linux. Adaptez-les si besoin à votre propre environnement.</li> <li>L'étude de cas présentée ici utilise TCServer 6.0.19.A et Terracotta 3.0.1. Ces numéros de version peuvent apparaître dans des noms de répertoires ou de scripts. Adaptez-les au besoin.</li> <li>TCServer et Terracotta ont la fâcheuse tendance à être abrégés en "TC" et à utiliser des variables d'environnement reprenant cette notation, ce qui peut entraîner des petits problèmes de lisibilité...</li> </ul> <h3>Présentation de l'application web</h3> <p>Pour cet article, nous utiliserons une application web très simple, consistant à incrémenter un compteur de visites placé en session. L'unique page JSP affiche la valeur courante du compteur.</p> <p>Afin de gérer proprement la concurrence d'accès au compteur de visites, l'application utilise une variable de type AtomicInteger, qui offre une méthode getAndIncrement() garantie atomique&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> CounterServlet <span style="color: #7F0055; font-weight: bold;">extends</span> HttpServlet <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">final</span> <span style="color: #000000;">String</span> COUNTER_SESSION_ATTRIBUTE = <span style="color: #888888;">&quot;counter&quot;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> doGet<span style="color: #000000;">&#40;</span>HttpServletRequest request, HttpServletResponse response<span style="color: #000000;">&#41;</span> </div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #7F0055; font-weight: bold;">throws</span> ServletException, <span style="color: #000000;">IOException</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		HttpSession session = request.<span style="color: #000000;">getSession</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		AtomicInteger counter = <span style="color: #000000;">&#40;</span>AtomicInteger<span style="color: #000000;">&#41;</span> session.<span style="color: #000000;">getAttribute</span><span style="color: #000000;">&#40;</span>COUNTER_SESSION_ATTRIBUTE<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #7F0055; font-weight: bold;">int</span> counterValue = counter.<span style="color: #000000;">getAndIncrement</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		request.<span style="color: #000000;">setAttribute</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;counterValue&quot;</span>, counterValue<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		RequestDispatcher dispatcher = request.<span style="color: #000000;">getRequestDispatcher</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;/WEB-INF/jsp/counter.jsp&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		dispatcher.<span style="color: #000000;">forward</span><span style="color: #000000;">&#40;</span>request, response<span style="color: #000000;">&#41;</span>;		</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>Un SessionListener permet d'initialiser un nouveau compteur à chaque création de session, et de garantir sa présence avant l'appel de la servlet&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> CounterInitializerListener <span style="color: #7F0055; font-weight: bold;">implements</span> HttpSessionListener <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> sessionCreated<span style="color: #000000;">&#40;</span>HttpSessionEvent event<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	HttpSession session = event.<span style="color: #000000;">getSession</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	session.<span style="color: #000000;">setAttribute</span><span style="color: #000000;">&#40;</span>CounterServlet.<span style="color: #000000;">COUNTER_SESSION_ATTRIBUTE</span>, <span style="color: #7F0055; font-weight: bold;">new</span> AtomicInteger<span style="color: #000000;">&#40;</span>0<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li
style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>Le but est évidemment de constater que le compteur s'incrémente de manière continue lorsque l'application est correctement clusterisée.</p> <h3>Déploiement de TC Server</h3> <h4>Installation de TC Server</h4> <p>Commençons par installer le cluster de serveurs web.<br />
Sur <a href="http://www.springsource.com/products/tcserver">le site de TCServer</a>, téléchargez l'archive correspondant à votre système d'exploitation puis décompressez-la dans un répertoire temporaire. Lancez le script "<code>run.sh</code>" et laissez-vous guider pour installer la SpringSource Application Management Suite (AMS) et/ou TCServer - pour cet article, nous nous contenterons de TCServer. Choisissez son répertoire d'installation, par exemple "<code>/opt/Java/Tools/TCServer</code>"&nbsp;; cet emplacement sera appelé "<code>&lt;TC_INSTALL_DIR&gt;</code>" par la suite.</p> <p>Pour éviter d'interférer avec une éventuelle installation préexistante de Tomcat sur votre machine, ajoutez la ligne suivante au début du script "<code>&lt;TC_INSTALL_DIR&gt;/tcserver-ctl.sh</code>"&nbsp;:</p> <pre> export CATALINA_HOME=&lt;TC_INSTALL_DIR&gt;/tomcat-6.0.19.A </pre> <p>Attention à bien remplacer "<code>&lt;TC_INSTALL_DIR&gt;</code>" par sa véritable valeur, et à adapter la version de Tomcat si nécessaire.</p> <h4>Création des instances</h4> <p>Nous allons maintenant créer deux instances de TCServer, qui formeront la base de notre mini cluster.<br />
Ouvrez une console dans le répertoire "<code>&lt;TC_INSTALL_DIR&gt;</code>", puis invoquez le script "<code>tcserver-instance.sh</code>" avec les paramètres suivants&nbsp;:</p> <ul> <li><code>-v</code>&nbsp;: obligatoire, spécifie la version de TCServer. Adaptez-le en fonction de votre propre version.</li> <li><code>-s</code>&nbsp;: obligatoire, spécifie le nom de l'instance. Il est recommandé d'appliquer un pattern simple et cohérent.</li> </ul> <p>Exemple&nbsp;:</p> <pre class="bash code bash" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">tcserver-instance.sh <span style="color: #660033;">-v</span> 6.0.19.A <span style="color: #660033;">-s</span> instance1</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">tcserver-instance.sh <span style="color: #660033;">-v</span> 6.0.19.A <span style="color: #660033;">-s</span> instance2</div></li></ol></pre> <p>Deux sous-répertoires "<code>instance1</code>" et "<code>instance2</code>" sont créés, contenant les éléments spécifiques aux instances (configuration, logs...). Le code binaire, commun, reste centralisé au niveau du répertoire "<code>&lt;TC_INSTALL_DIR&gt;/tomcat-6.0.19.A/bin</code>".</p> <h4>Configuration des instances</h4> <p>Il faut maintenant configurer les ports respectifs des instances (HTTP, JMX, etc.).<br />
Sous Tomcat, cela nécessitait d'éditer le fichier "<code>server.xml</code>", ce qui pouvait se révéler fastidieux. TCServer étant prévu pour gérer de multiples instances quasi-identiques, leurs paramètres spécifiques sont astucieusement externalisés dans leurs fichiers "<code>conf/catalina.properties</code>".</p> <p>Editez le fichier "<code>conf/catalina.properties</code>" de chaque instance pour régler ses ports.<br />
Là encore, l'application d'un pattern d'attribution est recommandé, afin de faciliter la gestion des serveurs. Par exemple&nbsp;:</p> <pre>              Inst. 1   Inst. 2  ...  Inst. N http.port    18081     18082         1808N jmx.port     18071     18072         1807N ajp.port     18061     18062         1806N </pre> <h3>Déploiement et test de l'application</h3> <h4>Déploiement</h4> <p>Il est temps de déployer l'application de démonstration.</p> <p>Tout d'abord, copiez le fichier "<code>WebCounter.war</code>" (disponible en pièce jointe de ce billet) dans le répertoire "<code>webapps</code>" des deux instances, puis démarrez-les grâce au script "<code>&lt;TC_INSTALL_DIR&gt;/tcserver-ctl.sh</code>"&nbsp;:</p> <pre class="bash code bash" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">tcserver-ctl.sh instance1 start</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">tcserver-ctl.sh instance2 start</div></li></ol></pre> <p>Vérifiez dans les logs que tout se passe bien.</p> <h4>Premier test de l'application</h4> <p>Testons maintenant notre installation.<br /></p> <p>Lancez votre navigateur web favori et accédez aux deux versions de l'application.<br />
Si vous avez utilisé les réglages proposés ici, leurs adresses devraient être&nbsp;:</p> <ul> <li><a href="http://localhost:18081/WebCounter/CounterServlet">http://localhost:18081/WebCounter/CounterServlet</a></li> <li><a href="http://localhost:18082/WebCounter/CounterServlet">http://localhost:18082/WebCounter/CounterServlet</a></li> </ul> <p>Rafraîchissez plusieurs fois la fenêtre de la première application&nbsp;: le compteur augmente, prouvant que la session HTTP utilisateur est active sur ce serveur.<br />
Passez ensuite à la seconde application, et rafraîchissez-la également plusieurs fois. Le compteur repart de zéro puis est incrémenté, ce qui prouve que les sessions des deux versions de l'application sont indépendantes.</p> <p>Nous allons maintenant activer la réplication automatique de session avec Terracotta, sans modifier l'application ni la configuration des instances.</p> <h3>Clusterisation avec Terracotta</h3> <h4>Installation de Terracotta</h4> <p>Sur <a href="http://www.terracotta.org/web/display/orgsite/DownloadCatalog">le site de Terracotta</a>, téléchargez l'archive et décompressez-la dans un répertoire (par exemple "<code>/opt/Java/Tools/Terracotta</code>") que nous nommerons "<code>&lt;TERRACOTTA_INSTALL_DIR&gt;</code>".</p> <p>Terracotta dispose de nombreux plugins facilitant la configuration des produits les plus courants, dont Tomcat. Leur gestion est confiée au script "<code>&lt;TERRACOTTA_INSTALL_DIR&gt;/bin/tim-get.sh</code>".<br />
Tout d'abord, vérifiez la version courante du TIM Tomcat&nbsp;:</p> <pre class="bash code bash" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">tim-get.sh list</div></li></ol></pre> <p>Puis installez-le grâce à la commande&nbsp;:</p> <pre class="bash code bash" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">tim-get.sh <span style="color: #c20cb9; font-weight: bold;">install</span> tim-tomcat-<span style="color: #000000;">6.0</span> 1.1.0</div></li></ol></pre> <h4>Configuration des serveurs</h4> <p>Terracotta s'appuie sur un "Agent JVM" pour gérer la clusterisation des applications. Fonctionnant comme un plugin pour la JVM, il agit en instrumentant à la volée le code des classes, ce qui en fait une technologie totalement non-intrusive du point de vue applicatif.<br />
L'agent Terracotta est activé en passant les options adéquates lors du démarrage des JVMs, grâce à la variable d'environnement "<code>JAVA_OPTS</code>".</p> <p>Comme son ancêtre Tomcat, TCServer utilise le script "<code>bin/setenv.sh</code>" pour positionner diverses variables d'environnement avant de se lancer. Nous allons éditer ce script afin d'inclure les variables propres à Terracotta.<br />
Editez le fichier "<code>bin/setenv.sh</code>" de chaque instance, et ajoutez-y les lignes suivantes&nbsp;:</p> <pre> export TC_INSTALL_DIR=&lt;TERRACOTTA_INSTALL_DIR&gt; export TC_CONFIG_PATH=$TC_INSTALL_DIR/tc-config.xml . $TC_INSTALL_DIR/bin/dso-env.sh -q export JAVA_OPTS=&quot;$JAVA_OPTS $TC_JAVA_OPTS&quot; </pre> <p>Ne relancez pas les serveurs tout de suite&nbsp;: il nous faut d'abord configurer et lancer le serveur Terracotta.</p> <h4>Configuration de Terracotta</h4> <p>Terracotta lui-même est paramétré via le fichier de configuration dont l'emplacement est indiqué par la variable d'environnement TC_CONFIG_PATH paramétrée plus haut. Ce fichier est généralement nommé "<code>tc-config.xml</code>" et placé à la racine du répertoire d'installation de Terracotta.<br />
Il permet notamment de spécifier&nbsp;:</p> <ul> <li>Le port sur lequel le serveur Terracotta tournera</li> <li>Le répertoire contenant les données clusterisées</li> <li>Le répertoire les logs</li> <li>Les plugins spécifiques à activer (TIM ou Terracotta Integration Module)</li> <li>Les données à clusteriser, et en particulier les applications web dont les sessions devront être répliquées</li> </ul> <p>Voici le fichier de configuration activant la mise en cluster des sessions de notre application&nbsp;:</p> <pre class="xml code xml" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;tc:tc-config</span> <span style="color: #000066;">xmlns:tc</span>=<span style="color: #ff0000;">&quot;http://www.terracotta.org/config&quot;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;">  <span style="color: #000066;">xmlns:xsi</span>=<span style="color: #ff0000;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;">  <span style="color: #000066;">xsi:schemaLocation</span>=<span style="color: #ff0000;">&quot;http://www.terracotta.org/schema/terracotta-4.xsd&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;servers<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;server</span> <span style="color: #000066;">host</span>=<span style="color: #ff0000;">&quot;localhost&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dso-port<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>9510<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dso-port<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/server<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/servers<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;clients<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;modules<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;module</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;tim-tomcat-6.0&quot;</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;1.1.0&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/modules<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/clients<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;application<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dso<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;web-applications<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;web-application<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>WebCounter<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/web-application<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/web-applications<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dso<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style=
"font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/application<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/tc:tc-config<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li></ol></pre> <p>Notez l'activation du module Tomcat téléchargé précédemment, et la déclaration de l'application web de démonstration.</p> <h4>Lancement du serveur Terracotta</h4> <p>Pour finir, lancez le serveur Terracotta à l'aide du script "<code>&lt;TERRACOTTA_INSTALL_DIR&gt;/bin/start-tc-server.sh</code>".</p> <h4>Test de l'application clusterisée</h4> <p>Il est temps de tester à nouveau le comportement de notre application.</p> <p>Relancez les deux instances de TCServer, et exécutez les même tests que précédemment.<br />
Si tout s'est bien déroulé, le compteur est maintenant incrémenté de manière continue quel que soit le serveur utilisé, prouvant que les sessions HTTP sont bien répliquées entre les serveurs.</p> <h3>Conclusion</h3> <p>Si l'on excepte la phase d'installation des produits, nous constatons qu'il est très simple de mettre en place un mini-cluster web sur une machine de développement, et d'y déployer une application web aux sessions clusterisées.</p> <p>Zenika est partenaire de SpringSource et de Terracotta, et fournit des services autour de ces technologies.</p>