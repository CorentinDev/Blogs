---
ID: 128
post_title: Introducing Spring MVC test framework
author: Arnaud Cogolu√®gnes
post_date: 2013-01-16 09:25:00
post_excerpt: '<p>Spring MVC comes with a very useful test framework, which allows doing in-depth testing without even starting a web container. If you struggle maintaining any application based on Spring MVC, this post will show you the basics of the Spring MVC test framework.</p>'
layout: post
permalink: http://blog.zenika-offres.com/?p=128
published: true
---
<p>Spring MVC comes with a very useful test framework, which allows doing in-depth testing without even starting a web container. If you struggle maintaining any application based on Spring MVC, this post will show you the basics of the Spring MVC test framework.</p>
<!--more-->
<h2>What am I testing?</h2> <p>We can distinguish 3 levels of testing for Spring MVC controllers:</p> <ul> <li>unit tests: we test only the logic of the controller. Dependencies are mocked/stubbed, there's no Spring, nor web container. Spring MVC POJO programming model allows writing such tests easily. These tests are only useful when there's some complex logic inside controllers.</li> <li>out-of-container integration test: we test the controller logic as well as the surrounding plumbing. This plumbing is typically validation or data binding/serialization enforced by the framework. Dependencies are usually mocked/stubbed, but we need a diminished version of the infrastructure (a mock Spring MVC, but no web container).</li> <li>end-to-end testing: we test the whole stack of our application, from the controller to the database, through the service and data access layers. One can write such tests by starting an embedded Jetty in a JUnit test, and using <a href="http://htmlunit.sourceforge.net/">HtmlUnit</a> or <a href="http://code.google.com/p/rest-assured/">REST-assured</a> for the testing itself.</li> </ul> <p>This post focuses on the second level of testing, by using the Spring MVC test framework, available as of Spring 3.2. Here are some scenarios where this test framework comes in handy:</p> <ul> <li>testing inbound/outbound serialization (e.g. JSON to Java for incoming requests and Java to JSON for responses)</li> <li>testing validation rules (forms and JSR 303, enforced by Spring MVC)</li> <li>testing content negotiation (e.g. sending the <code>Accept</code> header with a given value and checking we get the appropriate content-type)</li> <li>testing response codes (e.g. 201 for a successful creation)</li> <li>testing the availability of headers in the response (e.g. the <code>Location</code> after a creation)</li> </ul> <p>The Spring MVC test framework makes all of this a breeze, let's see how to use it to test a simple web controller.</p> <h2>The controller to test</h2> <p>The controller we're about to test is the usual "Hello World" example for Spring MVC:</p> <pre class="java code java" style="font-family:inherit">@Controller <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SimpleController <span style="color: #009900;">&#123;</span> &nbsp;     @RequestMapping<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/hello&quot;</span><span style="color: #009900;">&#41;</span>     @ResponseBody     <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">String</span> helloWorld<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>         <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #0000ff;">&quot;Hello World!&quot;</span><span style="color: #339933;">;</span>     <span style="color: #009900;">&#125;</span> &nbsp; <span style="color: #009900;">&#125;</span></pre> <p>Here is a quick reminder about the used annotations:</p> <ul> <li><code>@Controller</code>: to mark the class as a controller. Without this annotation, Spring MVC wouldn't pick up the corresponding bean.</li> <li><code>@RequestMapping</code>: to map the method on a given URL (and HTTP method if necessary).</li> <li><code>@ResponseBody</code>: to send the returned object directly into the response. We don't want any view rendering here.</li> </ul> <p>Let's move on to the writing of the test.</p> <h2>The testing framework</h2> <p>Here are the steps to write the test.</p> <h4>Setting up the test class</h4> <p>Setting up a Spring MVC test class is pretty much the same as for any test based on the <a href="http://static.springsource.org/spring-framework/docs/current/spring-framework-reference/html/testing.html">Spring TestContext Framework</a>, except for one new annotation - <code>@WebAppConfiguration</code> - to create a web version of the Spring application context:</p> <pre class="java code java" style="font-family:inherit">@RunWith<span style="color: #009900;">&#40;</span>SpringJUnit4ClassRunner.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#41;</span> @ContextConfiguration @WebAppConfiguration <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SimpleControllerTest <span style="color: #009900;">&#123;</span> &nbsp;     ... &nbsp;     @Configuration     <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">class</span> TestConfiguration <span style="color: #009900;">&#123;</span> &nbsp;         @Bean <span style="color: #000000; font-weight: bold;">public</span> SimpleController simpleController<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>             <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">new</span> SimpleController<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>         <span style="color: #009900;">&#125;</span> &nbsp;     <span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#125;</span></pre> <p>Note we're configuring the Spring application context directly in the test, by declaring a static <code>@Configuration</code> inner class. The test framework will pick it up automatically.</p> <h4>Bootstrapping the Spring MVC test environment</h4> <p>The <code>MockMvc</code> will mock all the Spring MVC infrastructure. We just need the Spring application context to create it. We do this in the <code>@Before</code> method of our test:</p> <pre class="java code java" style="font-family:inherit">@RunWith<span style="color: #009900;">&#40;</span>SpringJUnit4ClassRunner.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#41;</span> @ContextConfiguration @WebAppConfiguration <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SimpleControllerTest <span style="color: #009900;">&#123;</span> &nbsp;     @Autowired <span style="color: #000000; font-weight: bold;">private</span> WebApplicationContext ctx<span style="color: #339933;">;</span> &nbsp;     <span style="color: #000000; font-weight: bold;">private</span> MockMvc mockMvc<span style="color: #339933;">;</span> &nbsp;     @Before <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>         <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">mockMvc</span> <span style="color: #339933;">=</span> MockMvcBuilders.<span style="color: #006633;">webAppContextSetup</span><span style="color: #009900;">&#40;</span>ctx<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">build</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>     <span style="color: #009900;">&#125;</span> &nbsp;     ... <span style="color: #009900;">&#125;</span></pre> <h4>Testing the controller</h4> <p>Our test has 2 steps:</p> <ul> <li>creating the mock HTTP request (URL, headers, parameters, etc)</li> <li>checking the HTTP response (content type, content, etc)</li> </ul> <p>The test framework a comprehensive API for request creation and response expectation. Let's use first an explicit version of this API:</p> <pre class="java code java" style="font-family:inherit">@Test <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> helloWorld<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span sty
le="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span>     mockMvc.<span style="color: #006633;">perform</span><span style="color: #009900;">&#40;</span>             MockMvcRequestBuilders.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/hello&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">accept</span><span style="color: #009900;">&#40;</span>MediaType.<span style="color: #006633;">TEXT_PLAIN</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>             .<span style="color: #006633;">andExpect</span><span style="color: #009900;">&#40;</span>MockMvcResultMatchers.<span style="color: #006633;">status</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">isOk</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>             .<span style="color: #006633;">andExpect</span><span style="color: #009900;">&#40;</span>MockMvcResultMatchers.<span style="color: #006633;">content</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">contentType</span><span style="color: #009900;">&#40;</span>MediaType.<span style="color: #006633;">TEXT_PLAIN</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>             .<span style="color: #006633;">andExpect</span><span style="color: #009900;">&#40;</span>MockMvcResultMatchers.<span style="color: #006633;">content</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">string</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Hello World!&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span></pre> <p>The code is quite simple to understand, but it remains verbose. We can simplify it by adding the following static imports:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">static</span> org.<span style="color: #006633;">springframework</span>.<span style="color: #006633;">test</span>.<span style="color: #006633;">web</span>.<span style="color: #006633;">servlet</span>.<span style="color: #006633;">request</span>.<span style="color: #006633;">MockMvcRequestBuilders</span>.<span style="color: #339933;">*;</span> <span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">static</span> org.<span style="color: #006633;">springframework</span>.<span style="color: #006633;">test</span>.<span style="color: #006633;">web</span>.<span style="color: #006633;">servlet</span>.<span style="color: #006633;">result</span>.<span style="color: #006633;">MockMvcResultMatchers</span>.<span style="color: #339933;">*;</span> <span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">static</span> org.<span style="color: #006633;">springframework</span>.<span style="color: #006633;">test</span>.<span style="color: #006633;">web</span>.<span style="color: #006633;">servlet</span>.<span style="color: #006633;">setup</span>.<span style="color: #006633;">MockMvcBuilders</span>.<span style="color: #339933;">*;</span></pre> <p>If you have an hard time remembering these classes, note they're all starting with <code>MockMvc</code>*.</p> <p>The full version of the test benefits from the static imports:</p> <pre class="java code java" style="font-family:inherit">@RunWith<span style="color: #009900;">&#40;</span>SpringJUnit4ClassRunner.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#41;</span> @ContextConfiguration @WebAppConfiguration <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SimpleControllerTest <span style="color: #009900;">&#123;</span> &nbsp;     @Autowired <span style="color: #000000; font-weight: bold;">private</span> WebApplicationContext ctx<span style="color: #339933;">;</span> &nbsp;     <span style="color: #000000; font-weight: bold;">private</span> MockMvc mockMvc<span style="color: #339933;">;</span> &nbsp;     @Before <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>         <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">mockMvc</span> <span style="color: #339933;">=</span> webAppContextSetup<span style="color: #009900;">&#40;</span>ctx<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">build</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>     <span style="color: #009900;">&#125;</span> &nbsp;     @Test <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> helloWorld<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span>         mockMvc.<span style="color: #006633;">perform</span><span style="color: #009900;">&#40;</span>get<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/hello&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">accept</span><span style="color: #009900;">&#40;</span>MediaType.<span style="color: #006633;">TEXT_PLAIN</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>                 .<span style="color: #006633;">andExpect</span><span style="color: #009900;">&#40;</span>status<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">isOk</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>                 .<span style="color: #006633;">andExpect</span><span style="color: #009900;">&#40;</span>content<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">contentType</span><span style="color: #009900;">&#40;</span>MediaType.<span style="color: #006633;">TEXT_PLAIN</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>                 .<span style="color: #006633;">andExpect</span><span style="color: #009900;">&#40;</span>content<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">string</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Hello World!&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>     <span style="color: #009900;">&#125;</span> &nbsp; &nbsp;     @Configuration     <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">class</span> TestConfiguration <span style="color: #009900;">&#123;</span> &nbsp;         @Bean <span style="color: #000000; font-weight: bold;">public</span> SimpleController simpleController<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>             <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">new</span> SimpleController<span st
yle="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>         <span style="color: #009900;">&#125;</span> &nbsp;     <span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#125;</span></pre> <p>The test method is now shorter and easier to read, thanks to the fluent API.</p> <p>All of this is quite abstract, and I'm sure any developer needs to see the actual request and response. This can be easily done by adding a static import and using the <code>print</code> <code>ResultHandler</code>:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">static</span> org.<span style="color: #006633;">springframework</span>.<span style="color: #006633;">test</span>.<span style="color: #006633;">web</span>.<span style="color: #006633;">servlet</span>.<span style="color: #006633;">result</span>.<span style="color: #006633;">MockMvcResultHandlers</span>.<span style="color: #339933;">*;</span> &nbsp; <span style="color: #009900;">&#40;</span>...<span style="color: #009900;">&#41;</span> &nbsp; @Test <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> helloWorld<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span>     mockMvc.<span style="color: #006633;">perform</span><span style="color: #009900;">&#40;</span>get<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/hello&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">accept</span><span style="color: #009900;">&#40;</span>MediaType.<span style="color: #006633;">TEXT_PLAIN</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>             .<span style="color: #006633;">andDo</span><span style="color: #009900;">&#40;</span>print<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #666666; font-style: italic;">// print the request/response in the console</span>             .<span style="color: #006633;">andExpect</span><span style="color: #009900;">&#40;</span>status<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">isOk</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>             .<span style="color: #006633;">andExpect</span><span style="color: #009900;">&#40;</span>content<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">contentType</span><span style="color: #009900;">&#40;</span>MediaType.<span style="color: #006633;">TEXT_PLAIN</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>             .<span style="color: #006633;">andExpect</span><span style="color: #009900;">&#40;</span>content<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">string</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Hello World!&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span></pre> <p>By using <code>andDo(print())</code>, we end up with the following output on the console:</p> <pre> MockHttpServletRequest:          HTTP Method = GET          Request URI = /hello           Parameters = {}              Headers = {Accept=[text/plain]}              Handler:                 Type = com.zenika.SimpleController                Async:    Was async started = false         Async result = null   Resolved Exception:                 Type = null         ModelAndView:            View name = null                 View = null                Model = null             FlashMap: MockHttpServletResponse:               Status = 200        Error message = null              Headers = {Content-Type=[text/plain], Content-Length=[12]}         Content type = text/plain                 Body = Hello World!        Forwarded URL = null       Redirected URL = null              Cookies = [] </pre> <p>This should make debugging much simpler. Note <code>ResultHandler</code> is a very useful extension point for any action you need to perform on the response.</p> <h2>Conclusion</h2> <p>This introduction covered the basics of the Spring MVC test framework. We tested a simple GET method, but the framework can do much more: sending parameters and a given content in the request, checking more complex content like JSON in the response, etc. And all of this with an efficient and fluent API. The Spring MVC test framework is the perfect tool to test thoroughly and quickly your web controllers.</p> <p>Stay tuned, a subsequent post will show you how to test a typical JSON-based REST controller.</p> <p><a href="https://github.com/acogoluegnes/blog-spring-mvc-test-framework">Source code</a></p>