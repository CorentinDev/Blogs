---
ID: 111
post_title: Présentation de Spring Data Neo4j
author: arouaze
post_date: 2012-02-28 11:40:00
post_excerpt: '<p>Dans un précédant article je vous ai présenté la base de données Neo4j ainsi que son API standard. Vous avez pu remarquer qu’il n’est pas facile d’implémenter un dao sur cette base dans vos projets. Exemple&nbsp;: les nœuds et les relations ne sont pas typés. Mais la communauté Spring a sorti il y a plus d’an un autre module pour son framework Spring Data. Il va nous permettre, dans le même principe que JPA, de mapper nos entités avec la base de données Neo4j.</p>'
layout: post
permalink: http://blog.zenika-offres.com/?p=111
published: true
---
<p>Dans un précédant article je vous ai présenté la base de données Neo4j ainsi que son API standard. Vous avez pu remarquer qu’il n’est pas facile d’implémenter un dao sur cette base dans vos projets. Exemple&nbsp;: les nœuds et les relations ne sont pas typés. Mais la communauté Spring a sorti il y a plus d’an un autre module pour son framework Spring Data. Il va nous permettre, dans le même principe que JPA, de mapper nos entités avec la base de données Neo4j.</p>
<!--more-->
<h3>Présentation</h3> <p>Le mapping des entités ce fait grâce à des annotations spécifique à Neo4j. Si on reprend l’exemple de mon précédant article nous pouvons modéliser nos utilisateur avec un simple POJO annoté&nbsp;:</p> <pre class="java code java" style="font-family:inherit">@NodeEntity <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> User <span style="color: #000000;">&#123;</span>    @GraphId    <span style="color: #000000;">Long</span> id;    <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #000000;">String</span> name;    Set<span style="color: #000000;">&lt;</span>User<span style="color: #000000;">&gt;</span> friends = <span style="color: #7F0055; font-weight: bold;">new</span> HashSet<span style="color: #000000;">&lt;</span>User<span style="color: #000000;">&gt;</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; &nbsp;    <span style="color: #808080; font-style: italic;">// Getter - Setter</span> <span style="color: #000000;">&#125;</span></pre> <p>Ici l’annotation NodeEntity indique au framework que cette classe est une entité Neo4j. Chaque nœud doit avoir un id unique. Il est donc obligatoire, comme pour JPA d’annoter un attribut qui représentera cet id avec l’annotation @GraphId.</p> <p>Grâce au template Neo4j fourni, nous allons tester l’insertion de nœud dans la base de données. Mais avant cela il faut configurer Spring pour lui indiquer ou sera stockés les fichiers de la base de données. Voici le fichier xml de configuration&nbsp;:</p> <pre class="xml code xml" style="font-family:inherit"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;1.0&quot;</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">&quot;UTF-8&quot;</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;beans</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans&quot;</span></span> <span style="color: #009900;">      <span style="color: #000066;">xmlns:xsi</span>=<span style="color: #ff0000;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span> <span style="color: #009900;">      <span style="color: #000066;">xmlns:neo4j</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/data/neo4j&quot;</span></span> <span style="color: #009900;">      <span style="color: #000066;">xsi:schemaLocation</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans</span> <span style="color: #009900;">       http://www.springframework.org/schema/beans/spring-beans.xsd</span> <span style="color: #009900;">       http://www.springframework.org/schema/data/neo4j</span> <span style="color: #009900;">       http://www.springframework.org/schema/data/neo4j/spring-neo4j-2.0.xsd&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span> &nbsp;    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;neo4j:config</span> <span style="color: #000066;">storeDirectory</span>=<span style="color: #ff0000;">&quot;target/neo4j-db&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/beans<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre> <p>Maintenant nous pouvons écrire notre premier test&nbsp;:</p> <pre class="java code java" style="font-family:inherit">@ContextConfiguration<span style="color: #000000;">&#40;</span>locations = <span style="color: #888888;">&quot;classpath*:spring/socialContext.xml&quot;</span><span style="color: #000000;">&#41;</span> @RunWith<span style="color: #000000;">&#40;</span>SpringJUnit4ClassRunner.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> TestEntity <span style="color: #000000;">&#123;</span> &nbsp;    @Autowired    <span style="color: #7F0055; font-weight: bold;">private</span> Neo4jTemplate template;    @Rollback<span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">false</span><span style="color: #000000;">&#41;</span>    @BeforeTransaction    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> clearDatabase<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>        Neo4jHelper.<span style="color: #000000;">cleanDb</span><span style="color: #000000;">&#40;</span>template<span style="color: #000000;">&#41;</span>;    <span style="color: #000000;">&#125;</span>    @Test    @Transactional    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> testPersistUser<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>        User martin = template.<span style="color: #000000;">save</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> User<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Martin&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;        User retrieveMartin = template.<span style="color: #000000;">findOne</span><span style="color: #000000;">&#40;</span>martin.<span style="color: #000000;">getId</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, User.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span>;        assertEquals<span style="color: #000000;">&#40;</span>martin, retrieveMartin<span style="color: #000000;">&#41;</span>;    <span style="color: #000000;">&#125;</span> <span style="color: #000000;">&#125;</span></pre> <p>Une autre classe bien pratique qui s’appelle Neo4jHelper nous propose de supprimer le contenu de notre base de données. Dans l’exemple elle sert à supprimer le contenu de la base avant chaque transaction. D’ailleurs ces transactions sont obligatoires pour persister dans la base de données.</p> <p>Pour récupérer facilement nos utilisateurs en fonction de leur nom par exemple, nous allons indexer l’attribut «&nbsp;name&nbsp;» avec l’annotation Index&nbsp;:</p> <pre class="java code java" style="font-family:inherit">@Indexed <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #000000;">String</span> name;</pre> <p>Et de même voici le test&nbsp;:</p> <pre class="java code java" style="font-family:inherit">@Test @Transactional <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> testIndex<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>     <span style="color: #000000;">String</span> name = <span style="color: #888888;">&quot;Martin&quot;</span>;     User martin = template.<span style="color: #000000;">save</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> User<span style="color: #000000;">&#40;</span>name<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;     GraphRepository<span style="color: #000000;">&lt;</span>User<span style="color: #000000;">&gt;</span> userRepository = template.<span style="color: #000000;">repositoryFor</span><span style="color: #000000;">&#40;</span>User.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #00
0000;">&#41;</span>;     User retrieveMartin = userRepository.<span style="color: #000000;">findByPropertyValue</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;name&quot;</span>, name<span style="color: #000000;">&#41;</span>;     assertEquals<span style="color: #000000;">&#40;</span>martin, retrieveMartin<span style="color: #000000;">&#41;</span>; <span style="color: #000000;">&#125;</span></pre> <p>Ici on récupère un repository fourni par Spring qui propose des méthodes de type DAO pour manipuler nos entités. Et grâce à la méthode findByPropertyValue qui prend en paramètre le nom de l’attribut annoté par un index et la valeur à rechercher, nous pouvons récupérer facilement nos objets.</p> <p>Maintenant nous allons mettre en place les relations entre nos utilisateurs. Elles sont représentées par une collection d’utilisateurs. Il existe deux manières de déclarer cette collection&nbsp;: si vous en voulez une en lecture seule alors il faut utiliser un objet de type Iterable ou sinon il faut la déclarer en tant qu’objet de type Set. Ensuite il suffit de l’annoter avec @RelatedTo qui prend en option le type de la relation, le  type de la classe ciblée, et la direction. Voici l’exemple&nbsp;:</p> <pre class="java code java" style="font-family:inherit">@RelatedTo<span style="color: #000000;">&#40;</span>type = <span style="color: #888888;">&quot;Friend&quot;</span>, direction = Direction.<span style="color: #000000;">OUTGOING</span><span style="color: #000000;">&#41;</span> Set<span style="color: #000000;">&lt;</span>User<span style="color: #000000;">&gt;</span> friends = <span style="color: #7F0055; font-weight: bold;">new</span> HashSet<span style="color: #000000;">&lt;</span>User<span style="color: #000000;">&gt;</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</pre> <p>Et son test associé&nbsp;:</p> <pre class="java code java" style="font-family:inherit">@Test @Transactional <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> testRelationship<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>     User martin = template.<span style="color: #000000;">save</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> User<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Martin&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;     User simon = template.<span style="color: #000000;">save</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> User<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Simon&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;     User pierre = template.<span style="color: #000000;">save</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> User<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Pierre&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;     martin.<span style="color: #000000;">addFriend</span><span style="color: #000000;">&#40;</span>simon<span style="color: #000000;">&#41;</span>;     martin.<span style="color: #000000;">addFriend</span><span style="color: #000000;">&#40;</span>pierre<span style="color: #000000;">&#41;</span>;     GraphRepository<span style="color: #000000;">&lt;</span>User<span style="color: #000000;">&gt;</span> userRepository = template.<span style="color: #000000;">repositoryFor</span><span style="color: #000000;">&#40;</span>User.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span>;     User retrieveMartin = userRepository.<span style="color: #000000;">findOne</span><span style="color: #000000;">&#40;</span>martin.<span style="color: #000000;">getId</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;     Set<span style="color: #000000;">&lt;</span>User<span style="color: #000000;">&gt;</span> martinFriends = template.<span style="color: #000000;">fetch</span><span style="color: #000000;">&#40;</span>retrieveMartin.<span style="color: #000000;">getFriends</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;     <span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span>User friends : martinFriends<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>         assertThat<span style="color: #000000;">&#40;</span>friends, Is.<span style="color: #000000;">is</span><span style="color: #000000;">&#40;</span>AnyOf.<span style="color: #000000;">anyOf</span><span style="color: #000000;">&#40;</span>equalTo<span style="color: #000000;">&#40;</span>simon<span style="color: #000000;">&#41;</span>, equalTo<span style="color: #000000;">&#40;</span>pierre<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;     <span style="color: #000000;">&#125;</span> <span style="color: #000000;">&#125;</span></pre> <p>Par default, comme pour JPA, la collection n’est pas chargée lors de la récupération puisque c’est du mode Lazy. C’est pour ça qu’il faut la charger avec le template.</p> <p>Le repository GraphRepository nous fournit pas mal de méthodes pour manipuler nos entités, mais nous allons l’étendre, ou plutôt le compléter en lui ajoutant d’autres méthodes. Par exemple on pourrait ajouter le service de mon précédant article, qui permettait à l’utilisateur de savoir quels amis ont au moins deux amis en commun avec lui.</p> <p>Pour rajouter ce service nous allons déclarer une interface qui contiendra sa signature avec une autre méthode qui nous facilitera l’ajout d’utilisateur&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">interface</span> MySocialRepository <span style="color: #000000;">&#123;</span>    @Transactional    User addUser<span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span> name<span style="color: #000000;">&#41;</span>;    Iterable<span style="color: #000000;">&lt;</span>User<span style="color: #000000;">&gt;</span> findCommonsFriend<span style="color: #000000;">&#40;</span>User user, <span style="color: #7F0055; font-weight: bold;">int</span> nbCommonsFriend<span style="color: #000000;">&#41;</span>; <span style="color: #000000;">&#125;</span></pre> <p>Ensuite nous allons créer une autre interface qui représentera nos services personnalisés avec les services de base du framework&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">interface</span> SocialRepository <span style="color: #7F0055; font-weight: bold;">extends</span> MySocialRepository, GraphRepository<span style="color: #000000;">&lt;</span>User<span style="color: #000000;">&gt;</span> <span style="color: #000000;">&#123;</span> <span style="color: #000000;">&#125;</span></pre> <p>Après implémentons nos services (Attention vous devez respecter le pattern nom_de_l’interface + impl au niveau du nom de votre classe sinon l’injection ne fonctionne pas):</p> <pre class="java code java" style="font-family:inherit"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> SocialRepositoryImpl <span style="color: #7F0055; font-weight: bold;">implements</span> MySocialRepository <span style="color: #000000;">&#123;</span> &nbsp;
  @Autowired    <span style="color: #7F0055; font-weight: bold;">private</span> SocialRepository repository; &nbsp;    @Override    @Transactional    <span style="color: #7F0055; font-weight: bold;">public</span> User addUser<span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span> name<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>        User user = findUserByName<span style="color: #000000;">&#40;</span>name<span style="color: #000000;">&#41;</span>;        <span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>user == <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>            user = <span style="color: #7F0055; font-weight: bold;">new</span> User<span style="color: #000000;">&#40;</span>name<span style="color: #000000;">&#41;</span>;            repository.<span style="color: #000000;">save</span><span style="color: #000000;">&#40;</span>user<span style="color: #000000;">&#41;</span>;        <span style="color: #000000;">&#125;</span>        <span style="color: #7F0055; font-weight: bold;">return</span> user;    <span style="color: #000000;">&#125;</span> &nbsp;    @Override    <span style="color: #7F0055; font-weight: bold;">public</span> Iterable<span style="color: #000000;">&lt;</span>User<span style="color: #000000;">&gt;</span> findCommonsFriend<span style="color: #000000;">&#40;</span>User user, <span style="color: #7F0055; font-weight: bold;">int</span> nbCommonsFriend<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>        TraversalDescription description  = Traversal.<span style="color: #000000;">description</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">evaluator</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> Evaluator<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>            @Override            <span style="color: #7F0055; font-weight: bold;">public</span> Evaluation evaluate<span style="color: #000000;">&#40;</span>Path path<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>                <span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>path.<span style="color: #000000;">length</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> == 0<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>                    <span style="color: #7F0055; font-weight: bold;">return</span> Evaluation.<span style="color: #000000;">EXCLUDE_AND_CONTINUE</span>;                <span style="color: #000000;">&#125;</span>                Node node = path.<span style="color: #000000;">endNode</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;                Iterable<span style="color: #000000;">&lt;</span>Relationship<span style="color: #000000;">&gt;</span> relationships = node.<span style="color: #000000;">getRelationships</span><span style="color: #000000;">&#40;</span>withName<span style="color: #000000;">&#40;</span>RelationshipTypes.<span style="color: #000000;">FRIEND</span><span style="color: #000000;">&#41;</span>, Direction.<span style="color: #000000;">OUTGOING</span><span style="color: #000000;">&#41;</span>;                <span style="color: #7F0055; font-weight: bold;">int</span> i = 0;                <span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span>Relationship relationship : relationships<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>                    i++;                <span style="color: #000000;">&#125;</span>                <span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>i <span style="color: #000000;">&gt;</span>= nbCommonsFriend<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>                    <span style="color: #7F0055; font-weight: bold;">return</span> Evaluation.<span style="color: #000000;">INCLUDE_AND_CONTINUE</span>;                <span style="color: #000000;">&#125;</span> <span style="color: #7F0055;font-weight: bold;">else</span> <span style="color: #000000;">&#123;</span>                    <span style="color: #7F0055; font-weight: bold;">return</span> Evaluation.<span style="color: #000000;">EXCLUDE_AND_CONTINUE</span>;                <span style="color: #000000;">&#125;</span>            <span style="color: #000000;">&#125;</span>        <span style="color: #000000;">&#125;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">relationships</span><span style="color: #000000;">&#40;</span>withName<span style="color: #000000;">&#40;</span>RelationshipTypes.<span style="color: #000000;">FRIEND</span><span style="color: #000000;">&#41;</span>, Direction.<span style="color: #000000;">OUTGOING</span><span style="color: #000000;">&#41;</span>;        <span style="color: #7F0055; font-weight: bold;">return</span> repository.<span style="color: #000000;">findAllByTraversal</span><span style="color: #000000;">&#40;</span>user, description<span style="color: #000000;">&#41;</span>;    <span style="color: #000000;">&#125;</span> <span style="color: #000000;">&#125;</span></pre> <p>La méthode findAllByTraversal prend en paramètre le nœud de départ et une description de la traversée. Dans cette description je créé un Evaluator qui indique si l’on inclut ou non le nœud traversé, et je renseigne le type et la direction des relations à traverser. Puis dans cet Evaluator je teste si le nœud qui en train d’être traversé possèdent un nombre de relations supérieures ou égales au nombre passé en paramètre de mon service. Pour finir il ne faut pas oublier d’exclure le premier nœud qui correspond au départ, plus précisément à l’utilisateur passé en paramètre de notre service.</p> <p>Et pour finir voici les tests de notre repository&nbsp;:</p> <pre class="java code java" style="font-family:inherit">@ContextConfiguration<span style="color: #000000;">&#40;</span>locations = <span style="color: #888888;">&quot;classpath:spring/socialContext.xml&quot;</span><span style="color: #000000;">&#41;</span> @RunWith<span style="color: #000000;">&#40;</span>SpringJUnit4ClassRunner.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span> @Transactional <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> TestRepository <span style="color: #000000;">&#123;</span> &nbsp;    @Autowired    <span style="color: #7F0055; font-weight: bold;">private</span> SocialRepository repository; &nbsp;    @Autowired    <span style="color: #7F0055; font-weight: bold;">private</span> Neo4jTemplate template; &nbsp;    @Rollback<span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">false</span><span style="color: #000000;">&#41;</span>    @BeforeTransaction    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> clearDatabase<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>        Neo4jHelper.<span style="color: #000000;">cleanDb</span><span style="color: #000000;">&#40;</span>template<span style="color: #000000;">&#41;</span>;    <span style="color: #000000;">&#125;</span> &nbsp;    @Test    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> testUserCreation<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>        User user = repository.<
span style="color: #000000;">save</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> User<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Humain&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;        User userRetrieved = repository.<span style="color: #000000;">findOne</span><span style="color: #000000;">&#40;</span>user.<span style="color: #000000;">getId</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;        assertEquals<span style="color: #000000;">&#40;</span>user.<span style="color: #000000;">getName</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, userRetrieved.<span style="color: #000000;">getName</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;    <span style="color: #000000;">&#125;</span>    @Test    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> findCommonsFriend<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>        repository.<span style="color: #000000;">makeSomeUser</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;        User rootUser = repository.<span style="color: #000000;">findUserByName</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Martin&quot;</span><span style="color: #000000;">&#41;</span>;        <span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span>User user : repository.<span style="color: #000000;">findCommonsFriend</span><span style="color: #000000;">&#40;</span>rootUser, <span style="color: #cc66cc;">2</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>            assertThat<span style="color: #000000;">&#40;</span>user.<span style="color: #000000;">getName</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, Is.<span style="color: #000000;">is</span><span style="color: #000000;">&#40;</span>AnyOf.<span style="color: #000000;">anyOf</span><span style="color: #000000;">&#40;</span>StringContains.<span style="color: #000000;">containsString</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Matthieu&quot;</span><span style="color: #000000;">&#41;</span>, StringContains.<span style="color: #000000;">containsString</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Romain&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;        <span style="color: #000000;">&#125;</span>    <span style="color: #000000;">&#125;</span> <span style="color: #000000;">&#125;</span></pre> <p>On peut remarquer que grâce à l’Autowired notre interface SocialRepository nous fournit nos services plus ceux qui sont par default. Le framework route automatiquement la bonne implémentation en fonction de la méthode appelée.</p> <h3>Conclusion</h3> <p>Le concept des bases de données graphe n’est pas facile à prendre en main, surtout pour quelqu’un qui a l’habitude de travailler avec une API comme JPA. Mais Spring Data Neo4j simplifie grandement cette approche grâce aux annotations et aux templates. D’ailleurs vous pouvez coupler l’API JPA avec Spring Data Neo4j pour stoker une partie de vos entités dans une base de données et l’autre dans Neo4j.</p> <p>Si vous voulez approfondir ce framework, je vous conseille de lire ce livre gratuit disponible à cette adresse&nbsp;: http://spring.neo4j.org/guide, et je vous assure qu’il y a encore plein de fonctionnalités à découvrir…</p> <h3>Code source</h3> <p>Voici le code source de l'exemple avec les dépendances Maven&nbsp;: <a href="/wp-content/uploads/2015/07/SpringDataNeo4jExample.zip">Example source code</a></p>