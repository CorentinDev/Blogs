---
ID: 476
post_title: >
  Intégration du support de la JSR 223
  dans JMeter
author: arazafimahefa
post_date: 2009-10-09 11:09:00
post_excerpt: |
  <p><a href="http://jakarta.apache.org/jmeter/" hreflang="en">JMeter</a> est un outil qui permet de faire du <strong>stress/load/performance testing</strong> sur différentes sortes d'applications dont des applications web, des applications de base de données, des web services, des annuaires LDAP, des applications de messagerie basées sur POP et IMAP. Il permet de simuler de la charge sur un serveur afin de tester la résistance et les performances de celui-ci selon différents types et quantités de charges.</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=476
published: true
---
<p><a href="http://jakarta.apache.org/jmeter/" hreflang="en">JMeter</a> est un outil qui permet de faire du <strong>stress/load/performance testing</strong> sur différentes sortes d'applications dont des applications web, des applications de base de données, des web services, des annuaires LDAP, des applications de messagerie basées sur POP et IMAP. Il permet de simuler de la charge sur un serveur afin de tester la résistance et les performances de celui-ci selon différents types et quantités de charges.</p>
<!--more-->
<h3>Les principaux avantages de JMeter</h3> <ul> <li>Possibilité de faire des tests de charge sur différents types d'applications&nbsp;: Web (HTTP, HTTPS), SOAP,  Base de données (via JDBC), LDAP, JMS, mail (POP3 et IMAP).</li> <li>JMeter est écrit en Java&nbsp;: ce qui permet d'assurer la portabilité de l'application sur n'importe quelle plateforme disposant d'une JVM.</li> <li>Création de scénario de test de charge facile à prendre en main.</li> <li>Extensibilité&nbsp;: possibilité de personnaliser les scénarios de tests en utilisant des langages de scripts pour modifier le comportement des samplers dans le plan de test. On peut utiliser soit&nbsp;: le BeanShell, des langages compatibles avec BSF (Bean Scripting Framework) ou encore des langages compatibles avec <a href="http://www.jcp.org/en/jsr/detail?id=223" hreflang="en">les spécifications JSR223</a> qui est une nouvelle fonctionnalité que nous avons essayé d'intégrer.</li> </ul> <h3>Les spécifications JSR223&nbsp;: Scripting dans Java</h3> <p>L'une des fonctionnalités les plus abouties de Java 6 consiste en la possibilité de pouvoir intégrer des langages de script avec la JVM. Désormais, il est possible d'importer des scripts écrits avec d'autres langages dans Java. Ceci inclut également la possibilité de passer des objets Java à des scripts et de pouvoir les manipuler. Les langages de scripts peuvent ainsi importer des classes Java, instancier des objets et les utiliser. <br />
Actuellement, les langages supportés sont&nbsp;: Groovy, JRuby, Jython, Beanshell, browserjs, EJS, Freemarker, Jack, Jaskell, Java, Javascript, Jawk, Jelly, JEP, Jexl, JST, JudoScript, JUEL, OGNL, Pnuts, Scheme, Sleep, Velocity, XPath and XSLT.<br /></p> <p>Les spécifications JSR 223 permettent d'embarquer des langages de script dans des applications Java, et d'accéder et manipuler des objets Java depuis l'environnement de script. <br /></p> <h3>Exemple d'utilisation des spécifications JSR223 avec Groovy</h3> <p>Dans cette partie, nous allons illustrer par un exemple, l'utilisation des spécifications JSR 223 avec le langage Groovy.</p> <h4>Pourquoi Groovy</h4> <p>Le choix de Groovy pour cette présentation n'est pas anodin. Groovy est un langage dynamique pour la plateforme Java avec des fonctionnalités inspirées d'autres langages tels que Ruby, Python ou Smalltalk, mises à disposition des développeurs en utilisant une syntaxe très proche de Java. De plus, c'est un langage facile à prendre en main surtout pour des développeurs Java.<br /></p> <p>JMeter étant purement écrit en Java, l'utilisation de Groovy s'imposait naturellement comme le choix le plus judicieux pour l'intégration et l'utilisation des fonctionnalités de scripting des extensions JSR223. En effet, nous disposons là d'un environnement purement Java qui permet de tirer pleinement partie de la puissance de la plateforme et de faciliter l'intégration et l'interaction des composants de l'application.</p> <h4>Scripting Groovy dans Java</h4> <p>Nous allons, tout d'abord, créer un mini-programme très simple en Groovy qui effectue une boucle de 1 à 10 et qui affiche à chaque tour, le numéro de la boucle.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">1.<span style="color: #000000;">upto</span><span style="color: #000000;">&#40;</span><span style="color: #cc66cc;">10</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span> i -<span style="color: #000000;">&gt;</span> </div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055;font-weight: bold;">if</span><span style="color: #000000;">&#40;</span>i == <span style="color: #cc66cc;">1</span><span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">         println <span style="color: #888888;">'1er tour de boucle'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055;font-weight: bold;">else</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">         println i + <span style="color: #888888;">'ème tour de boucle'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br /></p> <p>Ensuite, nous allons créer un programme java depuis lequel nous effectuerons l'exécution de ce mini-programme groovy en utilisant les fonctionnalités offertes par les spécifications JSR223.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">package</span> illustration;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import javax.script.ScriptEngine;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import javax.script.ScriptEngineManager;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import javax.script.ScriptException;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> Main <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">void</span> main<span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span><span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span> args<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		ScriptEngineManager scriptEngineManager = <span style="color: #7F0055; font-weight: bold;">new</span> ScriptEngineManager<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		ScriptEngine groovyScriptEngine = scriptEngineManager.<span style="color: #000000;">getEngineByName</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;groovy&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">String</span> groovyCode = <span style="color: #888888;">&quot;1.upto(10){ i -&gt; &quot;</span> +</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #888888;">&quot;		if(i == 1)&quot;</span> +</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #888888;">&quot;			println '1er tour de boucle'&quot;</span> +</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #888888;">&quot;		else &quot;</span> +</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font
-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #888888;">&quot;			println i + 'ème tour de boucle' &quot;</span> +</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #888888;">&quot;}&quot;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #7F0055; font-weight: bold;">try</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			groovyScriptEngine.<span style="color: #000000;">eval</span><span style="color: #000000;">&#40;</span>groovyCode<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">&#125;</span> <span style="color: #7F0055; font-weight: bold;">catch</span> <span style="color: #000000;">&#40;</span>ScriptException e<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			e.<span style="color: #000000;">printStackTrace</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br /></p> <h5>Explications</h5> <p>Pour l'exécution du script depuis l'environnement Java, la première étape consiste, à instancier un scriptEngineManager, qui implémente les fonctionnalités de recherche et d'instanciation de scriptEngine. <br />
Puis, nous créons un scriptEngine en nous basant sur le nom du langage de script (dans notre cas&nbsp;: groovy). Ces deux points sont illustrés par les deux instructions ci-dessous.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">ScriptEngineManager scriptEngineManager = <span style="color: #7F0055; font-weight: bold;">new</span> ScriptEngineManager<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">ScriptEngine groovyScriptEngine=scriptEngineManager.<span style="color: #000000;">getEngineByName</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;groovy&quot;</span><span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p><br /></p> <p>Enfin, la partie la plus importante, <strong>l'exécution du code groovy</strong> depuis java s'effectue en invocant la méthode <code>eval()</code> depuis le scriptEngine, en lui passant en paramètre le code à exécuter.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">// Code groovy à évaluer</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">String</span> groovyCode = <span style="color: #888888;">&quot;1.upto(10){ i -&gt; &quot;</span> +</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #888888;">&quot;	if(i == 1)&quot;</span> +</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #888888;">&quot;		println '1er tour de boucle'&quot;</span> +</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #888888;">&quot;	else &quot;</span> +</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #888888;">&quot;		println i + 'ème tour de boucle' &quot;</span> +</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #888888;">&quot;}&quot;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">// Evaluation du code groovy par le script Engine</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">groovyScriptEngine.<span style="color: #000000;">eval</span><span style="color: #000000;">&#40;</span>groovyCode<span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p><br /></p> <p>Dans notre cas, nous avons utilisé une variable String pour stocker notre mini-programme groovy. L'invocation de la méthode <code>eval()</code> va provoquer l'évaluation du code fourni en paramètre et donner la sortie suivante&nbsp;:</p> <pre> 1er tour de boucle 2ème tour de boucle 3ème tour de boucle 4ème tour de boucle 5ème tour de boucle 6ème tour de boucle 7ème tour de boucle 8ème tour de boucle 9ème tour de boucle 10ème tour de boucle </pre> <h3>Intégration JSR 223 dans JMeter</h3> <p>Le support du JSR 223 dans JMeter permet de disposer de <strong>fonctionnalités de scripting</strong> dans plusieurs langages, ouvrant ainsi des possibilités pour disposer d'un environnement de test à la fois évolutif et souple. Le concepteur du plan de test a ainsi un large choix quant au langage de script qu'il veut utiliser.<br /></p> <p>Les langages de scripts ont aussi des avantages certains par rapport à Java&nbsp;:</p> <ul> <li>Ils sont <strong>interprétés</strong> (pas de phase de compilation), ce qui implique un gain de temps conséquent au développement.</li> <li>Ils sont nettement <strong>plus faciles</strong> et <strong>plus rapides</strong> à écrire (typage faible, syntaxe simple) que du code Java (typage fort, phase de compilation etc.).</li> </ul> <p><br /></p> <p>Nous avons essayé d'intégrer le support du JSR 223 dans JMeter. Nous avons pour cela, ajouté dans les éléments de tests (TestElement) un préprocesseur JSR 223, un post processeur JSR 223 et un listener JSR 223. <br /></p> <h4>Sampler, Préprocesseur et PostProcesseur dans JMeter</h4> <p><em>Un sampler</em> est un élément de test JMeter. Il représente les requêtes qui seront effectivement exécutées par le logiciel lors du lancement du test. Un sampler renvoie un ou plusieurs résultats (Exemple&nbsp;: HTTP sampler pour simuler une requête http).<br /></p> <p><em>Un préprocesseur</em> est un élément de test qui permet de modifier les comportements ou les éléments d'un sampler avant leur exécution. Comme son nom le suggère, il est exécuté avant le sampler. En général, il est utilisé pour modifier la valeur des variables dans les samplers (paramétrage dynamique des tests).<br /></p> <p><em>Un post processeur</em> est un élément de test qui sera appliqué après l'exécution d'un sampler. La plupart du temps, il est utilisé pour le traitement des résultats reçus après que le sampler ait été exécuté. <br /></p> <p>Les paragraphes suivants décrivent la mise en place du support du JSR223 dans les éléments de Test de JMeter. Ils couvriront:</p> <ol> <li>La phase de préparation</li> <li>La phase d'implémentation des fonctionnalités des éléments de test&nbsp;: JSR223Preprocessor, JSR223PostProcessor et JSR223Listener.</li> <li>Et une illustration de l'utilisation des éléments de test avec Groovy</li> </ol> <h3>Phase de préparation</h3> <h4>Installation des paquetages nécessaires</h4> <ul> <li><strong>Le scripting</strong> est une fonctionnalité de Java 6. Il est donc nécessaire d'installer cette version de Java.</li> <li>Le support de JSR 223 implique d'avoir les différents <strong>script engines</strong> des langages de script. Ces script engines sont disponibles en ligne dans un paquetage à l'adresse&nbsp;: (https://scripting.dev.java.net/files/documents/4957/37592/jsr223-engines.tar.gz)</li> <li>Les script engines sont extraits et placés dans un sous-répertoire du projet, par exemple lib/jsr-223-engine.</li> </ul> <p>Un répertoire est disponible pour chaque langage de script pour lequel le support de jsr 223 est disponible. Chaque langage dispose des fichiers/répertoires suivants:</p> <ul> <li>bin/&nbsp;: contient les fichiers de commandes pour lancer les interpréteurs de script</li> <li>build/&nbsp;: contient le script engine jsr223-compliant</li> <li>lib/: ne contient rien pour le moment mais destiné à recevoir l'interpréteur de script</li> <li>LICENSE.TXT: la licence</li> <li>README.TXT&nbsp;: l'url qui permet de télécharger le jar de l'interpréteur de script à placer dans lib/</li> </ul> <p><br />
Par exemple pour Groovy&nbsp;:</p> <ul> <li>bin/ contient groovy.bat et groovy.sh</li> <li>build/&nbsp;: contient groovy-engine.jar</li> <li>lib/: contient groovy-all.jar</li> </ul> <h3>Phase d'implémentation</h3> <h4>Création de JSR223TestElement.java</h4> <p>Dans JMeter, <em>les éléments de tests</em> (sampler, préprocesseurs, postprocesseurs etc.) sont les composants qui permettent la conception des plans de tests. Tous les testElements héritent de  la classe générique <strong>AbstractTestElement.java</strong>.</p> <p>Le première étape est tout naturellement la création d'un TestElement <em>« JSR223-compliant »</em> qui sera la base de tous les éléments de test JSR223 et que nous appelerons <strong>JSR223TestElement.java</strong>. Cette classe étant un testElement, elle hérite de <strong>AbstractTestElement.java</strong>. Tous les éléments de test JSR223 hériteront ensuite de JSR223TestElement.java. <br />
<br /></p> <h5>JSR223TestElement.java</h5> <p>Les trois méthodes les plus importantes à considérer sont celles héritées de <strong>AbstractTestElement.java</strong>, à savoir&nbsp;:</p> <ul> <li><code>protected ScriptEngineManager getManager()</code></li> <li><code>protected void initManager(ScriptEngineManager sem)</code></li> <li><code>protected void processFileOrScript(ScriptEngineManager sem)</code></li> </ul> <p>La méthode <code>getManager()</code> permet de récupérer le <em>scriptEngineManager</em>. Le <em>scriptEngineManager</em> implémente les fonctionnalités de recherche et d'instanciation pour les <em>scriptEngine</em>. Il maintient également une collection de clé/valeur stockant les « états » partagées par les « engine » et créés par le manager.<br />
Cette classe utilise le mécanisme de « service providing » pour énumerer les différentes implémentations de <em>ScriptEngineFactory</em>. Elle fournit une méthode qui permet de retourner ces factory et des méthodes utilitaires permettant la recherche des factory sur la base du nom du langage de script ou du type MIME.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">protected</span> ScriptEngineManager getManager<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	ScriptEngineManager sem = <span style="color: #7F0055; font-weight: bold;">new</span> ScriptEngineManager<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	initManager<span style="color: #000000;">&#40;</span>sem<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #7F0055; font-weight: bold;">return</span> sem;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br /></p> <p>La méthode <code>initManager()</code> permet l'initialisation du manager. Elle permet de&nbsp;:</p> <ul> <li>récupérer le nom du langage de script à utiliser</li> <li>récupérer le nom du fichier de script à interpréter</li> <li>récupérer les paramètres à passer au script</li> <li>fixer les valeurs des objets qui seront passés au script via la méthode put() (ici les objets&nbsp;: args, ctx, vars, props, out, sampler...).</li> </ul> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">protected</span> <span style="color: #7F0055; font-weight: bold;">void</span> initManager<span style="color: #000000;">&#40;</span>ScriptEngineManager sem<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	  <span style="color: #7F0055; font-weight: bold;">final</span> <span style="color: #000000;">String</span> label = getName<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">final</span> <span style="color: #000000;">String</span> fileName = getFilename<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">final</span> <span style="color: #000000;">String</span> scriptParameters = getParameters<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #808080; font-style: italic;">// Use actual class name for log</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">final</span> Logger logger = LoggingManager.<span style="color: #000000;">getLoggerForShortName</span><span style="color: #000000;">&#40;</span>getClass<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">getName</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;log&quot;</span>, logger<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Label&quot;</span>, label<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;FileName&quot;</span>, fileName<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Parameters&quot;</span>, scriptParameters<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">String</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span> args=JOrphanUtils.<span style="color: #000000;">split</span><span style="color: #000000;">&#40;</span>scriptParameters, <span style="color: #888888;">&quot; &quot;</span><span style="color: #000000;">&#41;</span>;<span style="color: #808080; font-style: italic;">//$NON-NLS-1$</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;args&quot;</span>, args<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #808080; font-style: italic;">// Add variables for access to context and variables</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0;
 padding:0; background:inherit;">        JMeterContext jmctx = JMeterContextService.<span style="color: #000000;">getContext</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;ctx&quot;</span>, jmctx<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        JMeterVariables vars = jmctx.<span style="color: #000000;">getVariables</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;vars&quot;</span>, vars<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">Properties</span> props = JMeterUtils.<span style="color: #000000;">getJMeterProperties</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;props&quot;</span>, props<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #808080; font-style: italic;">// For use in debugging:</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;OUT&quot;</span>, <span style="color: #000000;">System</span>.<span style="color: #000000;">out</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #808080; font-style: italic;">// Most subclasses will need these:</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        Sampler sampler = jmctx.<span style="color: #000000;">getCurrentSampler</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;sampler&quot;</span>, sampler<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        SampleResult prev = jmctx.<span style="color: #000000;">getPreviousResult</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;prev&quot;</span>, prev<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br /></p> <p>La méthode <code>processFileOrScript()</code> exécute effectivement le script donné en paramètre via le fichier ou les instructions passées à JMeter par le biais de l'IHM.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">protected</span> <span style="color: #7F0055; font-weight: bold;">void</span> processFileOrScript<span style="color: #000000;">&#40;</span>ScriptEngineManager sem<span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> <span style="color: #000000;">IOException</span>, ScriptException<span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	ScriptEngine scriptEngine = sem.<span style="color: #000000;">getEngineByName</span><span style="color: #000000;">&#40;</span>getScriptLanguage<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #7F0055;font-weight: bold;">if</span><span style="color: #000000;">&#40;</span>scriptEngine == <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		log.<span style="color: #000000;">warn</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Not supported scripting engine&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		setScriptLanguage<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;groovy&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		scriptEngine = sem.<span style="color: #000000;">getEngineByName</span><span style="color: #000000;">&#40;</span>getScriptLanguage<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: n
ormal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span><span style="color: #7F0055;font-weight: bold;">else</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		<span style="color: #000000;">System</span>.<span style="color: #000000;">out</span>.<span style="color: #000000;">println</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Script engine found : &quot;</span> + getScriptLanguage<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">File</span> scriptFile = <span style="color: #7F0055; font-weight: bold;">new</span> <span style="color: #000000;">File</span><span style="color: #000000;">&#40;</span>getFilename<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #7F0055;font-weight: bold;">if</span><span style="color: #000000;">&#40;</span>scriptFile.<span style="color: #000000;">exists</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		<span style="color: #000000;">BufferedReader</span> fileReader = <span style="color: #7F0055; font-weight: bold;">new</span> <span style="color: #000000;">BufferedReader</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> <span style="color: #000000;">FileReader</span><span style="color: #000000;">&#40;</span>scriptFile<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		<span style="color: #000000;">String</span> line;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		<span style="color: #7F0055;font-weight: bold;">while</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span>line = fileReader.<span style="color: #000000;">readLine</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">!</span>= <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    			scriptEngine.<span style="color: #000000;">eval</span><span style="color: #000000;">&#40;</span>line<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span><span style="color: #7F0055;font-weight: bold;">else</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		scriptEngine.<span style="color: #000000;">eval</span><span style="color: #000000;">&#40;</span>getScript<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br /></p> <p>Il prend en paramètre le <em>ScriptEngineManager</em> qui permet d'instancier le <em>scriptEngine</em> via les données récupérées depuis l'IHM.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">ScriptEngine scriptEngine = sem.<span style="color: #000000;">getEngineByName</span><span style="color: #000000;">&#40;</span>getScriptLanguage<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p><br /></p> <p>Il effectue ensuite le traitement décrit par le fichier de script ou les instructions fournies dans l'IHM de JMeter en invoquant la méthode <code>eval()</code>:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">File</span> scriptFile = <span style="color: #7F0055; font-weight: bold;">new</span> <span style="color: #000000;">File</span><span style="color: #000000;">&#40;</span>getFilename<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #7F0055;font-weight: bold;">if</span><span style="color: #000000;">&#40;</span>scriptFile.<span style="color: #000000;">exists</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		<span style="color: #000000;">BufferedReader</span> fileReader = <span style="color: #7F0055; font-weight: bold;">new</span> <span style="color: #000000;">BufferedReader</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> <span style="color: #000000;">FileReader</span><span style="color: #000000;">&#40;</span>scriptFile<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; ma
rgin:0; padding:0; background:inherit;">    		<span style="color: #000000;">String</span> line;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		<span style="color: #7F0055;font-weight: bold;">while</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span>line = fileReader.<span style="color: #000000;">readLine</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">!</span>= <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    			scriptEngine.<span style="color: #000000;">eval</span><span style="color: #000000;">&#40;</span>line<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span><span style="color: #7F0055;font-weight: bold;">else</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		scriptEngine.<span style="color: #000000;">eval</span><span style="color: #000000;">&#40;</span>getScript<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br /></p> <h4>Création des préprocesseur, postprocesseur et listener JSR223</h4> <p>La deuxième étape consiste à créer les éléments de tests JSR223 dont un préprocesseur, un postprocesseur et un Listener. <br />
<br /></p> <h5>Préprocesseur JSR 223</h5> <p>Le <em>préprocesseur JSR223</em> est un élément de test exécuté par JMeter avant un sampler (un http request par exemple). Il permet de <strong>modifier le comportement</strong> du sampler en lui injectant par exemple des valeurs de paramètres différentes entre les runs.<br />
Etant un «modifier», il est placé dans le package <code>org.apache.jmeter.modifiers</code>.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">package</span> org.<span style="color: #000000;">apache</span>.<span style="color: #000000;">jmeter</span>.<span style="color: #000000;">modifiers</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import javax.script.ScriptEngineManager;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.processor.PreProcessor;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.testbeans.TestBean;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.util.JSR223TestElement;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jorphan.logging.LoggingManager;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.log.Logger;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> JSR223PreProcessor <span style="color: #7F0055; font-weight: bold;">extends</span> JSR223TestElement <span style="color: #7F0055; font-weight: bold;">implements</span> <span style="color: #000000;">Cloneable</span>, PreProcessor, TestBean</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">final</span> Logger log = LoggingManager.<span style="color: #000000;">getLoggerForClass</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">final</span> <span style="color: #7F0055; font-weight: bold;">long</span> serialVersionUID = 232L;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> process<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">try</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        	ScriptEngineManager sem = getManager<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        	<span style="color: #7F0055;font-weight: bold;">if</span><span style="color: #000000;">&#40;</span>sem == <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span> <span style="color: #7F0055; font-weight: bold;">return</span>; <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        	processFileOrScript<span style="color: #000000;">&#40;</span>sem<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">&#125;</span><span style="color: #7F0055; font-weight: bold;">catch</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">Exception</span> e<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        	log.<span style="color: #000000;">warn</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Problem in JSR223 script &quot;</span> + e<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>La classe <strong>JSR223PreProcessor.java</strong> étant une élément de test JSR223, elle hérite de <strong>JSR223TestElement.java</strong>.</p> <p>Tous les Préprocesseurs implémentent l'interface <strong>Preprocessor</
strong>. Cette interface définit la méthode <code>process()</code> que tout préprocesseur doit implémenter. Dans le cas de JSR223PreProcessor.java, l'implémentation de <code>process()</code> récupère un <em>scriptEngineManager</em> et fait appel à la méthode <code>processFileOrScript()</code> de la classe mère JSR223TestElement.java dont elle hérite et qui va effectivement exécuter le script passé en paramètre par l'IHM ou dans un fichier.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> process<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">try</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        	ScriptEngineManager sem = getManager<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        	<span style="color: #7F0055;font-weight: bold;">if</span><span style="color: #000000;">&#40;</span>sem == <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span> <span style="color: #7F0055; font-weight: bold;">return</span>; <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        	processFileOrScript<span style="color: #000000;">&#40;</span>sem<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">&#125;</span><span style="color: #7F0055; font-weight: bold;">catch</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">Exception</span> e<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        	log.<span style="color: #000000;">warn</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Problem in JSR223 script &quot;</span> + e<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br />
<br /></p> <h5>Postprocesseur JSR 223</h5> <p>Le <em>postprocesseur JSR223</em> est un élément de test exécuté par JMeter après un sampler (un http request par exemple). La plupart du temps, il est utilisé pour <strong>récupérer/extraire les éléments de résultats</strong> des samplers.<br />
Etant un «extractor », il est placé dans le package <code>org.apache.jmeter.extractor</code>;</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">package</span> org.<span style="color: #000000;">apache</span>.<span style="color: #000000;">jmeter</span>.<span style="color: #000000;">extractor</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import java.io.IOException;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import javax.script.ScriptEngineManager;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import javax.script.ScriptException;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.processor.PostProcessor;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.testbeans.TestBean;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.util.JSR223TestElement;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jorphan.logging.LoggingManager;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.log.Logger;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> JSR223PostProcessor <span style="color: #7F0055; font-weight: bold;">extends</span> JSR223TestElement <span style="color: #7F0055; font-weight: bold;">implements</span> <span style="color: #000000;">Cloneable</span>, PostProcessor, TestBean</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">final</span> Logger log = LoggingManager.<span style="color: #000000;">getLoggerForClass</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">final</span> <span style="color: #7F0055; font-weight: bold;">long</span> serialVersionUID = 232L;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> process<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	ScriptEngineManager sem = <span style="color: #7F0055; font-weight: bold;">null</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #7F0055; font-weight: bold;">try</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		sem = getManager<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span><span style="color: #7F0055; font-weight: bold;">catch</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">Exception</span> e<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		e.<span style="color: #000000;">printStackTrace</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #7F0055;font-weight: bold;">if</span><span style="color: #000000;">&#40;</span>sem == <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span> <span style="color: #7F0055; font-weight: bold;">return</span>; <span style="color: #000000;">&
#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #7F0055; font-weight: bold;">try</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		processFileOrScript<span style="color: #000000;">&#40;</span>sem<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span><span style="color: #7F0055; font-weight: bold;">catch</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">Exception</span> e<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		e.<span style="color: #000000;">printStackTrace</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>La classe <strong>JSR223PostProcessor.java</strong> étant une élément de test JSR223, elle hérite de <strong>JSR223TestElement.java</strong> exactement comme JSR223Preprocessor.java.</p> <p>Tous les Postprocesseurs implémentent l'interface <strong>PostProcessor</strong>. Cette interface définit également une méthode <code>process()</code> que tout Postprocesseur doit implémenter. Dans le cas de JSR223PostProcessor.java, l'implémentation de <code>process()</code> récupère un scriptEngineManager et fait appel à la méthode <code>processFileOrScript()</code> de la classe mère JSR223TestElement.java dont elle hérite et qui va effectivement exécuter le script passé en paramètre par l'IHM ou dans un fichier, de la même façon que dans JSR223Preprocessor.java.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> process<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	ScriptEngineManager sem = <span style="color: #7F0055; font-weight: bold;">null</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #7F0055; font-weight: bold;">try</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		sem = getManager<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span><span style="color: #7F0055; font-weight: bold;">catch</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">Exception</span> e<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		e.<span style="color: #000000;">printStackTrace</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #7F0055;font-weight: bold;">if</span><span style="color: #000000;">&#40;</span>sem == <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span> <span style="color: #7F0055; font-weight: bold;">return</span>; <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #7F0055; font-weight: bold;">try</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		processFileOrScript<span style="color: #000000;">&#40;</span>sem<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    	<span style="color: #000000;">&#125;</span><span style="color: #7F0055; font-weight: bold;">catch</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">Exception</span> e<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    		e.<span style="color: #000000;">printStackTrace</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br />
<br /></p> <h5>Listener JSR223</h5> <p>Un <em>listener JSR223</em> est un élément de test qui permet <strong>d'appliquer des traitements sur les résultats des samples</strong> via des langages de script « jsr223-compliant ».<br />
Il est placé dans le package <code>org.apache.jmeter.visualizers</code></p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">package</span> org.<span style="color: #000000;">apache</span>.<span style="color: #000000;">jmeter</span>.<span style="color: #000000;">visualizers</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import javax.script.ScriptEngineManager;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.bsf.BSFException;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.bsf.BSFManager;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.samplers.SampleEvent;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.samplers.SampleListener;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.samplers.SampleResult;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.testbeans.TestBean;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.util.BSFTestElement;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jmeter.util.JSR223TestElement;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.jorphan.logging.LoggingManager;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.log.Logger;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> JSR223Listener <span style="color: #7F0055; font-weight: bold;">extends</span> JSR223TestElement </div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">implements</span> <span style="color: #000000;">Cloneable</span>, SampleListener, TestBean, Visualizer <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">// N.B. Needs to implement Visualizer so that TestBeanGUI can find the correct GUI class</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">final</span> Logger log = LoggingManager.<span style="color: #000000;">getLoggerForClass</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">final</span> <span style="color: #7F0055; font-weight: bold;">long</span> serialVersionUID = 234L;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> sampleOccurred<span style="color: #000000;">&#40;</span>SampleEvent event<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">try</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            ScriptEngineManager sem = getManager<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>sem == <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                log.<span style="color: #000000;">error</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Problem creating JSR 223 manager&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit
;">                <span style="color: #7F0055; font-weight: bold;">return</span>; </div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;sampleEvent&quot;</span>, SampleEvent.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            SampleResult result = event.<span style="color: #000000;">getResult</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;sampleResult&quot;</span>, SampleResult.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            processFileOrScript<span style="color: #000000;">&#40;</span>sem<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">&#125;</span> <span style="color: #7F0055; font-weight: bold;">catch</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">Exception</span> e<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            log.<span style="color: #000000;">warn</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Problem in JSR 223 script &quot;</span> + e<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> sampleStarted<span style="color: #000000;">&#40;</span>SampleEvent e<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> sampleStopped<span style="color: #000000;">&#40;</span>SampleEvent e<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> add<span style="color: #000000;">&#40;</span>SampleResult sample<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">boolean</span> isStats<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">return</span> <span style="color: #7F0055; font-weight: bold;">false</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>Comme tout autre élément de test, <strong>JSR223Listener.java</strong> hérite de <strong>JSR223TestElement.java</strong>. Elle implémente également l'interface SampleListener qui définit les méthodes que tout Listener doit implémenter; entre autre la méthode <code>sampleOccured()</code> qu'un sampler a été exécuté et s'est terminé. <br />
L'implémentation de la méthode <code>sampleOccured()</code> par le JSR223Listener se charge de mettre à disposition de l'environnement du langage de script les éléments SampleEvent et SampleResults afin d'effectuer des traitements dessus. On retrouve ici la méthode <code>put()</code> qui permet de faire cela.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;sampleEvent&quot;</span>, SampleEvent.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">SampleResult result = event.<span style="color: #000000;">getResult</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">sem.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;sampleResult&quot;</span>, SampleResult.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p><br /></p> <p>Enfin, la méthode <code>processFileOrScript()</code> est invoqué pour charger le script et exécuter les traitements.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">processFileOrScript<span style="color: #000000;">&#40;</span>sem<span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p><br /></p> <h4>Création des éléments d'IHM pour les composants (préprocesseur, postprocesseur, listener) JSR223</h4> <p>JMeter supporte nativement <strong>Bean Scripting Framework (BSF)</strong>. C'est un framework qui permet de faire du scripting dans Java, de la même manière que les spécifications JSR223. Les paramètres qui doivent être fournis via l'IHM étant identiques, nous nous sommes basés sur les éléments d'interface BSF pour construire ceux des nouveaux composants JSR223.</p> <p>Les composants BSF utilisent une classe abstraite <strong>BSFBeanInfoSupport</strong> pour la gestion générique des éléments d'IHM qui leur sont communs. Les éléments d'interfaces étant les mêmes, nous avons crée les classes <strong>JSR223PreProcessorBeanInfo</strong> (package modifiers), <strong>JSR223PostProcessorBeanInfo</strong> (package extractor), et <strong>JSR223ListenerBeanInfo</strong> (package visualizers) par héritage depuis la classe <strong>BSFBeanInfoSupport</strong> pour gérer respectivement les éléments d'interface des composants JSR223&nbsp;: Preprocesseur, Postprocesseur et Listener.</p> <h3>Diagramme UML</h3> <p><a href="/wp-content/uploads/2015/07/uml.png"><img src="/wp-content/uploads/2015/07/.uml_m.jpg" alt="uml" title="uml" /></a></p> <h3>Illustration de l'utilisation du support du JSR223 dans JMeter</h3> <p>Dans l'illustration qui suit, nous mettrons en place un plan de test qui permet de gérer dynamiquement un scénario qui envoie différentes valeurs de paramètres de recherche, via le pré processeur, vers Google et en utilisant Groovy. Le post processeur se chargera ensuite de récupérer les résultats des samplers.</p> <p>Nous allons utiliser un simple HTTP sampler qui enverra une requête HTTP vers Google en modifiant à chaque run le « keyword ». Le <em>keyword</em> sera extrait depuis une liste décrite dans un fichier CSV et injecté par le script Groovy dans le sampler via le préprocesseur. Le postprocesseur se chargera ensuite d'extraire les résultats du sampler.</p> <h4>Explications</h4> <p>Une requête de recherche google est de la forme suivante&nbsp;: <br />
<em>http://www.google.fr/search?hl=fr&amp;q=XXX&amp;btnG=Recherche+Google&amp;meta=&amp;aq=f&amp;oq=</em><br />
où <strong>XXX</strong> est le mot-clé de la recherche. <br /></p> <p><img src="/wp-content/uploads/2015/07/.req_m.jpg" alt="request" style="display:block; margin:0 auto;" title="request" /></p> <p>Le httpSampler sera donc configuré de la manière suivante (cf écran ci-dessus)&nbsp;:</p> <ul> <li>Server name&nbsp;: www.google.com</li> <li>Path&nbsp;: /search</li> </ul> <p>Et les paramètres de recherche&nbsp;:</p> <ul> <li>hl avec la valeur fr</li> <li>q auquel on a donné la valeur ${keyword} qui est une notation permettant à JMeter de savoir que c'est une variable qui lui est fourni par le biais d'une ressource externe (script par exemple).</li> <li>BtnG avec la valeur « Recherche+Google »</li> <li>meta sans valeur</li> <li>aq avec la valeur f</li> <li>oq sans valeur</li> </ul> <p>Sous le sampler, dans la hiérarchie des éléments de tests, nous allons mettre un <em>httpRequestManager</em>. Cet élément de test permet à JMeter de spécifier certains éléments d'entêtes http dont par exemple le « user-agent » auquel nous donnerons la valeur « Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.7.6) Gecko/20050512 Firefox » sans quoi Google considérera que notre requête vient d'un robot. <br /></p> <p><img src="/wp-content/uploads/2015/07/.headers_m.jpg" alt="header" style="display:block; margin:0 auto;" title="header" /> <br /></p> <p>Nous allons définir dans un fichier CSV, que nous appellerons keyword.csv, les différents mots-clés (une par ligne) utilisés pour la recherche et nous spécifierons dans JMeter que ce fichier sera une ressource externe depuis laquelle il va extraire certaines données via l'utilisation de l'élément de test <em>CSV data source</em>&nbsp;:</p> <p><img src="/wp-content/uploads/2015/07/.datasource_m.jpg" alt="csvDatasource" style="display:block; margin:0 auto;" title="csvDatasource" /></p> <p>Les éléments à configurer au niveau de cet élément de test sont&nbsp;:</p> <ul> <li>le nom du fichier csv</li> <li>le nom des variables à utiliser au sein de JMeter pour référencer les données récupérées depuis le fichier csv (ici k).</li> <li>le délimiteur utilisé dans le fichier csv</li> </ul> <p>Ainsi, après chaque run, JMeter va extraire une donnée de la liste des mots-clés du fichier csv et la mettra dans la variable k.</p> <p>Nous allons maintenant mettre en place un Préprocesseur JSR223 dans le Plan de test afin de gérer dynamiquement le chargement des différents mots-clés dans la requête envoyée par JMeter. <br /></p> <p><img src="/wp-content/uploads/2015/07/.preproc_m.jpg" alt="preproc" style="display:block; margin:0 auto;" title="preproc" /></p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;===PRE PROCESSING===&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">vars.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">'HOST'</span>, <span style="color: #888888;">'www.google.com'</span><span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">vars.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">'KEYWORD'</span>, $<span style="color: #000000;">&#123;</span>k<span style="color: #000000;">&#125;</span><span style="color: #000000;">&#41;</span></div></li></ol></pre> <p>Ce script en Groovy permet de mettre la valeur de la variable k, récupérée depuis le fichier csv, et le mettre dans la variable KEYWORD qui sera référencée depuis JMeter par ${KEYWORD}. Cette dernière a été spécifiée ci-dessus comme étant l'un des « paramètres http» (le mot-clé pour google) à envoyer avec la requête JMeter. Ainsi, nous venons d'injecter une donnée depuis l'environnement de script vers JMeter.<br /></p> <p>Enfin, nous allons mettre en place un postprocesseur JSR223. Le postprocesseur se chargera de récupérer les résultats du sampler et de nous les afficher&nbsp;:</p> <p><img src="/wp-content/uploads/2015/07/.postproc_m.jpg" alt="postproc" style="display:block; margin:0 auto;" title="postproc" /></p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;=== POST PROCESSING ===&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;SAMPLING RESULTS&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;Sampler data encoding : &quot;</span> + prev.<span style="color: #000000;">getDataEncodingWithDefault</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;Sampler Data type : &quot;</span> + prev.<span style="color: #000000;">getDataType</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;Sampler error count : &quot;</span> + prev.<span style="color: #000000;">getErrorCount</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;Sampler media type : &quot;</span> + prev.<span style="color: #000000;">getMediaType</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;Sampler data : &quot;</span> + prev.<span style="color: #000000;">getSamplerData</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;Response Code : &quot;</span> + prev.<span style="color: #000000;">getResponseCode</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;Request headers : &quot;</span> + prev.<span style="color: #000000;">getRequestHeaders</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;Response data : &quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println prev.<span style="col
or: #000000;">getResponseDataAsString</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;Response message : &quot;</span> + prev.<span style="color: #000000;">getResponseMessage</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;Previous sample result : &quot;</span> + <span style="color: #000000;">&#40;</span>prev.<span style="color: #000000;">isSuccessful</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">?</span> <span style="color: #888888;">'the sampling of '</span> + prev.<span style="color: #000000;">getUrlAsString</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> + <span style="color: #888888;">' [SUCCEEDED]'</span>: <span style="color: #888888;">'the sampling of '</span> + prev.<span style="color: #000000;">getUrlAsString</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> + <span style="color: #888888;">' [FAILED]'</span> <span style="color: #000000;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">println <span style="color: #888888;">&quot;===END OF PRE PROCESSING===&quot;</span></div></li></ol></pre> <p>Ce petit script en groovy permet de récupérer les données de résultats du sampler. Par exemple&nbsp;: l'encodage utilisé, le type de données, le nombre d'erreur, le code de reponse, les entêtes de réponse.</p> <h3>Conclusion</h3> <p>L'intégration des fonctionnalités de scripting, telles que décrites par les spécifications JSR223, dans les applications Java ouvre de nombreuses perspectives pour les développeurs&nbsp;:</p> <ul> <li>simplicité d'intégration</li> <li>rapidité de codage</li> <li>choix du langage de script très étendu</li> <li>etc.</li> </ul> <p><br /></p> <p>L'exemple de l'intégration des éléments de test JMeter que nous venons de voir en est l'exemple parfait.<br />
L'extension JSR223 que nous avons greffé à JMeter permet notamment au concepteur de test de pouvoir&nbsp;:</p> <ul> <li>concevoir des scénarios de tests personnalisables et dynamiques. Ce qui permet d'affiner les possibilités en termes de paramétrages et de contrôle des résultats.</li> <li>interagir avec l'environnement du logiciel JMeter depuis son langage de script, et ceci d'une manière tout à fait transparente ou du moins très facile.</li> </ul> <p>L'utilisation de Groovy dans JMeter a particulièrement été soulignée. En effet, JMeter étant écrit entièrement en Java, Groovy, de par sa conception même est le langage de script idéal dans ce contexte puisqu'en plus de bénéficier de la puissance de la plateforme Java sur laquelle il est bâti, il permet aussi une plus grande maniabilité de par les fonctionnalités qu'il offre (syntaxe simple, langage dynamique, etc).</p>