---
ID: 122
post_title: HATEOAS with Spring MVC REST
author: Arnaud Cogolu√®gnes
post_date: 2012-06-13 09:45:00
post_excerpt: |
  <p>REST has been getting momentum for the last few years. Roy Fielding was the first to come up with the term "REST" in the <a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm">5th chapter</a> of <a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">his thesis</a>. When describing REST, we usually say this style of architecture builds on top of 5 principles: resources, uniform interface, representation, stateless architecture, hypermedia. Today we'll study the hypermedia principle and see how to implement HATEOAS - hypermedia as the engine of application state - with Spring MVC.</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=122
published: true
---
<p>REST has been getting momentum for the last few years. Roy Fielding was the first to come up with the term "REST" in the <a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm">5th chapter</a> of <a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">his thesis</a>. When describing REST, we usually say this style of architecture builds on top of 5 principles: resources, uniform interface, representation, stateless architecture, hypermedia. Today we'll study the hypermedia principle and see how to implement HATEOAS - hypermedia as the engine of application state - with Spring MVC.</p>
<!--more-->
<h2>HATE... what?</h2> <p>HATEOAS! As a developer you have perhaps no idea of what HATEOAS is. Even worse, your children or your grandmother are probably HATEOAS-ing everyday, assuming they surf on the internet. To make it simple, HATEOAS is just about clicking on links. Behind this simple definition, a very <a href="http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven">powerful paradigm</a> is hiding. The application (e.g. website) presents the next choices the user has thanks to links in the page (i.e. responses). When you want to cancel or confirm your order, you click on the corresponding link, when you want to see the next page of results, you click on the "next" link. You don't have to <em>guess</em> how to get to the next step. In this case, <em>guess</em> would mean directly typing the URL in the address panel of your browser.</p> <p>This explanation is enough to understand this article, but keep in mind HATEOAS is an essential part of the design of a REST application.</p> <h2>HATEOAS in my applications</h2> <p>Many people are using REST to expose web services to their applications. This is the case of <a href="http://developer.github.com/v3/">Github</a> and <a href="https://dev.twitter.com/docs/api">Twitter</a> among others. So the clients of a REST application will be other applications. How can a client know which URL, which HTTP method to call? There are usually 2 solutions: the client knows the REST interface by advance or the client is smart enough to follow links.</p> <p>For the first solution to work, the REST application provides a description of its interface. This is handy and quite common.</p> <p>For the second solution to work, the client must be quite smart. Some conventions or even standards to expose links also exist (ATOM and its link tag is an example).</p> <p>Real-world applications are usually based on a combination of both solutions.</p> <h2>An example, please</h2> <p>Imagine a list of resources (e.g. persons). The interface is a GET on <code>/persons</code> and the representation is JSON. The following representation doesn't comply to HATEOAS:</p> <pre> [    {       &quot;id&quot;:&quot;1&quot;,       &quot;firstname&quot;:&quot;Joe&quot;,       &quot;lastname&quot;:&quot;Dalton&quot;,    },    {       &quot;id&quot;:&quot;2&quot;,       &quot;firstname&quot;:&quot;William&quot;,       &quot;lastname&quot;:&quot;Dalton&quot;,    },    {       &quot;id&quot;:&quot;3&quot;,       &quot;firstname&quot;:&quot;Jack&quot;,       &quot;lastname&quot;:&quot;Dalton&quot;,    },    ... more resources ] </pre> <p>This is a list and each record is only a summary of the underlying resource. How to get to the details of a resource? Well, this is easy if we know about conventions: for the list, GET on <code>/persons</code>, so for the detail, GET on <code>/persons/{id}</code>.</p> <p>Something more HATEOAS-compliant would be:</p> <pre> [    {       &quot;id&quot;:{          &quot;rel&quot;:&quot;self&quot;,          &quot;href&quot;:&quot;http://localhost:8080/hateoas/zen-contact/contacts/1&quot;       },       &quot;firstname&quot;:&quot;Joe&quot;,       &quot;lastname&quot;:&quot;Dalton&quot;,       &quot;links&quot;:[          {             &quot;rel&quot;:&quot;self&quot;,             &quot;href&quot;:&quot;http://localhost:8080/hateoas/zen-contact/contacts/1&quot;          }       ]    },    {       &quot;id&quot;:{          &quot;rel&quot;:&quot;self&quot;,          &quot;href&quot;:&quot;http://localhost:8080/hateoas/zen-contact/contacts/2&quot;       },       &quot;firstname&quot;:&quot;William&quot;,       &quot;lastname&quot;:&quot;Dalton&quot;,       &quot;links&quot;:[          {             &quot;rel&quot;:&quot;self&quot;,             &quot;href&quot;:&quot;http://localhost:8080/hateoas/zen-contact/contacts/2&quot;          }       ]    },    {      &quot;id&quot;:{          &quot;rel&quot;:&quot;self&quot;,          &quot;href&quot;:&quot;http://localhost:8080/hateoas/zen-contact/contacts/3&quot;       },       &quot;firstname&quot;:&quot;Jack&quot;,       &quot;lastname&quot;:&quot;Dalton&quot;,       &quot;links&quot;:[          {             &quot;rel&quot;:&quot;self&quot;,             &quot;href&quot;:&quot;http://localhost:8080/hateoas/zen-contact/contacts/3&quot;          }       ]     }    ... more resources ] </pre> <p>Note in this second representation that each resource summary exposes the ID as a URI (better and more RESTfull than a simple integer, even if a the row ID is implemented as a database sequence) and some links. There's only one link in the links list and it leads to the resource detail (it's the same URI as the ID).</p> <h2>HATEOAS with Spring MVC and Spring HATEOAS</h2> <p><a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/mvc.html">Spring MVC</a> is a popular Java web framework and provides REST support since <a href="http://www.springsource.org">Spring 3.0</a> (December 2009). It doesn't provide support for HATEOAS per se, but makes it quite easy to implement. Let's start from a simple controller and see how to add HATEOAS.</p> <h4>The first version of the web controller</h4> <p>Here is a web controller that returns entities straight from the database:</p> <pre class="java code java" style="font-family:inherit">@Controller @RequestMapping<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;/contacts&quot;</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> ContactController <span style="color: #000000;">&#123;</span> &nbsp;   @Autowired ContactRepository contactRepository; &nbsp;   @RequestMapping<span style="color: #000000;">&#40;</span>method=RequestMethod.<span style="color: #000000;">GET</span><span style="color: #000000;">&#41;</span>   @ResponseBody   <span style="color: #7F0055; font-weight: bold;">public</span> List<span style="color: #000000;">&lt;</span>Contact<span style="color: #000000;">&gt;</span> contacts<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>     List<span style="color: #000000;">&lt;</span>Contact<span style="color: #000000;">&gt;</span> contacts = contactRepository.<span style="color: #000000;">findAll</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;     <span style="color: #7F0055; font-weight: bold;">return</span> contacts;   <span style="color: #000000;">&#125;</span> &nbsp;   @RequestMapping<span style="color: #000000;">&#40;</span>value=<span style="color: #888888;">&quot;/{id}&quot;</span>,method=RequestMethod.<span style="color: #000000;">GET</span><span style="color: #000000;">&#41;</span>   <span style="color: #7F0055; font-weight: bold;">public</span> Contact contact<span style="color: #000000;">&#40;</span>@PathVariable <span style="color: #000000;">Long</span> id<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>     Contact contact = contactRepository.<span style="color: #000000;">findOne</span><span style="color: #000000;">&#40;</span>id<span style="color: #000000;">&#41;</span>;     <span style="color: #7F0055; font-weight: bold;">return</span> contact;   <span style="color: #000000;">&#125;</span> <span style="color: #000000;">&#125;</span></pre> <p>The controller has one method to return the list of contacts and one method for the detail of a contact. Our implementation works and is quite straightforward, but as the <code>contacts</code> method returns directly instances of <code>Contact</code>, there's no link in the generated representation.</p> <p>To make this more HATEOAS-compliant, we will use a wrapper for <code>Contact</code> instances to limit the fields exposed and also add links. We will only change the <code>contacts</code> method (for the list), the <code>contact</code> method will remain the same.</p> <h4>Wrapping the contacts</h4> <p>We don't want to expose all the fields of our contacts in the list. This would make the representation way to large and waste some band
width. We will wrap <code>Contact</code> into instances of the following class:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #808080; font-style: italic;">// inside the controller class...</span> <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">class</span> ShortContact <span style="color: #7F0055; font-weight: bold;">extends</span> ResourceSupport <span style="color: #000000;">&#123;</span> &nbsp;   <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #000000;">String</span> firstname,lastname; &nbsp;   <span style="color: #000000;">&#40;</span>...<span style="color: #000000;">&#41;</span> &nbsp; <span style="color: #000000;">&#125;</span></pre> <p>Note the <code>ShortContact</code> extends the <code>ResourceSupport</code> class from Spring HATEOAS. <a href="https://github.com/SpringSource/spring-hateoas">Spring HATEOAS</a> is a brand new project of the <a href="http://www.springsource.org/projects">Spring portfolio</a> and aims at providing support for HATEOAS in Spring MVC. It's still in a early stage of development, but I decided to use it in this article. What does the <code>ResourceSupport</code> bring us? It allows to add links to the object and declares also a <code>id</code> property, which is itself a link. Nothing much, but less work for us. But what is a link?</p> <h4>Spring HATEOAS and links</h4> <p>Spring HATEOAS declares a <code>Link</code> class. A link is an URL (<code>href</code> property) and a qualifier for the link (<code>rel</code>) property. The <code>Link</code> class follows the semantics of the <code>link</code> tag from ATOM.</p> <p>So once I have a <code>ShortContact</code> instance, I can easily add links to it:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #a1a100;">import static org.springframework.hateoas.mvc.ControllerLinkBuilder.*;</span> ... <span style="color: #000000;">ShortContact</span> resource = <span style="color: #7F0055; font-weight: bold;">new</span> ShortContact<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; Link detail = linkTo<span style="color: #000000;">&#40;</span>ContactController.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">slash</span><span style="color: #000000;">&#40;</span>contact.<span style="color: #000000;">getId</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">withSelfRel</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; resource.<span style="color: #000000;">add</span><span style="color: #000000;">&#40;</span>detail<span style="color: #000000;">&#41;</span>;</pre> <p>One can create a <code>Link</code> instance by calling the default constructor, but Spring HATEOAS provides some support to automatically create and map the link to a given controller (<code>linkTo</code> static method that grabs the <code>RequestMapping</code> annotation on the controller). Note also the method to add a slash to the URL followed by a value (<code>slash</code> method) and another method to qualify the link (<code>withSelfRel</code> method). We end up with an URL that matches the following URI template: <code>/contacts/{id}</code>.</p> <h4>The entire controller</h4> <p>Here is the code of the controller:</p> <pre class="java code java" style="font-family:inherit">@Controller @RequestMapping<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;/contacts&quot;</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> ContactController <span style="color: #000000;">&#123;</span> &nbsp;   @Autowired ContactRepository contactRepository; &nbsp;   @RequestMapping<span style="color: #000000;">&#40;</span>method=RequestMethod.<span style="color: #000000;">GET</span><span style="color: #000000;">&#41;</span>   @ResponseBody   <span style="color: #7F0055; font-weight: bold;">public</span> List<span style="color: #000000;">&lt;</span>ShortContact<span style="color: #000000;">&gt;</span> contacts<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>     List<span style="color: #000000;">&lt;</span>Contact<span style="color: #000000;">&gt;</span> contacts = contactRepository.<span style="color: #000000;">findAll</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;     List<span style="color: #000000;">&lt;</span>ShortContact<span style="color: #000000;">&gt;</span> resources = <span style="color: #7F0055; font-weight: bold;">new</span> ArrayList<span style="color: #000000;">&lt;</span>ShortContact<span style="color: #000000;">&gt;</span><span style="color: #000000;">&#40;</span>contacts.<span style="color: #000000;">size</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;     <span style="color: #7F0055;font-weight: bold;">for</span><span style="color: #000000;">&#40;</span>Contact contact : contacts<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>       ShortContact resource = <span style="color: #7F0055; font-weight: bold;">new</span> ShortContact<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;       resource.<span style="color: #000000;">setFirstname</span><span style="color: #000000;">&#40;</span>contact.<span style="color: #000000;">getFirstname</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;       resource.<span style="color: #000000;">setLastname</span><span style="color: #000000;">&#40;</span>contact.<span style="color: #000000;">getLastname</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;       Link detail = linkTo<span style="color: #000000;">&#40;</span>ContactController.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">slash</span><span style="color: #000000;">&#40;</span>contact.<span style="color: #000000;">getId</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">withSelfRel</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;       resource.<span style="color: #000000;">add</span><span style="color: #000000;">&#40;</span>detail<span style="color: #000000;">&#41;</span>;       resources.<span style="color: #000000;">add</span><span style="color: #000000;">&#40;</span>resource<span style="color: #000000;">&#41;</span>;     <span style="color: #000000;">&#125;</span>     <span style="color: #7F0055; font-weight: bold;">return</span> resources;   <span style="color: #000000;">&#125;</span> &nbsp;   @RequestMapping<span style="color: #000000;">&#40;</span>value=<span style="color: #888888;">&quot;/{id}&quot;</span>,method=RequestMethod.<span style="color: #000000;">GET</span><span style="color: #000000;">&#41;</span>   <span style="color: #7F0055; font-weight: bold;">public</span> Contact contact<span style="color: #000000;">&#40;</span>@PathVariable <span style="color: #000000;">Long</span> id<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>     Contact contact = contactRepository.<span style="color: #000000;">findOne</span><span style="color: #000000;">&#40;</span>id<span style="color: #000000;">&#41;</span>;     <span style="color: #7F0055; font-weight: bold;">return</span> contact;   <span style="color: #000000;">&#125;</span> &nbsp; <span style="color: #000000;
">&#125;</span></pre> <p>Each record in the list will be sent to the client like this:</p> <pre> {      &quot;id&quot;:{          &quot;rel&quot;:&quot;self&quot;,          &quot;href&quot;:&quot;http://localhost:8080/hateoas/zen-contact/contacts/3&quot;       },       &quot;firstname&quot;:&quot;Jack&quot;,       &quot;lastname&quot;:&quot;Dalton&quot;,       &quot;links&quot;:[          {             &quot;rel&quot;:&quot;self&quot;,             &quot;href&quot;:&quot;http://localhost:8080/hateoas/zen-contact/contacts/3&quot;          }       ]  } </pre> <p>The client will then be able to follow the link to get to the detail of the contact. The client won't have to <em>guess</em>.</p> <h2>Summary</h2> <p>HATEOAS is one of the building block of REST. We showed in this post how to implement HATEOAS with Spring MVC and some help from the brand new Spring HATEOAS project. I hope this would give some ideas to make your REST applications even more RESTfull, easier to use for your clients, and more interoperable. Another post will follow to apply HATEOAS to paging, with Spring MVC, <a href="http://www.springsource.org/spring-data/jpa">Spring Data JPA</a>, and <a href="https://github.com/SpringSource/spring-hateoas">Spring HATEOAS</a>.</p> <p><a href="https://github.com/acogoluegnes/hateoas">Source code</a></p>