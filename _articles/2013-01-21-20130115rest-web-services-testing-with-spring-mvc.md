---
ID: 129
post_title: >
  REST Web Services testing with Spring
  MVC
author: Arnaud Cogolu√®gnes
post_date: 2013-01-21 09:25:00
post_excerpt: |
  <p>A <a href="/index.php?post/2013/01/15/REST-Web-Services-testing-with-Spring-MVC">previous post</a> introduced the basic features of the Spring MVC test framework. This post covers the testing of a REST web controller: by checking the response status, the content type, and the returned JSON document , we'll verify if the controller behaves as expected.</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=129
published: true
---
<p>A <a href="/index.php?post/2013/01/15/REST-Web-Services-testing-with-Spring-MVC">previous post</a> introduced the basic features of the Spring MVC test framework. This post covers the testing of a REST web controller: by checking the response status, the content type, and the returned JSON document , we'll verify if the controller behaves as expected.</p>
<!--more-->
<h2>The controller to test</h2> <p>The controller to test is rather simple, it just returns a Java object that ends up being serialized in the response. The point here is to test Spring MVC features like argument mapping and serialization.</p> <pre class="java code java" style="font-family:inherit">@Controller <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> ContactController <span style="color: #000000;">&#123;</span> &nbsp;     @RequestMapping<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;/contact/{id}&quot;</span><span style="color: #000000;">&#41;</span>     @ResponseBody     <span style="color: #7F0055; font-weight: bold;">public</span> Contact contact<span style="color: #000000;">&#40;</span>@PathVariable<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;id&quot;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">Integer</span> id<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>         <span style="color: #808080; font-style: italic;">// mimics a call to a business service</span>         <span style="color: #7F0055; font-weight: bold;">return</span> <span style="color: #7F0055; font-weight: bold;">new</span> Contact<span style="color: #000000;">&#40;</span>id,<span style="color: #888888;">&quot;Test Firstname&quot;</span>,<span style="color: #888888;">&quot;Test Lastname&quot;</span><span style="color: #000000;">&#41;</span>;     <span style="color: #000000;">&#125;</span> &nbsp; <span style="color: #000000;">&#125;</span></pre> <h2>The test of the controller</h2> <h4>Setting up the test</h4> <p>We need to set up the web version (<code>@WebAppConfiguration</code>) of the Spring TestContext Framework (<code>@RunWith(SpringJUnit4ClassRunner.class)</code> and <code>@ContextConfiguration</code>). We embed the configuration in the test, thanks to a <code>@Configuration</code> inner class. Here is the setup part of the test:</p> <pre class="java code java" style="font-family:inherit">@RunWith<span style="color: #000000;">&#40;</span>SpringJUnit4ClassRunner.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span> @ContextConfiguration @WebAppConfiguration <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> ContactControllerTest <span style="color: #000000;">&#123;</span> &nbsp;     @Autowired     <span style="color: #7F0055; font-weight: bold;">private</span> WebApplicationContext ctx; &nbsp;     <span style="color: #7F0055; font-weight: bold;">private</span> MockMvc mockMvc; &nbsp;     @Before     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> setUp<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>         <span style="color: #7F0055; font-weight: bold;">this</span>.<span style="color: #000000;">mockMvc</span> = MockMvcBuilders.<span style="color: #000000;">webAppContextSetup</span><span style="color: #000000;">&#40;</span>ctx<span style="color: #000000;">&#41;</span>.<span style="color: #000000;">build</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;     <span style="color: #000000;">&#125;</span> &nbsp;     <span style="color: #000000;">&#40;</span>...<span style="color: #000000;">&#41;</span> &nbsp;     @Configuration     @EnableWebMvc     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">class</span> TestConfiguration <span style="color: #000000;">&#123;</span> &nbsp;         @Bean         <span style="color: #7F0055; font-weight: bold;">public</span> ContactController contactController<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>             <span style="color: #7F0055; font-weight: bold;">return</span> <span style="color: #7F0055; font-weight: bold;">new</span> ContactController<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;         <span style="color: #000000;">&#125;</span> &nbsp;     <span style="color: #000000;">&#125;</span> &nbsp; <span style="color: #000000;">&#125;</span></pre> <p>Note we use <code>@EnableWebMvc</code> on the configuration class: this will activate (among others) the REST support. We need this to register the Jackson (JSON) converter in charge of serialization.</p> <p>The infrastructure is ready, let's send a (mock) request to our controller.</p> <h4>Sending a request, debugging the response</h4> <p>The whole point of the test is to ensure the controller responds correctly to one of our requests. Our controller is quite simple, so we could send a request and directly check the result with the appropriate expectation API. For more complex cases, like fancy custom JSON serialization, we would typically send the request and use some debugging features to display the response. This would make the writing of the expectations simpler (especially if the returned document is somewhat complex). Let's do that!</p> <p>Our first version of the test method sends the request and use <code>andDo(print())</code> to display the request and response information on the console:</p> <pre class="java code java" style="font-family:inherit">@Test <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> contact<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> <span style="color: #000000;">Exception</span> <span style="color: #000000;">&#123;</span>     <span style="color: #000000;">Integer</span> id = <span style="color: #cc66cc;">1</span>;     mockMvc.<span style="color: #000000;">perform</span><span style="color: #000000;">&#40;</span>get<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;/contact/{id}&quot;</span>,id<span style="color: #000000;">&#41;</span>.<span style="color: #000000;">accept</span><span style="color: #000000;">&#40;</span>MediaType.<span style="color: #000000;">APPLICATION_JSON</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>             .<span style="color: #000000;">andDo</span><span style="color: #000000;">&#40;</span>print<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>; <span style="color: #000000;">&#125;</span></pre> <p>The execution of the test should output the following on the console:</p> <pre> MockHttpServletRequest:          HTTP Method = GET          Request URI = /contact/1           Parameters = {}              Headers = {Accept=[application/json]}              Handler:                 Type = com.zenika.ContactController               Method = public com.zenika.Contact com.zenika.ContactController.contact(java.lang.Integer)                Async:    Was async started = false         Async result = null   Resolved Exception:                 Type = null         ModelAndView:            View name = null                 View = null                Model = null             FlashMap: MockHttpServletResponse:               Status = 200        Error message = null              Headers = {Content-Type=[application/json;charset=UTF-8]}         Content type = application/json;charset=UTF-8                 Body = {&quot;id&quot;:1,&quot;firstname&quot;:&quot;Test Firstname&quot;,&quot;lastname&quot;:&quot;Test Lastname&quot;}        Forwarded URL = null       Redirected URL = null              Cookies = [] </pre> <p>In real-world tests, you would typically check the response status, the headers, and the body:</p> <pre> Headers = {Content-Type=[application/json;charset=UTF-8]} Content type = application/json;charset=UTF-8 Body = {&quot;id&quot;:1,&quo
t;firstname&quot;:&quot;Test Firstname&quot;,&quot;lastname&quot;:&quot;Test Lastname&quot;} </pre> <p>Let's see how to do that.</p> <h4>Checking the response</h4> <p>We check the response by calling the <code>andExpect</code> method on the <code>ResultActions</code> object returned by the <code>perform</code> method. The <code>andExpect</code> needs a <code>ResultMatcher</code> object and we would typically use <code>ResultMatcher</code>s provided by the <code>MockMvcResultMatchers</code> class.</p> <p>To check the response code, we use the <code>status()</code> method. We expect 200 (OK):</p> <pre class="java code java" style="font-family:inherit">.<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>status<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">isOk</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span></pre> <p>To check the content type:</p> <pre class="java code java" style="font-family:inherit">.<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>content<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">contentType</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;application/json;charset=UTF-8&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span></pre> <p>Testing the JSON document can be a pain, especially if you don't have support for JSON parsing. The good news is Spring MVC test framework supports <a href="http://code.google.com/p/json-path/">JsonPath</a> out-of-the-box. Retrieving the value of the <code>id</code> attribute is like the following:</p> <pre class="java code java" style="font-family:inherit">.<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>jsonPath<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;id&quot;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">value</span><span style="color: #000000;">&#40;</span>id<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</pre> <p>Let's put it all together, here is the full test method:</p> <pre class="java code java" style="font-family:inherit">@Test <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> contact<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> <span style="color: #000000;">Exception</span> <span style="color: #000000;">&#123;</span>   <span style="color: #000000;">Integer</span> id = <span style="color: #cc66cc;">1</span>;   mockMvc.<span style="color: #000000;">perform</span><span style="color: #000000;">&#40;</span>get<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;/contact/{id}&quot;</span>,id<span style="color: #000000;">&#41;</span>.<span style="color: #000000;">accept</span><span style="color: #000000;">&#40;</span>MediaType.<span style="color: #000000;">APPLICATION_JSON</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>          .<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>status<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">isOk</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>          .<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>content<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">contentType</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;application/json;charset=UTF-8&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>          .<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>jsonPath<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;id&quot;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">value</span><span style="color: #000000;">&#40;</span>id<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>; <span style="color: #000000;">&#125;</span></pre> <p>Pretty simple, isn't it? Launch the test in your favorite IDE to see the green bar!</p> <p>And here's the full version of the test:</p> <pre class="java code java" style="font-family:inherit">@RunWith<span style="color: #000000;">&#40;</span>SpringJUnit4ClassRunner.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span> @ContextConfiguration @WebAppConfiguration <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> ContactControllerTest <span style="color: #000000;">&#123;</span> &nbsp;     @Autowired     <span style="color: #7F0055; font-weight: bold;">private</span> WebApplicationContext ctx; &nbsp;     <span style="color: #7F0055; font-weight: bold;">private</span> MockMvc mockMvc; &nbsp;     @Before     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> setUp<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>         <span style="color: #7F0055; font-weight: bold;">this</span>.<span style="color: #000000;">mockMvc</span> = MockMvcBuilders.<span style="color: #000000;">webAppContextSetup</span><span style="color: #000000;">&#40;</span>ctx<span style="color: #000000;">&#41;</span>.<span style="color: #000000;">build</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;     <span style="color: #000000;">&#125;</span> &nbsp;     @Test     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> contact<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> <span style="color: #000000;">Exception</span> <span style="color: #000000;">&#123;</span>         <span style="color: #000000;">Integer</span> id = <span style="color: #cc66cc;">1</span>;         mockMvc.<span style="color: #000000;">perform</span><span style="color: #000000;">&#40;</span>get<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;/contact/{id}&quot;</span>,id<span style="color: #000000;">&#41;</span>.<span style="color: #000000;">accept</span><span style="color: #000000;">&#40;</span>MediaType.<span style="color: #000000;">APPLICATION_JSON</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>                 .<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>status<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">isOk</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>                 .<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>content<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">contentType</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;application/json;charset=UTF-8&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>                 .<span style="color: #000000;">andExpect</span><span style="color: #000000;">&#40;</span>jsonPath<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;id&quot;
</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">value</span><span style="color: #000000;">&#40;</span>id<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;     <span style="color: #000000;">&#125;</span> &nbsp;     @Configuration     @EnableWebMvc     <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">class</span> TestConfiguration <span style="color: #000000;">&#123;</span> &nbsp;         @Bean         <span style="color: #7F0055; font-weight: bold;">public</span> ContactController contactController<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>             <span style="color: #7F0055; font-weight: bold;">return</span> <span style="color: #7F0055; font-weight: bold;">new</span> ContactController<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;         <span style="color: #000000;">&#125;</span> &nbsp;     <span style="color: #000000;">&#125;</span> &nbsp; <span style="color: #000000;">&#125;</span></pre> <h2>Conclusion</h2> <p>This post covered how to test a Spring MVC REST controller with the Spring MVC out-of-container test framework. We managed to check the controller in terms of input parameters, response status, response headers, and response content. By testing a read-only web service, we only scratched the surface of the framework: one can test the other HTTP operations (POST, PUT, DELETE), requests with some content in the body, more headers, etc. Now, get back to work and test your REST web service layer!</p> <p><a href="https://github.com/acogoluegnes/blog-spring-mvc-test-framework">Source code</a></p>