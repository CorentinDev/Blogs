---
ID: 401
post_title: Oracle Coherence et Rainbow table
author: obourgain
post_date: 2010-08-27 14:33:00
post_excerpt: "<p>Dans cet article nous verrons comment utiliser Oracle Coherence pour retrouver les mots de passe ayant servi à générer des hash.</p> <p>Deux approches naïves sont envisageables pour cracker un hash&nbsp;: la force brute et la base de données. La première consiste à essayer toutes les combinaisons possibles de mots de passe, mais le problème est le temps de calcul nécessaire, car les fonctions de hashage sont généralement très lentes. La seconde consiste à calculer en amont les hashs de toutes les mots de passe possible, et à les stocker dans une base de données&nbsp;; mais cette attaque nécessite un espace de stockage énorme.</p> <p>Les Rainbow tables sont conçues pour optimiser l'équilibre entre puissance de calcul et la consommation mémoire, à mi-chemin entre les deux approches précédentes.</p>"
layout: post
permalink: http://blog.zenika-offres.com/?p=401
published: true
slide_template:
  - ""
---
<p>Dans cet article nous verrons comment utiliser Oracle Coherence pour retrouver les mots de passe ayant servi à générer des hash.</p> <p>Deux approches naïves sont envisageables pour cracker un hash&nbsp;: la force brute et la base de données. La première consiste à essayer toutes les combinaisons possibles de mots de passe, mais le problème est le temps de calcul nécessaire, car les fonctions de hashage sont généralement très lentes. La seconde consiste à calculer en amont les hashs de toutes les mots de passe possible, et à les stocker dans une base de données&nbsp;; mais cette attaque nécessite un espace de stockage énorme.</p> <p>Les Rainbow tables sont conçues pour optimiser l'équilibre entre puissance de calcul et la consommation mémoire, à mi-chemin entre les deux approches précédentes.</p>
<!--more-->
<h3>Rainbow table</h3> <p>Une Rainbow table est une variante de la Map classique, dont les clés sont les hashs et les valeurs les mots de passe correspondants. La subtilité est que le hash n'est pas directement obtenu par digestion du mot de passe, mais après l'application successive de fonctions de digestion et de réduction. L'opération de réduction permet de générer, à partir d'un hash, une nouvelle chaîne de caractère appartenant à l'ensemble des mots de passe potentiels (sur laquelle on pourra à nouveau appliquer un hash, etc.). <br />
<a href="/wp-content/uploads/2015/07/generation_rainbow_table.png"><img src="/wp-content/uploads/2015/07/.generation_rainbow_table_m.jpg" alt="generation_rainbow_table.png" /></a> <br /></p> <p>A partir d'un mot de passe potentiel initial, si l'on applique N fois (1000, par exemple) les fonctions de hashage et de réduction, on obtient un hash final représentant de manière unique le trajet passant par N-1 mots de passe et hashs intermédiaires. Grâce à ce système, une Rainbow table de 1 Mo couvre l'équivalent d'1 Go de données.<br />
Malheureusement, il est possible d'obtenir des collisions, car la réduction de deux hashs différents peut mener à la même chaîne de caractères. Pour éviter ce phénomène, il est fortement recommandé d'utiliser une fonction de réduction différente par colonne virtuelle de la table. Les collisions sont ainsi beaucoup plus rares, puisqu'il faudrait que les deux hashs conflictuels appartiennent à la même colonne - ce qui a N fois moins de chances de se produire (1000 fois moins, toujours dans notre exemple).</p> <p>Pour cracker un hash (et donc retrouver le mot de passe l'ayant produit), la première étape consiste à déterminer la ligne de la table à laquelle il appartient. Pour cela, on commence par vérifier si le hash correspond directement à un hash final de la Rainbow table.</p> <ul> <li>Si oui, le mot de passe recherché est celui produit par l'opération de réduction à l'étape N-1 (999) de notre chemin virtuel sur cette ligne, et il n'y a plus qu'à le recalculer comme expliqué plus bas.</li> <li>Si non, peut-être le mot de passe recherché est-il dans la colonne N-2&nbsp;? Si c'est le cas, l'application des fonctions de hashage+réduction de l'étape N-1 devrait produire le hash final de la ligne, que nous connaissons. En appliquant ce raisonnement récursivement jusqu'à l'étape 1, on peut facilement vérifier tous les éléments virtuels de toutes les lignes de notre Rainbow table.</li> </ul> <p><br />
<img src="/wp-content/uploads/2015/07/trouver_la_ligne_rainbow_table.png" alt="trouver_la_ligne_rainbow_table.png" /> <br /></p> <p>Une fois déterminée la ligne contenant le mot de passe, il suffit de la parcourir à partir de son mot de passe initial. En appliquant à chaque élément de la liste la fonctions de hashage ou de réduction appropriée, on arrive au mot de passe intermédiaire produisant le hash que l'on cherche à cracker.<br />
Évidement, si le hash a été produit en appliquant un sel (salt), la rainbow table va donner le mot de passe salé et pas le mot de passe initial...</p> <p><br />
<a href="/wp-content/uploads/2015/07/crack_ligne_rainbow_table.png"><img src="/wp-content/uploads/2015/07/.crack_ligne_rainbow_table_m.jpg" alt="crack_ligne_rainbow_table.png" /></a> <br /></p> <p>Dans ce cas, notre chaîne ne va stocker que <strong>df45cvj11sag</strong> en clé et <strong>password</strong> en valeur, toutes les valeurs intermédiaires peuvent êtres retrouvées en effectuant à nouveau les étapes de hashage et de réduction à partir de la valeur initiale, celle stockée dans la table.</p> <h3>Coherence</h3> <p>Après avoir brièvement présenté le fonctionnement des Rainbow tables, intéressons-nous à Coherence, une solution de cache distribué que nous utiliserons pour stocker la table.</p> <p>Coherence s'utilise comme une Map normale, et pour créer un cluster il suffit d'importer le jar de Coherence (disponible <a href="http://www.oracle.com/technetwork/middleware/coherence/downloads/coherence-101246.html" hreflang="en">ici</a>) et d'obtenir une référence sur un cache. La création du cache s'il n'existe pas et sa mise en cluster se font automatiquement.</p> <p>On va donc effectuer un simple&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">NamedCache rainbow = CacheFactory.<span style="color: #000000;">getCache</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;rainbow&quot;</span><span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p>Et on obtient un NamedCache, implémente l'interface Map et se manipule donc comme tel.</p> <p>Pour générer la rainbow table, nous allons comme expliqué plus haut enchaîner des digestions puis des réductions sur la chaîne de départ. Le code ressemble donc à&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> create<span style="color: #000000;">&#40;</span>Tools tools<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> j = 0; settings.<span style="color: #000000;">getTableSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; j++<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">String</span> password = randomPassword<span style="color: #000000;">&#40;</span>settings.<span style="color: #000000;">getPasswordLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,settings.<span style="color: #000000;">getCharacterSet</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>; <span style="color: #808080; font-style: italic;">// create a random password</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">String</span> finalHash = finalHash<span style="color: #000000;">&#40;</span>tools, password<span style="color: #000000;">&#41;</span>; <span style="color: #808080; font-style: italic;">// Hash and reduce it a lot a time</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		rainbow.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span>finalHash, password<span style="color: #000000;">&#41;</span>; <span style="color: #808080; font-style: italic;">// Store the initial password and the final hash</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #000000;">String</span> finalHash<span style="color: #000000;">&#40;</span>Tools tools, <span style="color: #000000;">String</span> password<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055; font-weight: bold;">int</span> passwordLength = settings.<span style="color: #000000;">getPasswordLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">String</span> characterSet = settings.<span style="color: #000000;">getCharacterSet</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">String</span> hash = tools.<span style="color: #000000;">hash</span><span style="color: #000000;">&#40;</span>password<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> i = 0; i <span style="color: #000000;">&lt;</span> settings.<span style="color: #000000;">getChainLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> - <span style="color: #cc66cc;">1</span>; i++<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">String</span> intermediatePassword = tools.<span style="color: #000000;">reduce</span><span style="color: #000000;">&#40;</span>hash.<span style="color: #000000;">getBytes</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, i,characterSet, passwordLength<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		hash = tools.<span style="color: #000000;">hash</span><span style="color: #000000;">&#40;</span>intermediatePassword<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><
div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055; font-weight: bold;">return</span> hash;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br /></p> <p>Cette façon de faire n'est pas optimale du point de vue du réseau puisque l'opération "<code>put</code>" va déclencher deux appels réseau, un pour enregistrer la nouvelle entrée, et un autre pour renvoyer l'ancienne valeur (ou null si elle est créée). On va donc utiliser une Map locale pour servir de buffer&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> create<span style="color: #000000;">&#40;</span>Tools tools<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	Map<span style="color: #000000;">&lt;</span>String, String<span style="color: #000000;">&gt;</span> map = <span style="color: #7F0055; font-weight: bold;">new</span> HashMap<span style="color: #000000;">&lt;</span>String, String<span style="color: #000000;">&gt;</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> i = 0; i <span style="color: #000000;">&lt;</span> settings.<span style="color: #000000;">getTableSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> / <span style="color: #cc66cc;">1000</span>; i++<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> j = 0; j <span style="color: #000000;">&lt;</span> <span style="color: #cc66cc;">1000</span>; j++<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #808080; font-style: italic;">// create a random password</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #000000;">String</span> password = randomPassword<span style="color: #000000;">&#40;</span>settings.<span style="color: #000000;">getPasswordLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,settings.<span style="color: #000000;">getCharacterSet</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #808080; font-style: italic;">// Hash and reduce it a lot a time</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #000000;">String</span> finalHash = finalHash<span style="color: #000000;">&#40;</span>tools, password<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #808080; font-style: italic;">// Store the initial password and the final hash</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			map.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span>finalHash, password<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #808080; font-style: italic;">// store objects by 1000 to improve network performance</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		rainbow.<span style="color: #000000;">putAll</span><span style="color: #000000;">&#40;</span>map<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		map.<span style="color: #000000;">clear</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br />
Ainsi, les entrées sont stockées par 1000, ce qui réduit le nombre d'appels réseau, de plus il n'y a pas de retour à la fonction <code>putAll</code>, ce qui réduit 2000 appels réseau à un seul.</p> <p>Une fois notre table créée, on peut commencer à cracker les hash.</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #000000;">String</span> crack<span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span> hash<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055; font-weight: bold;">byte</span><span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span> hashToCrack = hash.<span style="color: #000000;">getBytes</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> i = settings.<span style="color: #000000;">getChainLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> - <span style="color: #cc66cc;">1</span>; i <span style="color: #000000;">&gt;</span>= 0; i--<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #7F0055; font-weight: bold;">byte</span><span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span> finalHash = finalHash<span style="color: #000000;">&#40;</span>hashToCrack, i<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">Object</span> key : rainbow.<span style="color: #000000;">keySet</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>key.<span style="color: #000000;">toString</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">equals</span><span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> <span style="color: #000000;">String</span><span style="color: #000000;">&#40;</span>finalHash<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #808080; font-style: italic;">// the hash matches a key in the table, the password may be in this row</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #000000;">String</span> password = findPasswordInRow<span style="color: #000000;">&#40;</span>key.<span style="color: #000000;">toString</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,<span style="color: #7F0055; font-weight: bold;">new</span> <span style="color: #000000;">String</span><span style="color: #000000;">&#40;</span>hashToCrack<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>password <span style="color: #000000;">!</span>= <span style="color: #7F0055; font-weight: bold;">null</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">					<span style="color: #808080; font-style: italic;">// we found the password</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">					<span style="color: #7F0055; font-weight: bold;">return</span> password;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #000000;">&#125;</span> <span style="color: #7F0055;font-weight: bold;">else</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">					<span style="color: #808080; font-style: italic;">// hash collision ?</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">				<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #808080; font-style: italic;">// Not found</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055; font-weight: bold;">return</span> <span style="color: #7F0055; font-weight: bold;">null</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #000000;">String</span> findPasswordInRow<span style="color: #000000;">&#40;</span><s
pan style="color: #000000;">String</span> key, <span style="color: #000000;">String</span> hashToCrack<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">String</span> password = <span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span><span style="color: #000000;">&#41;</span> CacheFactory.<span style="color: #000000;">getCache</span><span style="color: #000000;">&#40;</span>cacheName<span style="color: #000000;">&#41;</span>.<span style="color: #000000;">get</span><span style="color: #000000;">&#40;</span>key<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> j = 0; j <span style="color: #000000;">&lt;</span>= settings.<span style="color: #000000;">getChainLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; j++<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">String</span> hash = tools.<span style="color: #000000;">hash</span><span style="color: #000000;">&#40;</span>password<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>hash.<span style="color: #000000;">equals</span><span style="color: #000000;">&#40;</span>hashToCrack<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #000000;">System</span>.<span style="color: #000000;">out</span>.<span style="color: #000000;">println</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;got it&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #7F0055; font-weight: bold;">return</span> password;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		password = tools.<span style="color: #000000;">reduce</span><span style="color: #000000;">&#40;</span>hash.<span style="color: #000000;">getBytes</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, j, settings.<span style="color: #000000;">getCharacterSet</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,	settings.<span style="color: #000000;">getPasswordLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #808080; font-style: italic;">// hash not found</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055; font-weight: bold;">return</span> <span style="color: #7F0055; font-weight: bold;">null</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #7F0055; font-weight: bold;">byte</span><span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span> finalHash<span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">byte</span><span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span> hash, <span style="color: #7F0055; font-weight: bold;">int</span> index<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> i = index; i <span style="color: #000000;">&lt;</span> settings.<span style="color: #000000;">getChainLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> - <span style="color: #cc66cc;">1</span>; i++<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">String</span> password = tools.<span style="color: #000000;">reduce</span><span style="color: #000000;">&#40;</span>hash, i, settings.<span style="color: #000000;">getCharacterSet</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,settings.<span style="color: #000000;">getPasswordLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		hash = tools.<span style="color: #000000;">hash</span><span style="color: #000000;">&#40;</span>password<span style="color: #000000;">&#41;</span>.<span style="color: #000000;">getBytes</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055; font-weight: bold;">return</span> hash;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br /></p> <p>Pour vérifier que
 notre méthode "<code>crack</code>" fonctionne correctement, ajoutons manuellement l'entrée qui doit donner le bon résultat&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> createWithKnowPassword<span style="color: #000000;">&#40;</span>Tools tools, <span style="color: #000000;">String</span> password<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #808080; font-style: italic;">// Hash and reduce it a lot a time</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">String</span> finalHash = finalHash<span style="color: #000000;">&#40;</span>tools, password<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #808080; font-style: italic;">// Store the password and the final hash</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	rainbow.<span style="color: #000000;">put</span><span style="color: #000000;">&#40;</span>finalHash, password<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">System</span>.<span style="color: #000000;">out</span>.<span style="color: #000000;">println</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;hash final de &quot;</span> + password + <span style="color: #888888;">&quot; = &quot;</span> + finalHash<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p><br /></p> <p>En utilisant "<code>olivier</code>" comme mot de passe initial, on obtient le hash <code>bc481f4a213cb8442d6c38a17d58de43</code>. On peut donc vérifier que le vrai hash de "<code>olivier</code>" (<code>d3ca5dde60f88db606021eeba2499c02</code>) permet de retrouver "<code>olivier</code>".</p> <h3>Conclusion</h3> <p>Nous avons vu que la Rainbow table permet d'optimiser l'équilibre entre espace de stockage et puissance de calcul. Coherence permet ensuite de la manipuler de façon transparente, et même de la partager entre plusieurs applications. La facilité avec laquelle il est possible de cracker des mots de passe grâce aux Rainbow tables souligne l'importance d'utiliser un algorithme de cryptage sûr et d'utiliser un <em>salt</em> sur les mots de passe.</p> <p>Dans le prochain article, nous verrons comment paralléliser les traitements sur les nœuds du cluster.</p> <p><ins>Références :</ins> <br />
<a href="http://fr.wikipedia.org/wiki/Table_arc-en-ciel">wikipedia</a> <br />
<a href="http://www.codinghorror.com/blog/2007/09/rainbow-hash-cracking.html">coding horror</a></p>