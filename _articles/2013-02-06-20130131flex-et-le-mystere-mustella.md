---
ID: 480
post_title: Flex et le mystère Mustella
author: Martin Mouterde
post_date: 2013-02-06 09:48:00
post_excerpt: '<p>Cela fait plusieurs fois que ce nom est mentionné dans les notes de version Apache Flex. Dans la toute récente version 4.9.0, une fois encore, il était question de&nbsp;: «&nbsp;The “Mustella” testing framework has been improved and many tests have been updated. ». Notez les guillemets entourant le nom du projet qui trahissent, sans doute, la part de mystère qui entoure ce projet.</p> <p>Pour avoir tenté, à plusieurs reprises et en vain, d’insérer, dans l’intégration continue, des tests automatisés d’IHM sur des projets Flex avec FlexMonkey, FlexMonkium..., je suis devenu un peu sceptique sur ce type de frameworks. Pas tant au niveau de leur intérêt mais plutôt au niveau de l’usage et de leur rentabilité. Autant, les tests FlexUnit fonctionnent en standalone, sont efficaces, et restent acceptables sur le plan du maintien des jeux de tests.</p> <p>Autant les outils de tests IHM sont souvent des usines à gaz qui nécessitent beaucoup d’intégration avec d’autres outils et les jeux de tests sont très couteux à maintenir. Ceci dit, je n’ai toujours pas renoncé, et l’annonce de ce nouveau framework a attiré mon attention. J’ai donc creusé un peu histoire de découvrir ce nouveau venu.</p>'
layout: post
permalink: http://blog.zenika-offres.com/?p=480
published: true
---
<p>Cela fait plusieurs fois que ce nom est mentionné dans les notes de version Apache Flex. Dans la toute récente version 4.9.0, une fois encore, il était question de&nbsp;: «&nbsp;The “Mustella” testing framework has been improved and many tests have been updated. ». Notez les guillemets entourant le nom du projet qui trahissent, sans doute, la part de mystère qui entoure ce projet.</p> <p>Pour avoir tenté, à plusieurs reprises et en vain, d’insérer, dans l’intégration continue, des tests automatisés d’IHM sur des projets Flex avec FlexMonkey, FlexMonkium..., je suis devenu un peu sceptique sur ce type de frameworks. Pas tant au niveau de leur intérêt mais plutôt au niveau de l’usage et de leur rentabilité. Autant, les tests FlexUnit fonctionnent en standalone, sont efficaces, et restent acceptables sur le plan du maintien des jeux de tests.</p> <p>Autant les outils de tests IHM sont souvent des usines à gaz qui nécessitent beaucoup d’intégration avec d’autres outils et les jeux de tests sont très couteux à maintenir. Ceci dit, je n’ai toujours pas renoncé, et l’annonce de ce nouveau framework a attiré mon attention. J’ai donc creusé un peu histoire de découvrir ce nouveau venu.</p>
<!--more-->
<h3>Mais qu’est-ce donc que ce «&nbsp;Mustella&nbsp;»</h3> <p>Non, il ne s’agit pas d’un produit chocolaté à l’huile de palme, ni d’un produit pour bébé… Il semble que les informaticiens ne soient pas au fait des noms de marques de produits pour bébé ?! Ce qui pose problème quand ils nomment des projets&nbsp;: Les informations sur ce framework ne sont pas légions mais avec un nom aussi proche d’une grande marque de produit de premier âge, il devient vraiment difficile de s’y retrouver parmi les résultats des moteurs de recherche.</p> <p>Plus sérieusement, Mustella était un projet interne chez Adobe utilisé pour automatiser des tests fonctionnels. Il passe petit à petit sous le giron d’Apache. Autant le dire tout de suite, bien que Apachizé, fonctionnel et maintenu, il n’est toujours pas prêt pour une intégration dans vos chaines de production logicielles favorites. Son code est intimement lié à l’arborescence des sources du SDK Flex.</p> <p>Mustella est un framework développé en Flex (à 98%) et quelques classes java. Il se propose de faire des tests fonctionnels et graphiques. Il se positionne donc comme complément des tests unitaires plus classiques déjà adressés par FlexUnit. Le principal usage qui en est fait actuellement est la validation de comportements visuels de composants graphiques. Il est aujourd’hui utilisé par les développeurs Apache pour tester la majeure partie des composants graphiques du framework Flex.</p> <p>Concrètement, pour lancer un test avec Mustella il vous faut (en plus de Mustella)&nbsp;:</p> <ul> <li>Des classes de tests</li> <li>Les sources et ressources de l’application à tester</li> </ul> <p>Rien de plus que pour des TU finalement... Là normalement, vous vous dites&nbsp;: Comment fait-il pour les tests graphiques&nbsp;? Ne manque-t-il pas tout un référentiel de copies d’écran faite à l’arrache avec l’Impr Ecr et Paint sur l’application en prod&nbsp;? Et bien non, Mustella se propose de les gérer pour vous&nbsp;: Un vrai plus, quand on sait le travail que cela représente&nbsp;! Lors du premier lancement, l’option -createImages va créer automatiquement les images afin de les archiver et de s’en servir comme référence pour les lancements suivants (sans l’option).   Voici un exemple de test&nbsp;:</p> <pre class="xml code xml" style="font-family:inherit"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;1.0&quot;</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">&quot;utf-8&quot;</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;UnitTester</span> <span style="color: #000066;">testDir</span>=<span style="color: #ff0000;">&quot;./&quot;</span>  <span style="color: #000066;">xmlns:mx</span>=<span style="color: #ff0000;">&quot;http://www.adobe.com/2006/mxml&quot;</span> </span> <span style="color: #009900;"><span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">&quot;*&quot;</span> <span style="color: #000066;">testSWF</span>=<span style="color: #ff0000;">&quot;MustellaHelloWord.mxml&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span> 	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;mx:Script<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> 		<span style="color: #339933;">&lt;![CDATA[</span> <span style="color: #339933;">			import mx.collections.ArrayCollection;</span> <span style="color: #339933;">			import com.zenika.mustellaHelloword.model.Consultant;</span> &nbsp; <span style="color: #339933;">			[Bindable]</span> <span style="color: #339933;">			private static var consultants:ArrayCollection = new ArrayCollection([new Consultant(&quot;Martin&quot;,&quot;Mouterde&quot;,&quot;zenika.png&quot;)]);</span> <span style="color: #339933;">		]]&gt;</span> 	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/mx:Script<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> 	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;setup<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> 		<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ResetComponent</span> <span style="color: #000066;">target</span>=<span style="color: #ff0000;">&quot;consultantsGrid&quot;</span> <span style="color: #000066;">className</span>=<span style="color: #ff0000;">&quot;spark.component.DataGrid&quot;</span> <span style="color: #000066;">waitEvent</span>=<span style="color: #ff0000;">&quot;updateComplete&quot;</span> <span style="color: #000066;">waitTarget</span>=<span style="color: #ff0000;">&quot;consultantsGrid&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span> 	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/setup<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> 	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;testCases<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> 		<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TestCase</span> <span style="color: #000066;">testID</span>=<span style="color: #ff0000;">&quot;logoInGrid&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span> 			<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;body<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> 				<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;SetProperty</span> <span style="color: #000066;">propertyName</span>=<span style="color: #ff0000;">&quot;consultants&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;{consultants}&quot;</span> <span style="color: #000066;">target</span>=<span style="color: #ff0000;">&quot;consultantsGrid&quot;</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span> 				<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;AssertPropertyValue</span> <span style="color: #000066;">propertyName</span>=<span style="color: #ff0000;">&quot;dataProviderLength&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;1&quot;</span> <span style="color: #000066;">target</span>=<span style="color: #ff0000;">&quot;consultantsGrid&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span> 				<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;CompareBitmap</span> <span style="color: #000066;">url</span>=<span style="color: #ff0000;">&quot;./baselines/logoInGrid.png&quot;</span> <span style="color: #000066;">target</span>=<span style="color: #ff0000;">&quot;consultantsGrid&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span> 			<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/body<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> 		<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TestCase<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> 	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/testCases<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/UnitTester<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre> <p>Un des reproches qu’on pouvait faire au duo FlexMonkey/Selenium c’est que dans la logique d’un framework à composant comme Flex, il est incontournable d’avoir sur un même écran plusieurs instances d’un même composant. Mustella ne réinvente rien à ce sujet,
il sera lui aussi perdu sur un test à l’échelle de l’application, mais son usage est différent&nbsp;: Il teste le composant de manière isolée (bouchonnée si besoin par le code de test). Et pour cela pas besoin de gérer / déployer de petites sous applications. Il automatise, en quelque sorte, la compilation, le lancement, le test de multiples applications Flex Standalone ne comportant qu’un composant animé par du code de test.</p> <p>Et même les différents navigateurs ou plateformes&nbsp;:</p> <p>Mustella, par défaut utilise le FlexPlayerDebugger standalone. Mais il est possible, et c’est utilisé aussi comme cela par les développeurs Flex, de préciser un navigateur ou une plateforme d’exécution y compris des plateformes mobiles (iOs, Android…). Pour conclure sur ce premier portrait, Mustella n’est pas encore prêt à un usage déconnecté des sources du SDK Flex, dans les outils d’intégration continue, mais il constitue déjà un outil plutôt abouti de tests fonctionnels. Espérons qu’il sorte rapidement de son enclave pour que tous les projets Flex puissent en profiter.</p>