---
ID: 165
post_title: >
  Utiliser le builder Gradle pour vos
  applications Wicket
author: Grégory Boissinot
post_date: 2009-04-20 12:09:00
post_excerpt: |
  <p>Dans <a href="/index.php?post/2009/03/10/Concours-D%C3%A9velopper-une-application-web-en-Wicket3">le billet sur le concours du dévelopement d'une application Web en Wicket</a>, une solution de l'application Zencontact avait été donnée. Cette solution utilise le système de construction <a href="http://maven.apache.org/">Maven</a>. Nombre d'entre vous ne savent pas très bien utiliser Maven, ou n'ont tout simplement pas envie d'installer la très lourde infrastructure Maven.</p> <p>Maven est un outil de build très populaire et très utilisé. Néanmoins, il souffre de nombreuses lacunes. Il ne s’agit pas de la solution ultime; la preuve avec la naissance de nombreux autres outils de builds après Maven comme <a href="http://gant.codehaus.org/">Gant</a>, <a href="http://www.gradle.org/">Gradle</a>, <a href="http://quokka.ws/">Quokka</a>, <a href="https://kundo.dev.java.net/">Kundo</a>, <a href="http://easyant.org/trac">EasyAnt</a>, ...</p> <p>La section suivante présente l'utilisation du builder Gradle sur l'application Web Wicket Zencontact.<a href="http://wiki.hudson-ci.org/display/HUDSON/Gradle+Plugin"></a></p>
layout: post
permalink: http://blog.zenika-offres.com/?p=165
published: true
---
<p>Dans <a href="/index.php?post/2009/03/10/Concours-D%C3%A9velopper-une-application-web-en-Wicket3">le billet sur le concours du dévelopement d'une application Web en Wicket</a>, une solution de l'application Zencontact avait été donnée. Cette solution utilise le système de construction <a href="http://maven.apache.org/">Maven</a>. Nombre d'entre vous ne savent pas très bien utiliser Maven, ou n'ont tout simplement pas envie d'installer la très lourde infrastructure Maven.</p> <p>Maven est un outil de build très populaire et très utilisé. Néanmoins, il souffre de nombreuses lacunes. Il ne s’agit pas de la solution ultime; la preuve avec la naissance de nombreux autres outils de builds après Maven comme <a href="http://gant.codehaus.org/">Gant</a>, <a href="http://www.gradle.org/">Gradle</a>, <a href="http://quokka.ws/">Quokka</a>, <a href="https://kundo.dev.java.net/">Kundo</a>, <a href="http://easyant.org/trac">EasyAnt</a>, ...</p> <p>La section suivante présente l'utilisation du builder Gradle sur l'application Web Wicket Zencontact.<a href="http://wiki.hudson-ci.org/display/HUDSON/Gradle+Plugin"></a></p>
<!--more-->
<p>Gradle est un système de build innovant. Utilisant une syntaxe <a href="http://groovy.codehaus.org/">Groovy</a>, il est à base de conventions comme dans Maven avec par exemple</p> <ul> <li>des conventions de répertoires</li> <li>des conventions de noms</li> <li>des cycles de vie intégrés</li> <li>un système de gestion de dépendances avancé</li> <li>une gestion des sous modules</li> </ul> <h4>Conventions de répertoire</h4> <p>Gradle utilise les mêmes conventions de répertoire que Maven. Dans l'application zencontact&nbsp;:</p> <ul> <li>les sources Java sont dans 'src/main/java',</li> <li>les ressources statiques du projet dans 'src/main/resources'</li> <li>les ressources Web du projet dans 'src/main/weapp'</li> <li>les sources Java de tests dans 'src/test/java'</li> <li>...</li> </ul> <h4>Conventions de noms</h4> <p>La première partie du script consiste à déclarer l'entité organisationnelle sur laquelle est rattachée le projet Gradle (group), la version du projet et la base des noms des artefacts générés.</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">group <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'com.zenika.wicket'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">version <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'1.0-SNAPSHOT'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">archivesBaseName<span style="color: #66cc66;">=</span><span style="color: #ff0000;">'zencontact'</span></div></li></ol></pre> <p>Dans cette configuration, l'artefact généré sera nommé 'zencontact-1.0-SNAPSHOT.war'.</p> <h4>Cycles de vie</h4> <p>Une seconde section consiste à décrire l'utilisation du plugin Gradle 'war' mettant à disposition un cycle  de vie dédié à la construction d'une archive Web (init, resources, compile, testResources, testCompile, test, archive_war, libs, uploadLibs).</p> <p>Puis nous déclarons le plugin 'jetty' permettant de démarrer le serveur d'application <a href="http://www.mortbay.org/jetty/">Jetty</a> afin de tester l'application générée.</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">usePlugin<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'war'</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">usePlugin<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'jetty'</span><span style="color: #66cc66;">&#41;</span></div></li></ol></pre> <h4>Gestion des dépendances</h4> <p>Ensuite nous déclarons les librairies nécessaires</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">dependencies <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    addFlatDirResolver<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'lib'</span>, <span style="color: #ff0000;">&quot;$rootDir/lib&quot;</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    compile      <span style="color: #ff0000;">&quot;:wicket:1.3.5&quot;</span>,</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	         <span style="color: #ff0000;">&quot;:wicket-extensions:1.3.5&quot;</span>,</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	         <span style="color: #ff0000;">&quot;:wicket-datetime:1.3.5&quot;</span>,</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                 <span style="color: #ff0000;">&quot;:scriptaculous:1.3&quot;</span>,</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		 <span style="color: #ff0000;">&quot;:yav:1.0&quot;</span>,</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	         <span style="color: #ff0000;">&quot;:slf4j-log4j12:1.4.2&quot;</span>,</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">             	 <span style="color: #ff0000;">&quot;:log4j:1.2.14&quot;</span>,</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		 <span style="color: #ff0000;">&quot;:joda-time:1.4&quot;</span>,</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">  		 <span style="color: #ff0000;">&quot;:slf4j-api:1.4.2&quot;</span>,<span style="color: #ff0000;">&quot;:slf4j-log4j12:1.4.2&quot;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    testCompile  <span style="color: #ff0000;">&quot;:junit:3.8.2&quot;</span>  	</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li></ol></pre> <p>Gradle fournit une déclaration des dépendances du projet dans une syntaxe très simple. Grâce au langage de script Groovy, l'utilisation lourde et non adéquate du langage XML est définitivement proscris; contrairement aux autres outils de build comme Maven. De plus, par l'utilisation d'une DSL Groovy au dessus de l'outil de dépendance <a href="http://ant.apache.org/ivy/">Ivy</a>, nous pouvons bénéficier de tous les avantages du plus puissant gestionnaire de dépendance du marché pour déclarer les librairies du projet; et sans l'écriture du descripteur ivy.xml.</p> <p>Le premier avantage de l'utilisation  de Ivy est la capacité d'utiliser son propre resolver, chargé de la récupération des librairies.  Dans l'exemple, le resolver va récupérer les librairies dans le repository filesystem 'lib', présent à la racine du projet.</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">addFlatDirResolver<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'lib'</span>, <span style="color: #ff0000;">&quot;$rootDir/lib&quot;</span><span style="color: #66cc66;">&#41;</span></div></li></ol></pre> <p>Dans notre cas, le pattern de récupération est '<a href="artifact" title="artifact">artifact</a>-<a href="revision" title="revision">revision</a>.<a href="ext" title="ext">ext</a> '.</p> <p>Ce resolver est dans notre cas tout à fait adapté. Il n'y a plus besoin de connexion internet, d
e gérer vos librairies métiers et les librairies techniques dans des repository avec des gestionnaires de repository comme <a href="http://archiva.apache.org/">Archiva</a>, <a href="http://nexus.sonatype.org/">Nexus</a>. Mais contrairement à un  simple builder comme Ant où toutes vos libraires n'étaient pas classées, ici, nous pouvons clairement spécifier les libraires qui seront utilisées à la compilation, à l'exécution, durant le tests, ….</p> <p><ins>Remarque:</ins> Gradle permet également de ne pas gérer les librairies. Ainsi au lieu de spécifier la section des dépendances, il est possible de simplement spécifier le classpath de compilation.</p> <pre> def wicketJarList = new File(&quot;$rootDir/lib&quot;).listFiles( [ accept : { File dir , String name -&gt; ( name =~ '.jar$' ).find ( ) } ] as FilenameFilter ) as List compile.unmanagedClasspath = wicketJarList </pre> <h4>Spécificité pour notre application Web Wicket</h4> <h5>Version de Java</h5> <p>Nous déclarons ensuite que notre application comporte du code source Java 5 et que le résultat de la compilation sera du byte code Java 5  (note&nbsp;: à partir de Gradle 0.6, 1.5 sera la valeur par défaut)</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">targetCompatibility <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'1.5'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">sourceCompatibility <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'1.5'</span></div></li></ol></pre> <h5>Copie des ressources HTML</h5> <p>La dernière section du script de build est l'utilisation d'une tâche <a href="http://ant.apache.org/">Ant</a> qui va permettre de copier les ressources HTML Wicket au même niveau que les classes Java compilées (mode par défaut dans Wicket, utilisé dans l'application Zencontact)</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">createTask<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'resources'</span>,overwrite:<span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"> ant<span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">  echo<span style="color: #66cc66;">&#40;</span>message:<span style="color: #ff0000;">'Copy HTML resources'</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">  copy<span style="color: #66cc66;">&#40;</span>todir:<span style="color: #ff0000;">'build/classes'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">   fileset<span style="color: #66cc66;">&#40;</span>dir:<span style="color: #ff0000;">'src/main/java'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    exclude <span style="color: #66cc66;">&#40;</span>name:<span style="color: #ff0000;">'**/*.java'</span><span style="color: #66cc66;">&#41;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">   <span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">  <span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"> <span style="color: #66cc66;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #66cc66;">&#125;</span></div></li></ol></pre> <p><ins>Remarqe:</ins> Gradle permet la réutilisation de toute tâche Ant existante. L'expression est en Groovy, sans XML. Malgré la très grande popularité de Maven 2, Ant reste l'outil de build le plus complet, le plus performant et le plus documenté pour des programmes Java. Avoir à sa disposition, l'ensemble des tâches Ant accessibles, fait de Gradle un système incontournable.</p> <h4>Le wrapper Gradle</h4> <p>Automatiser sa chaîne de construction est une étape essentielle, mais il reste ensuite à la rendre continue en l'adossant à un serveur d'intégration continue. Un des principes de base de l'intégration continue est d'avoir une chaîne de build indépendant de l'infrastructure. Or, à partir du moment où votre script est écrit en Ant ou en Maven, il vous faut l'outil Ant ou l'outil Maven installé sur le serveur d'intégration continue afin d'exécuter le script de build. Vous êtes donc dépendant de l'emplacement de l'outil, de sa version, de ses dépendances extérieures comme les variables d'environnement, les mécanismes de repository pour Maven, ….</p> <p>Pour builder du script Gradle, vous pouvez installer Gradle et configurer Gradle sur votre serveur d'intégration continue, puis utiliser <a href="http://wiki.hudson-ci.org/display/HUDSON/Gradle+Plugin">le plugin Gradle de Hudson</a>. Mais Gradle met gratuitement à disposition son wrapper permettant l'utilisation de Gradle sans avoir l'outil Gradle installé et configuré.</p> <pre class="groovy code groovy" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">createTask<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'wrapper'</span>, type: Wrapper<span style="color: #66cc66;">&#41;</span>.<span style="color: #006600;">configure</span> <span style="color: #66cc66;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    gradleVersion <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'0.5.2'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    archiveBase <span style="color: #66cc66;">=</span> Wrapper.<span style="color: #006600;">PathBase</span>.<span style="color: #006600;">PROJECT</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    archivePath <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'wrapper'</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    jarPath <span style="color: #66cc66;">=</span> archivePath</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span
 style="color: #66cc66;">&#125;</span></div></li></ol></pre> <p>L’invocation de cette tache Gradle génère un fichier gradew pour Unix et gradlew.bat pour Windows, qui appelleront une librairie gradle-wrapper.jar chargé du travail.</p> <h4>Utilisation de l'application Zencontact avec Gradle</h4> <h5>Génération de la configuration Eclipse</h5> <p>Tout comme avec Maven, vous pouvez générer la configuration Eclipse (avec les fichiers de configurations WTP dans le cas d'une application Web)</p> <pre> gradle eclipse </pre> <p>ou si vous utilisez le wrapper Gradle</p> <pre> gradlew eclipse </pre> <h5>Génération du livrable</h5> <p>La génération de l'archive Web est réalisée par la commande</p> <pre> gradle clean libs </pre> <p>ou si vous utilisez le Gradle wrapper</p> <pre> gradlew clean libs </pre> <p>Gradle exécute un cycle de vie jusqu'à la phase 'libs'. Il vous suffira ensuite de récupérer l'archive web dans le répertoire 'build' et de la déployer dans un container Web.</p> <h5>Test de l'application</h5> <p>Nous vous proposons de tester l'application avec le très léger container Web Jetty. Grâce à la déclaration de l'utilisation du plugin jetty dans le script Gradle, nous pouvons simplement invoquer</p> <pre> gradle jettyRun </pre> <p>ou si vous utilisez le wrapper Gradle</p> <pre> gradlew jettyRun </pre> <h4>Téléchargement</h4> <p>Pour tester l'application Wicket zencontact avec Gradle,</p> <ul> <li>Si vous avez une installation de Gradle déjà existante, vous pouvez télécharger le zip <a href="/wp-content/uploads/2015/07/zencontact-gradle.zip">"zencontact-gradle.zip"</a>, extraire le zip dans le répertoire de votre choix et lancer les commandes Gradle.</li> </ul> <ul> <li>Si n'avez pas Gradle installé et que vous ne souhaitez pas l'installer dans le cadre de cette démonstration, télécharger le zip <a href="/wp-content/uploads/2015/07/zencontact-gradle-with-distribution.zip">"zencontact-gradle-with-distribution.zip"</a>, extraire le zip dans le répertoire de votre choix et lancer les commandes Gradle wrapper.</li> </ul>