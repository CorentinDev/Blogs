---
ID: 118
post_title: Overview of Spring Data MongoDB
author: Arnaud Cogoluègnes
post_date: 2012-05-11 09:30:00
post_excerpt: |
  <p>The <a href="http://www.springsource.org/spring-data">Spring Data umbrella project</a> aims at providing support for new data access technologies. It hosts many sub-projects and one of them is dedicated to <a href="http://www.mongodb.org/">MongoDB</a>. <a href="http://www.springsource.org/spring-data/mongodb">Spring Data MongoDB</a> comes with tons of features for the Java developers working with MongoDB: database and collection management, lightweight object-document mapping, and dynamic repositories are some of these features. Let's take a tour!</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=118
published: true
---
<p>The <a href="http://www.springsource.org/spring-data">Spring Data umbrella project</a> aims at providing support for new data access technologies. It hosts many sub-projects and one of them is dedicated to <a href="http://www.mongodb.org/">MongoDB</a>. <a href="http://www.springsource.org/spring-data/mongodb">Spring Data MongoDB</a> comes with tons of features for the Java developers working with MongoDB: database and collection management, lightweight object-document mapping, and dynamic repositories are some of these features. Let's take a tour!</p>
<!--more-->
<h2>Working on DBObjects with the MongoTemplate</h2> <p>The <code>MongoTemplate</code> is easy to set up, it justs needs a <code>Mongo</code> instance (i.e. connection to MongoDB) and the  name of the database to work with:</p> <pre class="java code java" style="font-family:inherit">MongoOperations tpl = <span style="color: #7F0055; font-weight: bold;">new</span> MongoTemplate<span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">new</span> Mongo<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,<span style="color: #888888;">&quot;spring-mongo&quot;</span><span style="color: #000000;">&#41;</span>;</pre> <p>Note we use the <code>MongoOperations</code> interface. Working against interfaces is a best practice and can make your life easier if you want to mock your Mongo template with JDK proxies.</p> <p>The Mongo template provides methods to manipulate collections:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #7F0055;font-weight: bold;">if</span><span style="color: #000000;">&#40;</span>tpl.<span style="color: #000000;">collectionExists</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;contact&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>   tpl.<span style="color: #000000;">dropCollection</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;contact&quot;</span><span style="color: #000000;">&#41;</span>; <span style="color: #000000;">&#125;</span></pre> <p>It lets you also work with plain <code>DBObject</code> (the document interface in the MongoDB Java driver):</p> <pre class="java code java" style="font-family:inherit">DBObject doc = BasicDBObjectBuilder.<span style="color: #000000;">start</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>   .<span style="color: #000000;">add</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;firstname&quot;</span>,<span style="color: #888888;">&quot;Arnaud&quot;</span><span style="color: #000000;">&#41;</span>   .<span style="color: #000000;">add</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;lastname&quot;</span>,<span style="color: #888888;">&quot;Cogoluègnes&quot;</span><span style="color: #000000;">&#41;</span>   .<span style="color: #000000;">get</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; tpl.<span style="color: #000000;">getCollection</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;contact&quot;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">insert</span><span style="color: #000000;">&#40;</span>doc<span style="color: #000000;">&#41;</span>; assertThat<span style="color: #000000;">&#40;</span>tpl.<span style="color: #000000;">getCollection</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;contact&quot;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">count</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,is<span style="color: #000000;">&#40;</span>1L<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</pre> <p>Neat, but nothing much new compared to the basic Java driver so far. This is where it comes to work with domain objects that the Mongo template really shines.</p> <h2>Object-Document mapping</h2> <p>Using a document datastore doesn't mean your application doesn't have a fixed, rich domain model. Working with a set a domain classes makes you more productive than strictly working with <code>DBOjects</code>, which are - let's face it - hard to manipulate.</p> <p>Spring's <code>MongoTemplate</code> offers a powerful object-document mapping engine. Such a tool is convenient for validation, type checking, and associations.</p> <p>Spring's object-document mapper is as simple as this to use:</p> <pre class="java code java" style="font-family:inherit">Contact contact = <span style="color: #7F0055; font-weight: bold;">new</span> Contact<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Arnaud&quot;</span>,<span style="color: #888888;">&quot;Cogoluègnes&quot;</span><span style="color: #000000;">&#41;</span>; tpl.<span style="color: #000000;">insert</span><span style="color: #000000;">&#40;</span>contact<span style="color: #000000;">&#41;</span>; assertThat<span style="color: #000000;">&#40;</span>tpl.<span style="color: #000000;">getCollection</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;contact&quot;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">count</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,is<span style="color: #000000;">&#40;</span>1L<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</pre> <p>The Mongo template stores the <code>Contact</code> object in a <code>contact</code> collection. If we use the Mongo shell to see the content of the collection:</p> <pre> &gt; db.contact.find() { &quot;_id&quot; : ObjectId(&quot;4fa0e00f44ae8342620a0bc3&quot;),    &quot;_class&quot; : &quot;com.zenika.domain.Contact&quot;,    &quot;firstname&quot; : &quot;Arnaud&quot;,    &quot;lastname&quot; : &quot;Cogoluègnes&quot; } </pre> <p>You don't need to provide any mapping metadata, but you can if you want to:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #7F0055; font-weight: bold;">package</span> com.<span style="color: #000000;">zenika</span>.<span style="color: #000000;">domain</span>; &nbsp; <span style="color: #a1a100;">import org.springframework.data.annotation.Id;</span> <span style="color: #a1a100;">import org.springframework.data.mongodb.core.mapping.Document;</span> &nbsp; @<span style="color: #000000;">Document</span> <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> Contact <span style="color: #000000;">&#123;</span> &nbsp;   @Id   <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #000000;">String</span> id; &nbsp;   <span style="color: #7F0055; font-weight: bold;">private</span> <span style="color: #000000;">String</span> firstname,lastname; &nbsp;   <span style="color: #7F0055; font-weight: bold;">public</span> Contact<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span><span style="color: #000000;">&#125;</span> &nbsp;   <span style="color: #000000;">&#40;</span>...<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#125;</span></pre> <p>Once there are documents in your collections, you usually want to retrieve them through some query API. Let's see what the Mongo template offers.</p> <h2>Query DSL</h2> <p>Spring Data MongoDB provides a fluent query API. The Mongo template has a <code>find</code> method that accepts a <code>Query</code> instance. Such a <code>Query</code> is usually created with static factory methods:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #a1a100;">import static org.springframework.data.mongodb.core.query.Criteria.where;</span> <span style="color: #a1a100;">import static org.springframework.data.mongodb.core.query.Query.query;</span> <span style="color: #000000;">&#40;</span>...<span style="color: #000000;">&#41;</span> List<span style="color: #000000;">&lt;</span>Contact<span style="color: #000000;">&gt;</span> contacts = tpl.<span style="color: #000000;">find</span><span style="color: #000000;">&#40;</span>query<span style="color: #000000;">&#40;</span>where<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;firstname&quot;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">is</span><span style="color: #000000;">&#40;</span><span style="color: #88888
8;">&quot;Arnaud&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>,Contact.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span>; assertThat<span style="color: #000000;">&#40;</span>contacts.<span style="color: #000000;">size</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,is<span style="color: #000000;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</pre> <p>This query API supports all the MongoDB query features (operators like greater than, and, or, and so on, sort, and pagination as well).</p> <p>The Mongo template has a great API you can use everywhere in your applications, but you can also choose to have a dedicated access layer. Spring Data MongoDB can also help by providing ready-to-use, dynamic repositories.</p> <h2>Dynamic repositories</h2> <p>A data access layer can be useful to abstract the underlying data access technology of an application. Upper layers - usually a business layer - don't know anything about this data access technology. Such an abstraction is useful if the application switches from one framework to another or if one mocks the data access layer to unit test the business layer more easily.</p> <p>With Spring Data MongoDB, one can easily expose CRUD repositories. The first step is to declare a repository interface for an entity class:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #7F0055; font-weight: bold;">package</span> com.<span style="color: #000000;">zenika</span>.<span style="color: #000000;">repo</span>; &nbsp; <span style="color: #a1a100;">import org.springframework.data.mongodb.repository.MongoRepository;</span> <span style="color: #a1a100;">import com.zenika.domain.Contact;</span> &nbsp; <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">interface</span> ContactRepository <span style="color: #7F0055; font-weight: bold;">extends</span> MongoRepository<span style="color: #000000;">&lt;</span>Contact, String<span style="color: #000000;">&gt;</span> <span style="color: #000000;">&#123;</span> <span style="color: #000000;">&#125;</span></pre> <p>The second step is to tell Spring Data MongoDB where to find your repository interfaces:</p> <pre class="xml code xml" style="font-family:inherit"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;mongo:repositories</span> <span style="color: #000066;">base-package</span>=<span style="color: #ff0000;">&quot;com.zenika.repo&quot;</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span> &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;mongo:mongo</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span> &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;bean</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">&quot;mongoTemplate&quot;</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">&quot;org.springframework.data.mongodb.core.MongoTemplate&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;constructor-arg</span> <span style="color: #000066;">ref</span>=<span style="color: #ff0000;">&quot;mongo&quot;</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span>   <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;constructor-arg</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;spring-mongo&quot;</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre> <p>Note you need to provide the framework with a Mongo instance and a Mongo template. You don't need to provide any implementation for the repository: Spring Data MongoDB implements the behavior dynamically. You just have to look up the repo from the Spring context and use it:</p> <pre class="java code java" style="font-family:inherit">ContactRepository contactRepository = context.<span style="color: #000000;">getBean</span><span style="color: #000000;">&#40;</span>ContactRepository.<span style="color: #7F0055; font-weight: bold;">class</span><span style="color: #000000;">&#41;</span>; contactRepository.<span style="color: #000000;">deleteAll</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; Contact contact = <span style="color: #7F0055; font-weight: bold;">new</span> Contact<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Arnaud&quot;</span>,<span style="color: #888888;">&quot;Cogoluègnes&quot;</span><span style="color: #000000;">&#41;</span>; contactRepository.<span style="color: #000000;">save</span><span style="color: #000000;">&#40;</span>contact<span style="color: #000000;">&#41;</span>; assertThat<span style="color: #000000;">&#40;</span>contactRepository.<span style="color: #000000;">count</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,is<span style="color: #000000;">&#40;</span>1L<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</pre> <p>By extending <code>MongoRepository</code>, the repository provides all the CRUD operations (with bonuses like sorting and paging). By following conventions, you can also provide your own methods, the repository will implements them on the fly:</p> <pre class="java code java" style="font-family:inherit"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">interface</span> ContactRepository <span style="color: #7F0055; font-weight: bold;">extends</span> MongoRepository<span style="color: #000000;">&lt;</span>Contact, String<span style="color: #000000;">&gt;</span> <span style="color: #000000;">&#123;</span> &nbsp;   <span style="color: #808080; font-style: italic;">// declaring a new method</span>   List<span style="color: #000000;">&lt;</span>Contact<span style="color: #000000;">&gt;</span> findByFirstname<span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span> firstname<span style="color: #000000;">&#41;</span>; &nbsp; <span style="color: #000000;">&#125;</span> &nbsp; <span style="color: #808080; font-style: italic;">// using the new method, no need to implement it</span> List<span style="color: #000000;">&lt;</span>Contact<span style="color: #000000;">&gt;</span> contacts = contactRepository.<span style="color: #000000;">findByFirstname</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Arnaud&quot;</span><span style="color: #000000;">&#41;</span>; assertThat<span style="color: #000000;">&#40;</span>contacts.<span style="color: #000000;">size</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>,is<span style="color: #000000;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</pre> <p>Thanks to the name of the method, Spring Data MongoDB understands the criteria is on the <code>firstname</code> property.</p> <p>This dynamic repository support is sophisticated: one can "blend" its own implementation with the dynamic ones, add parameters for sorting or paging, provides JSON-based queries with annotations, and so on. Note Spring Data provides the exact <a href="http://www.springsource.org/spring-data/jpa">same support for JPA</a>.</p> <h2>Conclusion</h2> <p>The Spring Data MongoDB provides a comprehensive, yet progressive support for Java-based MongoDB applications. MongoDB's Java driver works great, but can frustrate people used to working with strongly-typed domain models.</p> <p>We scratch
ed only the surface of Spring Data MongoDB, don't hesitate to check its reference documentation for the JPA integration (<a href="http://martinfowler.com/bliki/PolyglotPersistence.html">polyglot persistence</a>), the listener support (callbacks around the lifecycle of entities), or its geo-spatial integration. Check out also the brand-new <a href="http://www.springsource.org/spring-data/rest">Spring Data REST</a> project if you want to expose your MongoDB documents as REST resources thanks to the dynamic repositories.</p> <p><a href="https://github.com/acogoluegnes/Spring-MongoDB">Source code</a></p>