---
ID: 433
post_title: 'Sencha Touch : un framework HTML5 pour Mobile'
author: shadjiat
post_date: 2011-04-21 10:59:00
post_excerpt: |
  <p>Sencha Touch est un framework JavaScript spécialement conçu pour développer des applications web mobiles. Ce produit est développé par l'entreprise Sencha, anciennement nommée ExtJS, et qui s'est étendue avec jQTouch et Raphael.</p> <p>La particularité de ce framework est son développement presque exclusif en JavaScript. Sencha touch est compatible avec les platformes android, iOS (iphone, ipod touch, ipad) ainsi que le tout dernier BlackBerry 6. Il est en particulier adapté à toutes les résolutions d'écran. Il ne s’exécute cependant que sur les navigateurs webkit. Le framework est disponible en version 1.1 (sortie le 24 mars), sous une licence open source GPL3 et une licence commerciale gratuite.</p> <p>Dans cet article, vous allez apprendre comment utiliser Sencha Touch pour construire des "WebApps" riches et performantes pour votre mobile. Je reprendrai mon application Agenda précédemment développée avec jQTouch et jQuery Mobile.</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=433
published: true
slide_template:
  - ""
---
<p>Sencha Touch est un framework JavaScript spécialement conçu pour développer des applications web mobiles. Ce produit est développé par l'entreprise Sencha, anciennement nommée ExtJS, et qui s'est étendue avec jQTouch et Raphael.</p> <p>La particularité de ce framework est son développement presque exclusif en JavaScript. Sencha touch est compatible avec les platformes android, iOS (iphone, ipod touch, ipad) ainsi que le tout dernier BlackBerry 6. Il est en particulier adapté à toutes les résolutions d'écran. Il ne s’exécute cependant que sur les navigateurs webkit. Le framework est disponible en version 1.1 (sortie le 24 mars), sous une licence open source GPL3 et une licence commerciale gratuite.</p> <p>Dans cet article, vous allez apprendre comment utiliser Sencha Touch pour construire des "WebApps" riches et performantes pour votre mobile. Je reprendrai mon application Agenda précédemment développée avec jQTouch et jQuery Mobile.</p>
<!--more-->
<h2>Approche</h2> <p><br />
Le développement avec Sencha différe singulièrement des autres frameworks que j'ai présentés. En effet, quand jQTouch et jQueryMobile se contentent de fournir du CSS et d'améliorer un site web pour l'adapter au mobile, Sencha Touch fourni des composants d'UI en JavaScript et en génère ensuite les éléments HTML.</p> <p>Alors comment utiliser ce framework? Commençons par créer une page HTML. Dans cette page, au niveau de la balise <code>head</code>, doivent être référencés deux fichiers du framework&nbsp;: "sencha-touch.js" et "sencha-touch.css". Trois autres fichiers CSS sont fournis avec le framework: "apple", "android" et "bb6" (pour Blackberry) qu'on peut utiliser pour remplacer le thème "sencha-touch". Par ailleurs, la derniere version du framework fourni un script "autotheme.js" qui permet de changer automatiquement de thème suivant la platforme.</p> <p>Le reste du document, <code>body</code>, reste vide. A présent, passons à la création des pages de l'application avec les composants Sencha.</p> <p>On commence par initialiser l'application&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit">Ext.<span style="color: #660066;">setup</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>     tabletStartupScreen<span style="color: #339933;">:</span> <span style="color: #3366CC;">'tablet_startup.png'</span><span style="color: #339933;">,</span>     phoneStartupScreen<span style="color: #339933;">:</span> <span style="color: #3366CC;">'phone_startup.png'</span><span style="color: #339933;">,</span>     icon<span style="color: #339933;">:</span> <span style="color: #3366CC;">'icon.png'</span><span style="color: #339933;">,</span>     glossOnIcon<span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">false</span><span style="color: #339933;">,</span>     onReady<span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>             <span style="color: #006600; font-style: italic;">//création du panel et des composants</span>     <span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>La fonction <code>Ext.setup</code> organise l'application. Un certain nombre de paramètres peuvent être spécifiés comme l'écran de démarrage ou l'icone, et dans le paramètre <code>onReady</code>, on spécifie la fonction qui sera exécutée quand le DOM est prêt. C'est au sein de cette fonction qu'on défini les éléments qui seront affichés par le framework.</p> <p>Voici comment on défini un composant Sencha Touch&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">var</span> objectName <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Ext.<span style="color: #660066;">ComponentName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>      <span style="color: #009966; font-style: italic;">/*objectDefinition*/</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>Parmis ces composants, on peut créer un panel avec Ext.Panel&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">var</span> panel <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Ext.<span style="color: #660066;">Panel</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>     fullscreen<span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span>     dockedItems<span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#123;</span>             dock <span style="color: #339933;">:</span> <span style="color: #3366CC;">'top'</span><span style="color: #339933;">,</span>             xtype<span style="color: #339933;">:</span> <span style="color: #3366CC;">'toolbar'</span><span style="color: #339933;">,</span>             title<span style="color: #339933;">:</span> <span style="color: #3366CC;">'Home'</span>         <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>     items<span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#123;</span>             html<span style="color: #339933;">:</span> <span style="color: #3366CC;">'&lt;h1&gt;Welcome&lt;/h1&gt;'</span>     <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>L'objet <code>docketItems</code> permet d'organiser des éléments en "dock" et est utilisé pour afficher les barres d'outils. Ce qu'il faut savoir, c'est que Sencha Touch permet d'ajouter des composants de deux manières différentes&nbsp;: soit "anonymement" avec le paramètre xtype (ici avec 'toolbar'), soit en créant l'objet du composant correspondant. Ainsi pour cet exemple, on aurait pu créer à part un composant de type <code>Ext.Toolbar</code> et l'ajouter ensuite à <code>dockedItems</code> pour l'afficher dans le panel. Ensuite dans <code>items</code>, on spécifie le contenu du panel. Ici, j'ai écrit simplement du code HTML. Et voici ce que l'on obtient:</p> <p><img src="/wp-content/uploads/2015/07/Example1_Sencha.JPG" alt="Example1_Sencha.JPG" style="display:block; margin:0 auto;" /></p> <p>Plus généralement, le paramètre <code>items</code> peut contenir n'importe quels composants du framework. Pour les organiser, un paramètre doit être configuré&nbsp;: <code>layout</code>. Il existe plusieurs types de layout&nbsp;: 'auto', 'card', 'fit', 'hbox', 'vbox'. D'autre part, on peut également organiser des panels en onglets avec <code>Ext.TabPanel</code>, ou en carousel avec <code>Ext.Carousel</code>. Petite précision&nbsp;: les composants pouvant contenir d'autres composants, comme <code>Panel</code> ou <code>TabPanel</code>, héritent d'un conteneur plus général&nbsp;: <code>Ext.Container</code>.</p> <h2>Démonstration</h2> <p><br />
Pour la démonstration, j'ai repris mon application Agenda développée avec jQTouch et jQuery Mobile, pour la réaliser avec Sencha Touch. Cette fois, le développement étant très différent des deux autres frameworks, l'application a du être entièrement réécrite. Je rappelle une dernière fois en quoi elle consiste&nbsp;: une page permet de créer un évènement et de le sauvegarder sur le LocalStorage du navigateur, la page d'accueil liste les évènements et pour chacun on peut accéder à une page donnant les informations entrées. Parmi ces informations, se trouve l'emplacement de l'évènement, qu'on peut afficher sur une Google Map dans la page suivante.</p> <h3>Les panels</h3> <p>L'application se compose donc de 4 panels. J'ai défini chacun de ces panels dans un fichier JavaScript, et j'ai également un fichier JavaScript central dans lequel j'organise ces panels. Je commence par créer le panel d'accueil&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit">homePanel <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Ext.<span style="color: #660066;">Panel</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span> 	    fullscreen<span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span> 	    dockedItems<span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#123;</span> 	    	 	xtype<span style="color: #339933;">:</span> <span style="color: #3366CC;">'toolbar'</span><span style="color: #339933;">,</span> 	    	 	items<span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#123;</span>xtype<span style="color: #339933;">:</span> <span style="color: #3366CC;">'spacer'</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> newEventButton<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> 	    	 	title<span style="color: #339933;">:</span> <span style="color: #3366CC;">'Agenda'</span><span style="color: #339933;">,</span> 	    	 	dock<span style="color: #339933;">:</span> <span style="color: #3366CC;">'top'</span> 	    	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>Ce panel se compose donc d'une "toolbar" avec un bouton "newEventButton"&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">var</span> newEventButton <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Ext.<span style="color: #660066;">Button</span><span style="color: #009900;">&#40;</span>     	        <span style="color: #009900;">&#123;</span>     	            ui<span style="color: #339933;">:</span> <span style="color: #3366CC;">'normal'</span> <span style="color: #339933;">,</span>     	            text<span style="color: #339933;">:</span> <span style="color: #3366CC;">'New'</span><span style="color: #339933;">,</span>     	            iconMask<span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span>     	            iconCls<span style="color: #339933;">:</span> <span style="color: #3366CC;">'compose'</span>     	        <span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#41;</span>;</pre> <p>Pour créer un bouton avec Ext.Button, il faut spécifier plusieurs paramètres&nbsp;: <code>ui</code> qui défini la forme, taille et couleur du bouton ('normal', 'back', 'round', 'action', 'forward'), et <code>text</code> pour écrire un texte sur le bouton. Par ailleurs, Sencha Touch fourni des icones pour personnaliser les boutons. Pour cela, il suffit de spécifier les paramètres suivants&nbsp;: <code>iconCls</code> pour choisir le type d'icone, et <code>iconMask</code> pour afficher l'icone sur le bouton (mettre à "true"). La liste des différentes icones peut être trouvée dans les dossiers "icons" ou "toolbars" parmi les exemples fournis par le framework.</p> <p><a href="/wp-content/uploads/2015/07/Capture__home.png"><img src="/wp-content/uploads/2015/07/.Capture__home_s.jpg" alt="Capture__home.png" style="display:block; margin:0 auto;" /></a></p> <p>La Liste des évènements n'est pas encore comprise dans le panel, je détaillerai cette partie quand je parlerai du LocalStorage.</p> <p>Je passe à présent au panel permettant d'ajouter un évènement. Il contient un formulaire pour entrer les différentes informations. Pour créer un formulaire avec Sencha Touch, on utilise la classe <code>Ext.form.FormPanel</code>&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">var</span> myform <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Ext.<span style="color: #660066;">form</span>.<span style="color: #660066;">FormPanel</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span> 	cls <span style="color: #339933;">:</span> <span style="color: #3366CC;">'form'</span><span style="color: #339933;">,</span> 	<span style="color: #000066;">scroll</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">'vertical'</span><span style="color: #339933;">,</span> 	items<span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>              <span style="color: #009900;">&#123;</span>                xtype<span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;textfield&quot;</span><span style="color: #339933;">,</span>                <span style="color: #000066;">name</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">,</span>                label<span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Name&quot;</span><span style="color: #339933;">,</span>                placeHolder<span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Enter the event's name&quot;</span>              <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>              <span style="color: #006600; font-style: italic;">//...</span> 	<span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>Le paramètre <code>cls</code> permet d'indiquer une classe CSS additionnelle, qui est décrite dans la page HTML. Ici j'ai ajouté cette classe pour spécifier la taille du formulaire et l'afficher sur toute la page. Ensuite, les champs de saisie sont ajoutés à <code>items</code>. Pour chaque champ, il faut spécifier un certain nombre de paramètres, les plus communs étant le type <code>xtype</code>, le nom <code>name</code>, et le label. Par ailleurs, Sencha Touch fourni des classes pour chaque champ avec une interface adapté au mobile. Ainsi, pour un type <code>date</code>, on peut utiliser la classe <code>Ext.DatePicker</code> qui affiche un calendrier sur l'écran.</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #009900;">&#123;</span> 	xtype<span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;datepickerfield&quot;</span><span style="color: #339933;">,</span> 	<span style="color: #000066;">name</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;startDate&quot;</span><span style="color: #339933;">,</span> 	label<span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Start Date&quot;</span><span style="color: #339933;">,</span> 	picker<span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span> yearFrom<span style="color: #339933;">:</span> <span style="color: #CC0000;">2011</span><span style="color: #339933;">,</span> yearTo<
span style="color: #339933;">:</span> <span style="color: #CC0000;">2020</span><span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#125;</span></pre> <p><img src="/wp-content/uploads/2015/07/.datePicker_s.jpg" alt="datePicker.png" style="display:block; margin:0 auto;" /></p> <p>Et voici en image le panel d'ajout d'évènement&nbsp;:</p> <p><a href="/wp-content/uploads/2015/07/Capture_new_Event_2.png"><img src="/wp-content/uploads/2015/07/.Capture_new_Event_2_s.jpg" alt="Capture_new_Event_2.png" style="display:block; margin:0 auto;" /></a></p> <p>En ce qui concerne le panel qui localise l'évènement, j'utilise l'API JavaScript Google Maps (qu'il faut déclarer dans la page HTML). Pour créer une carte, Sencha Touch fourni une classe qui insère automatiquement une carte Google dans un objet de type Ext.Component. Cette classe est Ext.Map et reprend les paramètres d'une Google Map.</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">var</span> map <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Ext.<span style="color: #660066;">Map</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>     	mapOptions<span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>zoom<span style="color: #339933;">:</span> <span style="color: #CC0000;">15</span><span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>Ensuite on crée un panel qui va contenir cette carte&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">var</span> mapPanel <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Ext.<span style="color: #660066;">Panel</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>         fullscreen<span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span>         <span style="color: #006600; font-style: italic;">//docked items...</span>         items <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>map<span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>La classe Ext.Map permet de dimentionner automatiquement la carte pour qu'elle occupe tout le contenu du panel. Pour accéder et modifier la carte, il suffit de récupérer l'objet <code>map</code> de Ext.Map instancié (ici map.map) et ensuite d'utiliser les fonctions fournies dans l'API Google Maps.</p> <p>Pour finir, dans le script central, j'initialise l'application avec <code>Ext.setup</code>, et je créer un panel de type <code>Ext.Container</code> qui va contenir tous les panels de l'application et les afficher à tour de rôle avec un layout de type <code>card</code>. Pour choisir le panel à afficher on utilise la fonction <code>setActiveItem(i)</code>.</p> <pre class="javascript code javascript" style="font-family:inherit">Ext.<span style="color: #660066;">setup</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span> 	phoneStartupScreen <span style="color: #339933;">:</span> <span style="color: #3366CC;">'phone_startup.png'</span><span style="color: #339933;">,</span> 	tabletStartupScreen <span style="color: #339933;">:</span> <span style="color: #3366CC;">'tablet_startup.pgn'</span><span style="color: #339933;">,</span> 	icon <span style="color: #339933;">:</span> <span style="color: #3366CC;">'icon_agenda.jpg'</span><span style="color: #339933;">,</span> 	glossOnIcon <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span> 	onReady <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>                   <span style="color: #006600; font-style: italic;">//...</span>                   p <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Ext.<span style="color: #660066;">Container</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span> 	                fullscreen<span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span> 	                layout<span style="color: #339933;">:</span> <span style="color: #3366CC;">'card'</span><span style="color: #339933;">,</span> 	                cardSwitchAnimation<span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span> 		              type<span style="color: #339933;">:</span> <span style="color: #3366CC;">'fade'</span><span style="color: #339933;">,</span>                               duration<span style="color: #339933;">:</span> <span style="color: #CC0000;">600</span>                         <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>                         items<span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>homePanel<span style="color: #339933;">,</span> newEventPanel<span style="color: #339933;">,</span> evtPanel<span style="color: #339933;">,</span> mapPanel<span style="color: #009900;">&#93;</span>                   <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; p.<span style="color: #660066;">setActiveItem</span><span style="color: #009900;">&#40;</span>0<span style="color: #009900;">&#41;</span>;</pre> <p>Pour ce qui est du panel <code>evtPanel</code> qui affiche le détail de chaque évènement, il est crée avec un item vide qui est ensuite enlevé et remplacé par les informations de chaque évènement sélectionné. Je donnerai plus de précision dans la partie suivante.</p> <h3>LocalStorage</h3> <p>Pour gérer les données d'une application, Sencha Touch utilise principalement deux classes&nbsp;: Ext.data.Model et Ext.data.Store.</p> <p>La classe Ext.data.Model permet de représenter un objet de l'application. Un modèle est défini par une série de champs ainsi que des propriétés et méthodes spécifiques. Parmi eux, la possiblité de définir des contraintes de validation, des associations avec d'autres modèles, ainsi que l'utilisation d'un Proxy.</p> <p>La classe Ext.data.Proxy permet de gérer la sauvegarde et le chargement des données. Il existe deux sous classes de Proxy&nbsp;: ClientProxy pour gérer les données sur le client, et ServerProxy pour celles qui sont sur le serveur.</p> <p>L'utilisation de <code>Proxy</code> se fait par l'intermédiaire de la classe <code>Store</code>. Cette classe permet de contenir des données d'un modèle récupérés via un Proxy.</p> <p>A présent, pour notre application, nous allons utiliser ces classes pour sauvegarder les évènements entrés avec le formulaire sur le LocalStorage du navigateur.</p> <p>On commence par créer le modèle 'Event' avec les mêmes champs que le formulaire et un proxy de type <code>localstorage</code>&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit">Ext.<span style="color: #660066;">regModel</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'Event'</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> 	fields <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span> <span style="color: #009900;">&#123;</span> 		<span style="color: #000066;">name</span> <span style="color: #339933;">:</span> <span style="color: #3366CC;">'name'</span><span style="color: #339933;">,</span> 		type <span style="color: #339933;">:</span> <span style="color: #3366CC;">'string'
</span> 	<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> 		<span style="color: #000066;">name</span> <span style="color: #339933;">:</span> <span style="color: #3366CC;">'startDate'</span><span style="color: #339933;">,</span> 		type <span style="color: #339933;">:</span> <span style="color: #3366CC;">'date'</span> 	<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> 		<span style="color: #000066;">name</span> <span style="color: #339933;">:</span> <span style="color: #3366CC;">'endDate'</span><span style="color: #339933;">,</span> 		type <span style="color: #339933;">:</span> <span style="color: #3366CC;">'date'</span> 	<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> 		<span style="color: #000066;">name</span> <span style="color: #339933;">:</span> <span style="color: #3366CC;">'location'</span><span style="color: #339933;">,</span> 		type <span style="color: #339933;">:</span> <span style="color: #3366CC;">'string'</span> 	<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> 		<span style="color: #000066;">name</span> <span style="color: #339933;">:</span> <span style="color: #3366CC;">'repetition'</span><span style="color: #339933;">,</span> 		type <span style="color: #339933;">:</span> <span style="color: #3366CC;">'string'</span> 	<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> 		<span style="color: #000066;">name</span> <span style="color: #339933;">:</span> <span style="color: #3366CC;">'alert'</span><span style="color: #339933;">,</span> 		type <span style="color: #339933;">:</span> <span style="color: #3366CC;">'boolean'</span> 	<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span> 		<span style="color: #000066;">name</span> <span style="color: #339933;">:</span> <span style="color: #3366CC;">'email'</span><span style="color: #339933;">,</span> 		type <span style="color: #339933;">:</span> <span style="color: #3366CC;">'string'</span> 	<span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> 	proxy <span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span> 		type <span style="color: #339933;">:</span> <span style="color: #3366CC;">'localstorage'</span><span style="color: #339933;">,</span> 		id <span style="color: #339933;">:</span> <span style="color: #3366CC;">'EventStore'</span> 	<span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>L'id <code>EventStore</code> va permettre de regrouper les données entrés avec ce modèle sous le même identifiant dans le LocalStorage du navigateur. Ensuite il faut créer un objet <code>Store</code> pour ce modèle&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">var</span> store <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Ext.<span style="color: #660066;">data</span>.<span style="color: #660066;">Store</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span> 	model <span style="color: #339933;">:</span> <span style="color: #3366CC;">'Event'</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>Puis, nous allons utiliser ces objets pour ajouter un évènement. On reprend le bouton "save" du formulaire&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit">saveButton.<span style="color: #660066;">on</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'tap'</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 	<span style="color: #003366; font-weight: bold;">var</span> event <span style="color: #339933;">=</span> Ext.<span style="color: #660066;">ModelMgr</span>.<span style="color: #660066;">create</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'Event'</span><span style="color: #009900;">&#41;</span>; 	store.<span style="color: #660066;">add</span><span style="color: #009900;">&#40;</span>event<span style="color: #009900;">&#41;</span>; 	myform.<span style="color: #660066;">updateRecord</span><span style="color: #009900;">&#40;</span>event<span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span>;         store.<span style="color: #660066;">sync</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>; 	<span style="color: #006600; font-style: italic;">//...</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>On commence par créer une instance du modèle <code>event</code> avec des champs vides et on l'ajoute au <code>store</code>. Ensuite on appelle une méthode <code>updateRecord</code> sur le formulaire qui va remplir l'objet <code>event</code> avec les données entrées. Enfin, on synchronise le store avec le LocalStorage ce qui aura pour effet de mettre à jour les données du store.</p> <p>Pour récupérer les données, il suffit alors d'appeler la fonction <code>load</code> sur le store&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit">store.<span style="color: #660066;">load</span><span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>records<span style="color: #339933;">,</span> operation<span style="color: #339933;">,</span> success<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 	<span style="color: #000066; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span> <span style="color: #003366; font-weight: bold;">var</span> i <span style="color: #339933;">=</span> 0; i <span style="color: #339933;">&lt;</span> records.<span style="color: #660066;">length</span>; i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 		console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span>records<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #660066;">data</span>.<span style="color: #000066;">name</span><span style="color: #009900;">&#41;</span>; 	<span style="color: #009900;">&#125;</span> 	displayList<span style="color: #009900;">&#40;</span>store<span style="color: #009900;">&#41;</span>; <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>displayList étant une fonction implémentée dans le script du panel "home" qui va ajouter une liste au panel avec les noms de tous les évènements enregistrés&nbsp;:</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">function</span> displayList<span style="color: #009900;">&#40;</span>storeName<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 	list <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Ext.<span style="color: #660066;">List</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span> 		fullscreen<span style="color: #339933;">:</span><span style="color: #003366; font-weight: bold;">true</span><span sty
le="color: #339933;">,</span> 		itemTpl <span style="color: #339933;">:</span> <span style="color: #3366CC;">'{name}'</span><span style="color: #339933;">,</span> 		indexBar<span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span> 		store<span style="color: #339933;">:</span> storeName <span style="color: #339933;">,</span> &nbsp;                 listeners<span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span> 	    	itemtap <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>list<span style="color: #339933;">,</span> index<span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">item</span><span style="color: #339933;">,</span> e<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 	    		evt <span style="color: #339933;">=</span> storeName.<span style="color: #660066;">getAt</span><span style="color: #009900;">&#40;</span>index<span style="color: #009900;">&#41;</span>; 	    		displayEventPanel<span style="color: #009900;">&#40;</span>evt<span style="color: #009900;">&#41;</span>; 	    	<span style="color: #009900;">&#125;</span> 	    <span style="color: #009900;">&#125;</span> 	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 	homePanel.<span style="color: #660066;">add</span><span style="color: #009900;">&#40;</span>list<span style="color: #009900;">&#41;</span>; <span style="color: #009900;">&#125;</span></pre> <p>Cette liste à un paramètre <code>store</code> qui référence au nom du store contenant les évènements. Ce paramètre va permettre de mettre à jour la liste automatiquement à chaque changement dans les données sauvegardées. Ensuite à chaque selection d'un item de la liste, on va afficher le panel contenant les informations enregistrées de l'évènement.</p> <p><a href="/wp-content/uploads/2015/07/capture_home_2.png"><img src="/wp-content/uploads/2015/07/.capture_home_2_s.jpg" alt="capture_home_2.png" style="float:left; margin: 0 1em 1em 0;" /></a><a href="/wp-content/uploads/2015/07/Capture_event.png"><img src="/wp-content/uploads/2015/07/.Capture_event_s.jpg" alt="Capture_event.png" /></a></p> <h3>Geolocalisation</h3> <p>En ce qui concerne la Géolocalisation de l'utilisateur, Sencha Touch fourni une classe <code>Ext.util.GeoLocation</code> qui est basée sur l'API Geolocation d'HTML5.</p> <pre class="javascript code javascript" style="font-family:inherit"><span style="color: #003366; font-weight: bold;">var</span> geo <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Ext.<span style="color: #660066;">util</span>.<span style="color: #660066;">GeoLocation</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span> 	autoUpdate <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">false</span><span style="color: #339933;">,</span> 	listeners <span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span> 		locationupdate <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>geo<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 			myPosition <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> google.<span style="color: #660066;">maps</span>.<span style="color: #660066;">LatLng</span><span style="color: #009900;">&#40;</span>geo.<span style="color: #660066;">latitude</span><span style="color: #339933;">,</span> geo.<span style="color: #660066;">longitude</span><span style="color: #009900;">&#41;</span>; 			map.<span style="color: #660066;">update</span><span style="color: #009900;">&#40;</span>myPosition<span style="color: #009900;">&#41;</span>; 			<span style="color: #003366; font-weight: bold;">var</span> marker <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> google.<span style="color: #660066;">maps</span>.<span style="color: #660066;">Marker</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span> 				position <span style="color: #339933;">:</span> myPosition<span style="color: #339933;">,</span> 				map <span style="color: #339933;">:</span> map.<span style="color: #660066;">map</span><span style="color: #339933;">,</span> 				title <span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Me!&quot;</span> 			<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>; 			findDirection<span style="color: #009900;">&#40;</span>myPosition<span style="color: #009900;">&#41;</span>; <span style="color: #009966; font-style: italic;">/* affiche un chemin de l'utilisateur vers l'évènement */</span> 		<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> 		locationerror <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>geo<span style="color: #339933;">,</span> bTimeout<span style="color: #339933;">,</span> bPermissionDenied<span style="color: #339933;">,</span> bLocationUnavailable<span style="color: #339933;">,</span> message<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span> 	<span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>;</pre> <p>Par défaut, dès qu'elle est instanciée, la classe va constamment suivre la position de l'utilisateur. Le paramètre <code>autoUpdate</code> mis à <code>false</code> permet d'éviter cette mise à jour automatique et la demande de localisation s'effectue en appelant la fonction <code>updateLocation</code>. On récupère ensuite les évènements <code>locationupdate</code> et <code>locationerror</code>. <code>locationupdate</code> contiendra les données de localisation de l'utilisateur si la géolocalisation aboutit. Si elle échoue, l'évènement <code>locationerror</code> est déclanché.</p> <p><a href="/wp-content/uploads/2015/07/Capture_map_2.png"><img src="/wp-content/uploads/2015/07/.Capture_map_2_s.jpg" alt="Capture_map_2.png" style="display:block; margin:0 auto;" /></a></p> <p>Vous trouverez le code complet de l'application sur le <a href="https://github.com/Zenika/Blogs">Github de Zenika</a></p> <h2>Tests et critique</h2> <p><br />
Sencha Touch est un framework très différent des deux autres que j'ai présentés à savoir jQueryMobile et jQTouch. Sencha Touch est une véritable librairie JavaScript organisée en classes. Elle est très riche, avec notamment la prise en charges des API HTML5 comme le localStorage, la géolocalisation, et le support multimédia (audio et vidéo). Le développement avec Sencha Touch, presque entièrement en JavaScript, est un peu déroutant au début mais l'application gagne beaucoup en organisation et en richesse. Coté performance, mis à part un temps de chargement assez long, l'application reste très fluide.</p> <h3>Ressources</h3> <ul> <li><a href="http://www.sencha.com/products/touch/">Site de Sencha Touch</a></li> <li><a href="http://www.sencha.com/learn/Sencha_Touch">Tutoriels </a> <ul> <li><a href="http://www.sencha.com/learn/Tutorial:Sencha_Touch_Hello_World">Hello World</a></li> <li><a href="http://dev.sencha.com/deploy/touch/getting-started.html">Getting Started</a></li> </ul></li> <li><a href="http://dev.sencha.com/deploy/touch/docs/">Documentation de l'API Sencha Touch</a></li> </ul>