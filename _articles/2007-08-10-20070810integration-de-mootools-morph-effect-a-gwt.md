---
ID: 62
post_title: >
  Intégration de MooTools Morph Effect à
  GWT
author: Benjamin Houdu
post_date: 2007-08-10 15:25:00
post_excerpt: '<p>Cet article présente l’intégration d’un effet de la librairie Javascript <a href="http://www.mootools.net">MooTools</a> à GWT. FXMorph de MooTools permet de transformer par animations un élément, d’un état défini par une classe CSS de départ vers une classe CSS d’arrivée&nbsp;: le framework calcule et génère le morphing de la transition&nbsp;!</p>'
layout: post
permalink: http://blog.zenika-offres.com/?p=62
published: true
---
<p>Cet article présente l’intégration d’un effet de la librairie Javascript <a href="http://www.mootools.net">MooTools</a> à GWT. FXMorph de MooTools permet de transformer par animations un élément, d’un état défini par une classe CSS de départ vers une classe CSS d’arrivée&nbsp;: le framework calcule et génère le morphing de la transition&nbsp;!</p>
<!--more-->
<h3>GWT et animations&nbsp;?</h3> <p>GWT est un toolkit formidable pour le développement de RIA Ajax. Cependant relativement peu de démonstrations d’interfaces riches créées avec ce framework illustrent les qualités qu’il posséde en "motion design", mis à part quelques widgets souvent trop complexes pour une utilisation standard. En effet, contrairement à Adobe Flex, Microsoft Silverlight et Sun JavaFX, GWT et Ajax ne prennent pas en charge nativement les animations vectorielles ce qui limite naturellement les effets visuels standards.</p> <p>Il existe fort heureusement de multiples librairies JavaScript bien conçues et performantes permettant l’élaboration d’animations de widgets comme Scriptaculous (la plus connue). Un wrapper permettant l’intégration avec GWT a été conçu (disponible dans GWT Components). Il permet de créer aisément quelques animations mais au prix de nombreuses lignes de code. L’application de ces animations à l’ensemble d’une application devient vite pénible!</p> <p>La solution originale proposée par MooTools conciste à externaliser les données des animations (point départ, point d’arrivée) dans des classes CSS, et à laisser ensuite la librairie génèrer l’animation voulue sans intervention du développeur! On obtient alors un effet JS extrêmement puissant et facile d’utilisation. Intégrer ces effets à GWT représente donc une optique intéressante.</p> <h3>Démonstration</h3> <p>Voici un lien vers la <a href="http://www.zenika.com/demos/mootools4gwt">démonstration</a> de l’utilisation du <code>MorphEffectWrapper</code> faisant partie d’un package mootools4Gwt qui n’est autre qu’une intégration partielle de la librairie MooTools dans GWT. Voici aussi un lien vers <a href="http://demos.mootools.net/Fx.Morph">l’effet original</a> (hors GWT) si vous voulez comparer. Enfin, voici un lien direct vers <a href="/wp-content/uploads/2015/07/mootools4gwt.zip">mootools4gwt.ziples sources de ce wrapper</a> sous la forme d’un projet GWT / Eclipse.</p> <p>Cet effet JavaScript a l’avantage d’être très facilement contrôlé en Java avec GWT par l’utilisation d’une seule classe. Il est peu gourmand en temps de chargement de scripts (dans notre cas moins de 35ko), et peut être intégré facilement à GWT.</p> <p>Le wrapper prend en charge les propriétés CSS&nbsp;: position, taille, couleur de fond, couleur et taille de police, transparence, marge et padding. Cet effet a été testé avec succès avec IE 7 et Firefox 2.</p> <h3>Utilisation du wrapper MorphEffectWrapper</h3> <p>Pour pouvoir utiliser notre wrapper, il suffit d’ajouter les deux scripts mootools.js et morph.js à votre page GWT. Ces 2 fichiers sont présents dans les sources de notre exemple dans le répertoire ‘js‘ de la partie ‘public‘ de notre application.</p> <p>Une fois inclus ces fichiers, il faut ensuite définir des classes CSS dans n’importe quelle feuille de style incluse à la page&nbsp;; elles serviront pour le filtre MooTools Morph. A titre d’exemple, voici deux classes proposées par le site MooTools. Elles sont idéales pour tester toutes les capacités du filtre&nbsp;:</p> <pre class="css code css" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #6666ff;">.morph1</span> <span style="color: #00AA00;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">color</span><span style="color: #00AA00;">:</span> <span style="color: #cc00cc;">#666</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">background-color</span><span style="color: #00AA00;">:</span> <span style="color: #cc00cc;">#ccc</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">height</span><span style="color: #00AA00;">:</span> <span style="color: #933;">200px</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">width</span><span style="color: #00AA00;">:</span> <span style="color: #933;">300px</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">font-size</span><span style="color: #00AA00;">:</span> <span style="color: #933;">15px</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">overflow</span><span style="color: #00AA00;">:</span> <span style="color: #993333;">hidden</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	opacity<span style="color: #00AA00;">:</span> <span style="color: #cc66cc;">1</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">border</span><span style="color: #00AA00;">:</span> <span style="color: #933;">2px</span> <span style="color: #993333;">solid</span> <span style="color: #cc00cc;">#aaa</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">margin</span><span style="color: #00AA00;">:</span> 0;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">padding</span><span style="color: #00AA00;">:</span> <span style="color: #933;">5px</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #00AA00;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #6666ff;">.morph2</span> <span style="color: #00AA00;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">color</span><span style="color: #00AA00;">:</span> <span style="color: #cc00cc;">#000</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">background-color</span><span style="color: #00AA00;">:</span> <span style="color: #cc00cc;">#ff3300</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">height</span><span style="color: #00AA00;">:</span> <span style="color: #933;">100px</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospac
e; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">width</span><span style="color: #00AA00;">:</span> <span style="color: #933;">400px</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">font-size</span><span style="color: #00AA00;">:</span> <span style="color: #933;">10px</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	opacity<span style="color: #00AA00;">:</span> <span style="color: #cc66cc;">0.5</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">margin</span><span style="color: #00AA00;">:</span> <span style="color: #933;">60px</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">padding</span><span style="color: #00AA00;">:</span> <span style="color: #933;">60px</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000; font-weight: bold;">border</span><span style="color: #00AA00;">:</span> <span style="color: #933;">10px</span> <span style="color: #993333;">solid</span> <span style="color: #cc00cc;">#000</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #00AA00;">&#125;</span></div></li></ol></pre> <p>Par ailleurs dans une de vos classes de <code>Widget</code> / <code>Composite</code> / <code>EntryPoint</code>, créez un <code>MorphEffectWrapper</code>&nbsp;: il est important que les widgets managés par le wrapper soient déjà ajoutés au <code>RootPanel</code> avant l’instanciation de celui-ci, sinon votre effet risque tout simplement de ne pas avoir lieu (voir les sources pour plus de détails).</p> <p>La commande à utiliser est&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">MorphEffectWrapper wrapper = <span style="color: #7F0055; font-weight: bold;">new</span> MorphEffectWrapper<span style="color: #000000;">&#40;</span>monUIObject, monStyleDeDépart, monStyleDarrivée<span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p>NB&nbsp;: <code>monUIObject</code> est un <code>UIObject</code> (donc n’importe quel Widget GWT est utilisable). Les autres paramètres sont des String.</p> <p>Il suffit ensuite d’appeller <code>wrapper.morph()</code> pour lancer l’animation et <code>wrapper.morphBack()</code> pour revenir à l’état initial et ce, à tout moment (cliquer sur "morphback" stoppe l’animation morph en cours et retourne à l’état initial avec une animation).<br />
Il est possible d’utiliser plusieurs <code>MorphEffectWrapper</code> (comme le prouve notre démonstration) sur une même page sans conflit. Il faut néanmoins préciser un paramètre supplémentaire lors de l’instanciation de votre wrapper&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">MorphEffectWrapper wrapper = <span style="color: #7F0055; font-weight: bold;">new</span> MorphEffectWrapper<span style="color: #000000;">&#40;</span>monUIObject, monStyleDeDépart, monStyleDarrivée, monId<span style="color: #000000;">&#41;</span>;</div></li></ol></pre> <p>NB&nbsp;: <code>monId</code> est un <code>String</code> que vous choisirez arbitrairement afin de distinguer vos divers <code>MorphEffectWrapper</code>. Un constructeur supplémentaire avec un paramètre ‘<code>String options</code>‘ est fourni si vous désirez ajouter des paramètres Javascript à votre effet MooTools (format JSON, se référencer à la documentation MooTools pour plus d’informations).</p> <h3>Pour aller plus loin</h3> <p>Voir&nbsp;:</p> <ul> <li>Notre <a href="http://www.zenika.com/demos/mootools4gwt">démonstration en ligne</a>.</li> <li>La <a href="http://www.mootools.net/">documentation de MooTools</a>.</li> </ul> <p>En ce qui concerne MooTools, cette librairie est disponible sous licence open source MIT et son téléchargement se fait via une interface vous permettant de choisir les fonctions / effets à inclure. Pour notre exemple, nous avons choisi&nbsp;: tous les outils de base, l’élément ‘DOMREADY’ (très important) et tous les effets (morph est une composition d’effets de base). Le fichier téléchargé sur ce site sera toujours optimisé et obfusqué, vous trouverez dans la documentation du site la version "lisible" du code si vous le désirez.</p> <p>L’effet Morph n’est pas encore disponible d’entrée avec MooTools 1.1 (il le sera dans la prochaine version 1.2)&nbsp;: celui-ci est toutefois présent sur leur site (attention celui de la version démo possède des bugs que n’a pas la dernière version sous SVN).</p> <p>Il est possible de créer des effets personnalisés avec MooTools en JavaScript, vous pouvez par la suite les wrapper dans GWT facilement. En vérité le filtre Morph est l’un des plus complets et la réalisation d’effets moins étendus est plus aisée.</p>