---
ID: 89
post_title: 'Introduction au framework Camel &#8211; Partie 1'
author: rdelaporte
post_date: 2010-03-17 18:53:00
post_excerpt: |
  <h2>La problématique d'intégration de systèmes</h2> <p>Dans un système d'information, nous avons généralement une multitude de systèmes hétérogènes qui ne se comprennent pas nativement  (technologies différentes, protocoles de communication différents, etc.) Il est néanmoins indispensable de relier ces systèmes car des applications qui ne communiquent pas ne présentent qu'un intérêt métier limité. <br /><br />
  Cela soulève beaucoup de problématiques telles que le format de données, le routage, le monitoring, etc. <br />
  Par exemple, comment fait-on pour connecter deux applications, où l'une manipule un fichier CSV alors que la seconde ne comprend que le XML sur JMS&nbsp;?</p>
layout: post
permalink: http://blog.zenika-offres.com/?p=89
published: true
---
<h2>La problématique d'intégration de systèmes</h2> <p>Dans un système d'information, nous avons généralement une multitude de systèmes hétérogènes qui ne se comprennent pas nativement  (technologies différentes, protocoles de communication différents, etc.) Il est néanmoins indispensable de relier ces systèmes car des applications qui ne communiquent pas ne présentent qu'un intérêt métier limité. <br /><br />
Cela soulève beaucoup de problématiques telles que le format de données, le routage, le monitoring, etc. <br />
Par exemple, comment fait-on pour connecter deux applications, où l'une manipule un fichier CSV alors que la seconde ne comprend que le XML sur JMS&nbsp;?</p>
<!--more-->
<h2>Les Entreprise Integration Pattern</h2> <p><a href="http://camel.apache.org/">Apache Camel</a> est un framework d'intégration, implémentant les EIP (Entreprise Integration Pattern) définis par Gregor Hohpe &amp; Bobby Woolf. Les <a href="http://www.eaipatterns.com/">EIP</a> sont des patterns d'intégration qui nous permettent de résoudre ces problématiques d'intégration avec des solutions éprouvées. <br /><br />Le framework Camel en supporte environ une cinquantaine. <br />
<br /></p> <h2>Les Endpoints</h2> <p>Les endpoints représentent des systèmes, des ressources physiques, des ressources virtuelles, etc. Nous avons par exemple des endpoints <em>HTTP, JMS, FTP</em> pour s'interfacer avec différents protocoles, mais aussi des endpoints <em>Direct, Seda</em> pour communiquer dans une même contexte Camel (nous y reviendrons). <br /><br />Les endpoints peuvent être de 2 types&nbsp;:</p> <ul> <li>consumer</li> <li>provider</li> </ul> <p><br /></p> <p>Exemples</p> <ul> <li>Répertoire des factures du mois de mars 2010: <code>file://factures/032010</code></li> <li>File de messages de transit des factures: <code>jms://zenika/factures</code></li> </ul> <p><br /></p> <h2>Les Routes</h2> <p>Une route (chemin entre 2 endpoints) peut être très simple, mais aussi très complexe (transformation de données, diffusion à plusieurs destinataires, filtrage de messages, etc). <br />Elles permettent d'acheminer le message d'origine jusqu'à leur destination finale.</p> <p>Camel est capable de configurer des routes via 2 méthodes&nbsp;:</p> <ul> <li>configuration XML XBean</li> <li>utilisation du DSL (Domain Specific Language)</li> </ul> <p><br /></p> <p>Par exemple, voici la lecture d'un fichier à partir d'un répertoire, puis l'écriture de ce même fichier dans un autre répertoire (nous définissons ici une route très simple)&nbsp;:</p> <h3>Méthode XML</h3> <pre class="xml code xml" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;beans</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans&quot;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;">	<span style="color: #000066;">xmlns:xsi</span>=<span style="color: #ff0000;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;">	<span style="color: #000066;">xsi:schemaLocation</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/bean</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #ff0000;">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #ff0000;">       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;camelContext</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">&quot;http://camel.apache.org/schema/spring&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;route<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;from</span> <span style="color: #000066;">uri</span>=<span style="color: #ff0000;">&quot;file://C://factures//in&quot;</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;to</span> <span style="color: #000066;">uri</span>=<span style="color: #ff0000;">&quot;file://C://factures//out&quot;</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/route<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/camelContext<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/beans<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li></ol></pre> <p><br /></p> <h3>Méthode DSL</h3> <h5>1. Déclaration des packages Java à scanner (fichier camel-context.xml)</h5> <pre class="xml code xml" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;beans</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans&quot;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;">	<span style="color: #000066;">xmlns:xsi</span>=<span style="color: #ff0000;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;">	<span style="color: #000066;">xsi:schemaLocation</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #ff0000;">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #ff0000;">       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0;
background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;camelContext</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">&quot;http://camel.apache.org/schema/spring&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;packageScan<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">			<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;package<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.zenika.camel.routes<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/package<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/packageScan<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/camelContext<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/beans<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></div></li></ol></pre> <p><br /></p> <h5>2. Écriture des routes</h5> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">package</span> com.<span style="color: #000000;">zenika</span>.<span style="color: #000000;">camel</span>.<span style="color: #000000;">routes</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.camel.builder.RouteBuilder;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> FacturesRoute <span style="color: #7F0055; font-weight: bold;">extends</span> RouteBuilder <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	@Override</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">void</span> configure<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> <span style="color: #000000;">Exception</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		from<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;file://C://factures//in&quot;</span><span style="color: #000000;">&#41;</span>.<span style="color: #000000;">to</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;file://C://factures//out&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>La méthode DSL est beaucoup moins verbeuse, et plus simple à maintenir <br />Il est simplement nécessaire de déclarer les packages Java à scanner, et d'écrire les routes en Java via le DSL.</p> <p>Elle est également beaucoup plus sécurisée (type safe). <br />Il est en effet impossible de définir une opération non supportée. <br />De plus, l'intégralité de la syntaxe Camel est disponible en XML et via le DSL. <br />
<br /></p> <h2>Le contexte Camel, cœur du framework</h2> <p>Afin de faire fonctionner cette route, nous avons besoin d'un contexte Camel. C'est ce contexte qui charge, configure et exécute les routes. Il s'agit véritablement du moteur du framework. <br /><br />Le framework Camel n'a pas pour vocation d'être utiliser en mode standalone (excepté à des fins de tests). Camel doit être intégré à un conteneur (<a href="http://servicemix.apache.org/home.html">ServiceMix</a>, <a href="http://activemq.apache.org/">ActiveMQ</a>, <a href="http://cxf.apache.org/">CXF</a> ou encore <a href="http://tomcat.apache.org/">Tomcat</a>).</p> <p>Voici un exemple simple pour instancier notre contexte Camel&nbsp;:</p> <pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">package</span> com.<span style="color: #000000;">zenika</span>.<span style="color: #000000;">camel</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.apache.camel.CamelContext;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.springframework.beans.factory.BeanFactory;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #a1a100;">import org.springframework.context.support.ClassPathXmlApplicationContext;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> Testeur <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">void</span> main<span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span>... <span style="color: #000000;">args</span><span style="color: #000000;">&#41;</span> <span style="color: #7F0055; font-weight: bold;">throws</span> <span style="color: #000000;">Exception</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		BeanFactory beanFactory = <span style="color: #7F0055; font-weight: bold;">new</span> ClassPathXmlApplicationContext<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;classpath:/camel-context.xml&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		CamelContext camelContext = <span style="color: #000000;">&#40;</span>CamelContext<span style="color: #000000;">&#41;</span> beanFactory.<span style="color: #000000;">getBean</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;camelContext&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		camelContext.<span style="color: #000000;">start</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		<span style="color: #000000;">Thread</span>.<span style="color: #000000;">sleep</span><span style="color: #000000;">&#40;</span><span style="color: #cc66cc;">2000</span><span style="color: #000000;">&#41;</span>; <span style="color: #808080; font-style: italic;">// pour avoir le temps d'exécuter la route</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">		camelContext.<span style="color: #000000;">stop</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">	<span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre> <p>Avec ces quelques lignes de code, nous avons très simplement mis en place une route qui copie tous les fichiers présents dans <code>factures/in</code> vers <code>factures/out</code>.</p> <p><br /><br />Nous verrons par la suite d'autres types de endpoints très utiles (comme le <em>Direct</em>), ainsi que des routes plus complexes avec des transformations de données et de la logique de routage.<br /></p>